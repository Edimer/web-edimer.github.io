<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Edimer (Sidereus)">
<meta name="description" content="Algortimo XGBoost con R para resolver problemas de aprendizaje supervisado (clasificación).">
<title>Machine Learning con R y Python - XGBoost con R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sín resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la busqueda",
    "search-hide-matches-text": "Esconder resultados adicionales",
    "search-more-match-text": "hay más resultados en este documento",
    "search-more-matches-text": "más resultados en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Eviar"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="estilo.css">
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Machine Learning con R y Python</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../about.html">Información</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Edimer"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://co.linkedin.com/in/edimer-david-jaramillo-94a510199"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 </a>
  </li>  
</ul>
<div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">XGBoost con R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Código</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Enseñar el código</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Esconder el código</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Ver el código</a></li></ul></div></div>
                  <div>
        <div class="description">
          Algortimo XGBoost con R para resolver problemas de aprendizaje supervisado (clasificación).
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">xgboost</div>
                <div class="quarto-category">Gradient Boosting</div>
                <div class="quarto-category">ML</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Autor</div>
      <div class="quarto-title-meta-contents">
               <p>Edimer (Sidereus) </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Fecha de Publicación</div>
      <div class="quarto-title-meta-contents">
        <p class="date">1 de mayo de 2021</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Tabla de contenido</h2>
   
  <ul>
<li><a href="#documentaci%C3%B3n-xgboost" id="toc-documentación-xgboost" class="nav-link active" data-scroll-target="#documentaci%C3%B3n-xgboost">Documentación <code>xgboost</code></a></li>
  <li>
<a href="#datos-de-ejemplo" id="toc-datos-de-ejemplo" class="nav-link" data-scroll-target="#datos-de-ejemplo">Datos de ejemplo</a>
  <ul class="collapse">
<li><a href="#detecci%C3%B3n-de-mastitis" id="toc-detección-de-mastitis" class="nav-link" data-scroll-target="#detecci%C3%B3n-de-mastitis">Detección de mastitis</a></li>
  </ul>
</li>
  <li><a href="#requisitos-previos" id="toc-requisitos-previos" class="nav-link" data-scroll-target="#requisitos-previos">Requisitos previos</a></li>
  <li><a href="#bibliotecas" id="toc-bibliotecas" class="nav-link" data-scroll-target="#bibliotecas">Bibliotecas</a></li>
  <li><a href="#tema-para-ggplot2" id="toc-tema-para-ggplot2" class="nav-link" data-scroll-target="#tema-para-ggplot2">Tema para <code>ggplot2</code></a></li>
  <li>
<a href="#detecci%C3%B3n-de-mastitis-1" id="toc-detección-de-mastitis-1" class="nav-link" data-scroll-target="#detecci%C3%B3n-de-mastitis-1">Detección de mastitis</a>
  <ul class="collapse">
<li><a href="#base-de-datos" id="toc-base-de-datos" class="nav-link" data-scroll-target="#base-de-datos">Base de datos</a></li>
  <li><a href="#an%C3%A1lisis-exploratorio" id="toc-análisis-exploratorio" class="nav-link" data-scroll-target="#an%C3%A1lisis-exploratorio">Análisis exploratorio</a></li>
  <li><a href="#train-y-test" id="toc-train-y-test" class="nav-link" data-scroll-target="#train-y-test">Train y Test</a></li>
  <li><a href="#validaci%C3%B3n-cruzada" id="toc-validación-cruzada" class="nav-link" data-scroll-target="#validaci%C3%B3n-cruzada">Validación cruzada</a></li>
  <li><a href="#preprocesamiento" id="toc-preprocesamiento" class="nav-link" data-scroll-target="#preprocesamiento">Preprocesamiento</a></li>
  <li><a href="#modelo-xgboost" id="toc-modelo-xgboost" class="nav-link" data-scroll-target="#modelo-xgboost">Modelo XGBoost</a></li>
  <li><a href="#flujos-de-trabajo-pipelines" id="toc-flujos-de-trabajo-pipelines" class="nav-link" data-scroll-target="#flujos-de-trabajo-pipelines">Flujos de trabajo (<em>pipelines</em>)</a></li>
  <li><a href="#grid" id="toc-grid" class="nav-link" data-scroll-target="#grid">Grid</a></li>
  <li><a href="#tuning-con-tidymodels" id="toc-tuning-con-tidymodels" class="nav-link" data-scroll-target="#tuning-con-tidymodels">Tuning con <code>tidymodels</code></a></li>
  <li><a href="#resultados-accuracy" id="toc-resultados-accuracy" class="nav-link" data-scroll-target="#resultados-accuracy">Resultados <em>Accuracy</em></a></li>
  <li><a href="#mejores-hiperpar%C3%A1metros" id="toc-mejores-hiperparámetros" class="nav-link" data-scroll-target="#mejores-hiperpar%C3%A1metros">Mejores hiperparámetros</a></li>
  <li><a href="#ajuste-final" id="toc-ajuste-final" class="nav-link" data-scroll-target="#ajuste-final">Ajuste final</a></li>
  <li><a href="#predicciones-train" id="toc-predicciones-train" class="nav-link" data-scroll-target="#predicciones-train">Predicciones Train</a></li>
  <li><a href="#predicciones-test" id="toc-predicciones-test" class="nav-link" data-scroll-target="#predicciones-test">Predicciones Test</a></li>
  <li><a href="#matriz-de-confusi%C3%B3n-train" id="toc-matriz-de-confusión-train" class="nav-link" data-scroll-target="#matriz-de-confusi%C3%B3n-train">Matriz de confusión Train</a></li>
  <li><a href="#matriz-de-confusi%C3%B3n-test" id="toc-matriz-de-confusión-test" class="nav-link" data-scroll-target="#matriz-de-confusi%C3%B3n-test">Matriz de confusión Test</a></li>
  <li><a href="#desempe%C3%B1o-de-modelos" id="toc-desempeño-de-modelos" class="nav-link" data-scroll-target="#desempe%C3%B1o-de-modelos">Desempeño de modelos</a></li>
  <li><a href="#importancia-de-variables" id="toc-importancia-de-variables" class="nav-link" data-scroll-target="#importancia-de-variables">Importancia de variables</a></li>
  </ul>
</li>
  <li><a href="#referencias" id="toc-referencias" class="nav-link" data-scroll-target="#referencias">Referencias</a></li>
  </ul></nav>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><section id="documentación-xgboost" class="level2"><h2 class="anchored" data-anchor-id="documentación-xgboost">Documentación <code>xgboost</code>
</h2>
<ul>
<li><a href="https://xgboost.readthedocs.io/en/latest/#">Documentación oficial <code>xgboost</code></a></li>
<li><a href="https://cran.r-project.org/web/packages/xgboost/xgboost.pdf">Biblioteca <code>xgboost</code> en R</a></li>
<li><a href="https://xgboost.readthedocs.io/en/latest/R-package/xgboostPresentation.html">Tutorial de <code>xgboost</code> en R</a></li>
</ul></section><section id="datos-de-ejemplo" class="level1"><h1>Datos de ejemplo</h1>
<p>En este documento se muestra cómo implementar el algoritmo <em>XGBoost</em> con R a través de la biblioteca que lleva el mismo nombre y haciendo uso del <a href="https://www.tidymodels.org/"><code>tidymodels</code>.</a> Para ejemplificar el ajuste de <em>modelos de clasificación</em> se obtuvieron datos de ejemplo aplicado en ciencias animales, específicamente en la detección de patrones de infección de mastitis en vacas.</p>
<section id="detección-de-mastitis" class="level2"><h2 class="anchored" data-anchor-id="detección-de-mastitis">Detección de mastitis</h2>
<ul>
<li><a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0249136">Artículo publicado en PLOS ONE</a></li>
</ul>
<center>
<img src="img/paper_classification.PNG" width="750/">
</center>
</section></section><section id="requisitos-previos" class="level1"><h1>Requisitos previos</h1>
<ul>
<li>Para replicar este documento es necesario instalar las siguientes bibliotecas:
<ul>
<li>
<strong><code>tidyverse</code>:</strong> manipulación y visualización de datos.</li>
<li>
<strong><code>readxl</code>:</strong> lectura de datos en formato de Excel.</li>
<li>
<strong><code>janitor</code>:</strong> manipulación de datos.</li>
<li>
<strong><code>visdat</code>:</strong> análisis exploratorio de datos.</li>
<li>
<strong><code>tidymodels</code>:</strong> entrenamiento y evaluación de modelos de machine learning.</li>
<li>
<strong><code>xgboost</code>:</strong> algoritmo <code>xgboost</code>.</li>
<li>
<strong><code>doParallel</code>:</strong> procesamiento en paralelo (cómputo distribuido).</li>
<li>
<strong><code>parallel</code></strong> procesamiento en paralelo (cómputo distribuido).</li>
<li>
<strong><code>vip</code>:</strong> calcular importancia de variables.</li>
<li>
<strong><code>ggsci</code>:</strong> paletas de colores.</li>
<li>
<strong><code>ggforce</code></strong> complemento para gráficos.</li>
<li>
<strong><code>FactoMineR</code>:</strong> análisis multivariado.</li>
<li>
<strong><code>knitr</code>:</strong> presentación de tablas (<code>data.frame</code>).</li>
</ul>
</li>
<li>Descargar los datos para ejemplo:
<ul>
<li><a href="https://www.nature.com/articles/s41598-020-61126-8#Sec15">Datos para detección de mastitis</a></li>
</ul>
</li>
<li>
<strong>Nota:</strong> es importante mencionar que cuando cargamos la <em>meta-biblioteca</em> <code>tidymodels</code> se activan otras bibliotecas que usaremos más adelante.</li>
</ul></section><section id="bibliotecas" class="level1"><h1>Bibliotecas</h1>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://visdat.njtierney.com/">visdat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://factominer.free.fr">FactoMineR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmlc/xgboost">xgboost</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel">doParallel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/koalaverse/vip/">vip</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://nanx.me/ggsci/">ggsci</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggforce.data-imaginist.com">ggforce</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="tema-para-ggplot2" class="level1"><h1>Tema para <code>ggplot2</code>
</h1>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mi_temagg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"gray5"</span><span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="va">mi_temagg</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="detección-de-mastitis-1" class="level1"><h1>Detección de mastitis</h1>
<ul>
<li>La variable respuesta está identificada como <code>diagnosis</code>. En principio tiene 4 niveles, sin embargo, para el ejemplo fueron filtrados sólo los niveles <code>EDP</code> (transmisión en el período seco - sin lactancia) y <code>EL</code> (transmisión en período de lactancia).</li>
<li>La base de datos consta de 1000 observaciones y 229 variables, es decir, que existen 228 variables predictoras. Cuando se aplicó el filtro quedaron 914 observaciones.</li>
</ul>
<section id="base-de-datos" class="level2"><h2 class="anchored" data-anchor-id="base-de-datos">Base de datos</h2>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mastitis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/mastitis.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">diagnosis</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"EDP"</span>, <span class="st">"EL"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mastitis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">diagnosis</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"6 primeras filas de la base de datos con 6 columnas"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>6 primeras filas de la base de datos con 6 columnas</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 23%">
<col style="width: 20%">
<col style="width: 17%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">diagnosis</th>
<th style="text-align: left;">quarter_dates_q0</th>
<th style="text-align: right;">no_recordings_q0</th>
<th style="text-align: right;">l_1_q0_bmscc_000_cells_ml</th>
<th style="text-align: right;">l_1_q0_percent_chronic</th>
<th style="text-align: right;">l_1_q0_percent_200k</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EDP</td>
<td style="text-align: left;">06/10/2009</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">EDP</td>
<td style="text-align: left;">06/12/2009</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">284</td>
<td style="text-align: right;">27.8</td>
<td style="text-align: right;">40.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EL</td>
<td style="text-align: left;">20/04/2012</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">EL</td>
<td style="text-align: left;">16/07/2009</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">21.1</td>
<td style="text-align: right;">26.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EL</td>
<td style="text-align: left;">16/10/2013</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">251</td>
<td style="text-align: right;">27.5</td>
<td style="text-align: right;">34.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">EDP</td>
<td style="text-align: left;">12/01/2013</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">154</td>
<td style="text-align: right;">12.3</td>
<td style="text-align: right;">17.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="análisis-exploratorio" class="level2"><h2 class="anchored" data-anchor-id="análisis-exploratorio">Análisis exploratorio</h2>
<ul>
<li>Frecuencia absoluta para niveles de la variable respuesta.</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mastitis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">diagnosis</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diagnosis</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dodgerblue3"</span>, fill <span class="op">=</span> <span class="st">"dodgerblue3"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Diagnóstico"</span>", y<span class="op">=</span>=<span class="st">"Frecuencia"</span><span class="op">)</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Frecuencia absoluta de variable respuesta</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Distribuciones de algunas variables numéricas: como el número de variables es alto, selecciono al azar 8 de ellas para construir el gráfico.</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Números al azar</span>r</span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1992</span><span class="op">)</span></span>
<span><span class="va">variables_azar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">228</span>, size <span class="op">=</span> <span class="fl">8</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mastitis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">diagnosis</span>, <span class="va">variables_azar</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">diagnosis</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">diagnosis</span>, color <span class="op">=</span> <span class="va">diagnosis</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, scales <span class="op">=</span> <span class="st">"free"</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://nanx.me/ggsci/reference/scale_jama.html">scale_color_jama</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://nanx.me/ggsci/reference/scale_jama.html">scale_fill_jama</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Densidad"</span>, color <span class="op">=</span> <span class="st">"Diagnóstico"</span>",</span>
<span>       fill <span class="op">=</span> <span class="st">"Diagnóstico"</span><span class="op">)</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Densidades de 8 variables al azar (transformación con logaritmo en base 10)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Verificamos si existen valores ausentes. Se observan algunas filas con valores <code>NA</code>.</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss</a></span><span class="op">(</span><span class="va">mastitis</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Valores ausentes en el conjunto de datos</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Con la finalidad de evidenciar si existe algún patrón de asociación subyacente en el total de variables, se realizó análisis de componentes principales y se grafican los dos primeros componentes. No existe algún comportamiento de agrupación al reducir la dimensión a los dos primeros componentes. Se observó que la retención de variabilidad de estas dos coordenadas apenas alcanzó el 30% aproximadamente.</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Análisis de componentes principales</span>s</span>
<span><span class="va">datos_pca</span> <span class="op">&lt;-</span> <span class="va">mastitis</span></span>
<span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FactoMineR/man/PCA.html">PCA</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">datos_pca</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           scale.unit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           graph <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Agregando componentes a la base de datos</span></span>
<span><span class="va">datos_pca</span><span class="op">$</span><span class="va">cp1</span> <span class="op">&lt;-</span> <span class="va">pca</span><span class="op">$</span><span class="va">ind</span><span class="op">$</span><span class="va">coord</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">datos_pca</span><span class="op">$</span><span class="va">cp2</span> <span class="op">&lt;-</span> <span class="va">pca</span><span class="op">$</span><span class="va">ind</span><span class="op">$</span><span class="va">coord</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Gráfico de las 2 primeras componentes</span>s</span>
<span><span class="va">datos_pca</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cp1</span>, y <span class="op">=</span> <span class="va">cp2</span>, color <span class="op">=</span> <span class="va">diagnosis</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://nanx.me/ggsci/reference/scale_jama.html">scale_color_jama</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"CP1 (15.74 %)"</span>, y <span class="op">=</span> <span class="st">"CP2 (14.09 %)"</span>, color <span class="op">=</span> <span class="st">"Diagnóstico"</span><span class="op">)</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Componente principal 1 vs componente principal 2</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Los resultados exploratorios sugieren cuatro cosas importantes:
<ul>
<li>El problema de clasificación bajo análisis podría ser denominado de <em>clases balanceadas</em>, ya que las frecuencias absolutas son similares para cada nivel a predecir.</li>
<li>Algunas variables predictoras no tienen comportamiento gaussiano. Parte de la estrategia del análisis, en estos casos, podría ser la implementación de algún tipo de transformación previo al entrenamiento de los modelos, no obstante, este paso no se aplicará dada la robustez que presenta el algoritmo <em>XGBoost</em> frente a distribuciones asimétricas.</li>
<li>Existen observaciones con valores ausentes para una o más variables. Algunos algoritmos como la <em>regresión logística</em> o los <em>bosques aleatorios</em>, no permiten la inclusión de valores <code>NA</code> al entrenar los modelos, sin embargo, con <em>XGBoost</em> no existe este inconveniente, puesto que soporta valores vacíos.</li>
<li>El análisis de componentes principales no muestra alguna tendencia de agrupación entre las clases evaluadas. La retención de variabilidad de las tres primeras componentes no supera el 50%, resultado que podría sugerir que las relaciones de tipo lineal no son plausibles en este conjunto de datos.</li>
</ul>
</li>
</ul></section><section id="train-y-test" class="level2"><h2 class="anchored" data-anchor-id="train-y-test">Train y Test</h2>
<ul>
<li>En este ejemplo los datos fueron divididos en <em>train</em> y <em>test</em> con proporciones de 80 y 20 %, respectivamente. Se utiliza muestreo estratificado en función de la variable respuesta. Se eliminaron 4 variables que tienen información de fechas; aunque podrían ser tratadas de alguna manera especial, en este caso no fueron tenidas en cuenta.</li>
<li>La biblioteca <a href="https://rsample.tidymodels.org/"><code>rsample</code></a> permite realizar la división.</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Variables fechas</span></span>
<span><span class="va">variables_fechas</span> <span class="op">&lt;-</span> <span class="va">mastitis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">is.character</span>, <span class="op">-</span><span class="va">diagnosis</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Datos para modelos</span></span>
<span><span class="va">data_modelos</span> <span class="op">&lt;-</span> <span class="va">mastitis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">variables_fechas</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1992</span><span class="op">)</span></span>
<span><span class="va">particiones</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_modelos</span>, prop <span class="op">=</span> <span class="fl">0.80</span>, strata <span class="op">=</span> <span class="va">diagnosis</span><span class="op">)</span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">particiones</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">particiones</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Podemos ver el objeto <code>particiones</code> que proporciona información de la partición de datos. Los modelos son entrenados con 733 observaciones y con 181 se evalúa el desempeño de los mismos.</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">particiones</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;731/183/914&gt;</code></pre>
</div>
</div>
</section><section id="validación-cruzada" class="level2"><h2 class="anchored" data-anchor-id="validación-cruzada">Validación cruzada</h2>
<ul>
<li>Se utiliza validación cruzada <em>k-fold</em> con <span class="math inline">\(k = 10\)</span>.</li>
<li>La biblioteca <a href="https://rsample.tidymodels.org/"><code>rsample</code></a> permite configurar diferentes métodos de validación cruzada.</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1992</span><span class="op">)</span></span>
<span><span class="va">config_cv</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span>data <span class="op">=</span> <span class="va">train</span>, v <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="preprocesamiento" class="level2"><h2 class="anchored" data-anchor-id="preprocesamiento">Preprocesamiento</h2>
<ul>
<li>En este ejemplo no se hará énfasis en las estrategias de preprocesamiento o ingeniería de características, sin embargo, serán comparados algoritmos con imputación de valores ausentes (con método k vecinos más cercanos) respecto a algoritmos sin imputación.</li>
<li>La biblioteca <a href="https://recipes.tidymodels.org/"><code>recipes</code></a> permite realizar múltiples tareas de preprocesamiento e ingeniería de características.</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">no_impute</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">diagnosis</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">si_impute</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">diagnosis</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">step_impute_knn</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="modelo-xgboost" class="level2"><h2 class="anchored" data-anchor-id="modelo-xgboost">Modelo XGBoost</h2>
<ul>
<li>El algoritmo <em>XGboost</em> tiene múltiples hiperparámetros que pueden ser sintonizados, sin embargo, en este ejemplo sólo ser hará tuning sobre los siguientes:
<ul>
<li>
<code>mtry</code>: número de predictores que se muestrearán aleatoriamente en cada división al crear los modelos.</li>
<li>
<code>min_n</code>: número mínimo de observaciones requeridas en un nodo para que se produzca la división.</li>
<li>
<code>tree_depth</code>: profundidad máxima del árbol (número de divisiones).</li>
</ul>
</li>
<li>El número de árboles (<code>trees</code>) se estableció en 1000.</li>
<li>La tasa de aprendizaje (<code>learn_rate</code>) se estableció en 0.1.</li>
<li>La proporción de observaciones muestreadas (<code>sample_size</code>) en cada rutina de ajuste se estableció en 0.8.</li>
<li>Los demás hiperparámetros se mantienen por defecto.</li>
<li>Para más información acerca de los hiperparámetros que permite ajustar <a href="https://parsnip.tidymodels.org/"><code>parsnip</code></a>, consultar <a href="https://parsnip.tidymodels.org/reference/boost_tree.html">este enlace.</a>
</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelo_xgboost</span> <span class="op">&lt;-</span> <span class="fu">boost_tree</span><span class="op">(</span>mtry <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                             min_n <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                             tree_depth <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                             trees <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                             learn_rate <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                             sample_size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"xgboost"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="flujos-de-trabajo-pipelines" class="level2"><h2 class="anchored" data-anchor-id="flujos-de-trabajo-pipelines">Flujos de trabajo (<em>pipelines</em>)</h2>
<ul>
<li><p>Los flujos de trabajo son una manera flexible de trabajar con <em>tidymodels</em>. Se fundamenta en la misma idea de los <em>pipelines</em> de <a href="https://scikit-learn.org/stable/">scikit-learn</a> de Python. Es posible construir nuestro flujo de trabajo con recetas y modelos declarados previamente.</p></li>
<li><p>Consultar más información de la biblioteca <a href="https://workflows.tidymodels.org/">workflows.</a></p></li>
<li><p>Flujo de trabajo sin imputación:</p></li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wf_no_impute</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">no_impute</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">modelo_xgboost</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Flujo de trabajo con imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wf_si_impute</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">si_impute</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">modelo_xgboost</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="grid" class="level2"><h2 class="anchored" data-anchor-id="grid">Grid</h2>
<ul>
<li>En este caso se utiliza la cuadrícula a través de diseños de llenado de espacio (<em>space-filling designs</em>), los cuales intentan encontrar una configuración de puntos (combinaciones) que cubren el espacio de parámetros con menor probabilidad de valores que se traslapan. Para este ejemplo el tamaño de la cuadrícula fue de 10.</li>
<li>Para este caso particular se usan diseños de máxima entropía, descritos en el año 1987 por Shewry y Wynn en el artículo <em>“Maximum Entropy Sampling”.</em> También podrían ser implementados diseños de hipercubos latinos o diseños de proyección máxima. Si no se desea utilizar alguno de estos métodos, podría ser implementada una cuadrícula regular a través de métodos aleatorios (<em>grid random</em>).</li>
<li>Mayor información en la página web de la biblioteca <a href="https://dials.tidymodels.org/index.html">dials.</a>
</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Parámetros para tuning</span>g</span>
<span><span class="va">params_xgb</span> <span class="op">&lt;-</span> <span class="fu">parameters</span><span class="op">(</span></span>
<span>  <span class="fu">finalize</span><span class="op">(</span><span class="fu">mtry</span><span class="op">(</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu">min_n</span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">50L</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">tree_depth</span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3L</span>, <span class="fl">8L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Grid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span></span>
<span><span class="va">grid_xgb</span> <span class="op">&lt;-</span> <span class="va">params_xgb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">grid_max_entropy</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>A continuación se muestra la cuadrícula de búsqueda de los mejores hiperparámetros. Se evidencia que los puntos no se solapan, de tal manera que el espacio de búsqueda no es redundante.</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grid_xgb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.panel_x</span>, y <span class="op">=</span> <span class="va">.panel_y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggforce.data-imaginist.com/reference/facet_matrix.html">facet_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">mtry</span>, <span class="va">min_n</span>, <span class="va">tree_depth</span><span class="op">)</span>, layer.diag <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Cuadrícula de tamaño 10 con método de máxima entropía</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="tuning-con-tidymodels" class="level2"><h2 class="anchored" data-anchor-id="tuning-con-tidymodels">Tuning con <code>tidymodels</code>
</h2>
<ul>
<li>La función <code>tune_grid()</code> de la biblioteca <a href="https://tune.tidymodels.org/">tune</a> permite evaluar los modelos con cada combinación de paramétros establecidos previamente en la cuadrícula.</li>
<li>Tuning sin imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># Inicio Paralelización</span>n</span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span></span>
<span><span class="va">tuned_no_impute</span> <span class="op">&lt;-</span> <span class="fu">tune_grid</span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">wf_no_impute</span>,</span>
<span>  resamples <span class="op">=</span> <span class="va">config_cv</span>,</span>
<span>  grid <span class="op">=</span> <span class="va">grid_xgb</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">stopImplicitCluster</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fin Paralelización</span>n</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Tuning con imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># Inicio Paralelización</span>n</span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span></span>
<span><span class="va">tuned_si_impute</span> <span class="op">&lt;-</span> <span class="fu">tune_grid</span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">wf_si_impute</span>,</span>
<span>  resamples <span class="op">=</span> <span class="va">config_cv</span>,</span>
<span>  grid <span class="op">=</span> <span class="va">grid_xgb</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">stopImplicitCluster</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fin Paralelización</span>n</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">

</div>
</section><section id="resultados-accuracy" class="level2"><h2 class="anchored" data-anchor-id="resultados-accuracy">Resultados <em>Accuracy</em>
</h2>
<ul>
<li>Resultados de <em>Accuracy</em> en modelos sin imputación. La precisión más alta se consigue con aproximadamente 150 variables (<code>mtry</code>), menos de 10 observaciones para que se produzca la división del árbol (<code>min_n</code>) y profunidad de más o menos 6 (<code>tree_depth</code>).</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tuned_no_impute</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"accuracy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mtry</span>, y <span class="op">=</span> <span class="va">min_n</span>, size <span class="op">=</span> <span class="va">tree_depth</span>, color <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Accuracy"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="XGBoost_R_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Resultados de <em>Accuracy</em> en modelos con imputación. La precisión más alta se consigue con aproximadamente 25 variables (<code>mtry</code>), poco menos de 50 observaciones para que se produzca la división del árbol (<code>min_n</code>) y profunidad de más o menos 4 (<code>tree_depth</code>).</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tuned_si_impute</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"accuracy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mtry</span>, y <span class="op">=</span> <span class="va">min_n</span>, size <span class="op">=</span> <span class="va">tree_depth</span>, color <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Accuracy"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="XGBoost_R_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Se observa que los mejores hiperparámetros para los algoritmos entrenados con y sin imputación, discrepan considerablemente. Aunque en este caso realicé la evaluación del desempeño de los modelos basado en la métrica <em>Accuracy</em>, es posible utilizar cualquier otra para problemas de clasificación.</li>
</ul></section><section id="mejores-hiperparámetros" class="level2"><h2 class="anchored" data-anchor-id="mejores-hiperparámetros">Mejores hiperparámetros</h2>
<ul>
<li>Mejores hiperparámetros en modelos sin imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mejor_no_impute</span> <span class="op">&lt;-</span> <span class="va">tuned_no_impute</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select_best</span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"accuracy"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mejor_no_impute</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mtry"],"name":[1],"type":["int"],"align":["right"]},{"label":["min_n"],"name":[2],"type":["int"],"align":["right"]},{"label":["tree_depth"],"name":[3],"type":["int"],"align":["right"]},{"label":[".config"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"149","2":"9","3":"7","4":"Preprocessor1_Model09"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ul>
<li>Mejores hiperparámetros en modelos con imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mejor_si_impute</span> <span class="op">&lt;-</span> <span class="va">tuned_si_impute</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select_best</span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"accuracy"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mejor_si_impute</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mtry"],"name":[1],"type":["int"],"align":["right"]},{"label":["min_n"],"name":[2],"type":["int"],"align":["right"]},{"label":["tree_depth"],"name":[3],"type":["int"],"align":["right"]},{"label":[".config"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"25","2":"49","3":"5","4":"Preprocessor1_Model01"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="ajuste-final" class="level2"><h2 class="anchored" data-anchor-id="ajuste-final">Ajuste final</h2>
<ul>
<li>Modelo sin imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">final_no_impute</span> <span class="op">&lt;-</span> <span class="fu">finalize_workflow</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">wf_no_impute</span>,</span>
<span>  parameters <span class="op">=</span> <span class="va">mejor_no_impute</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span>data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Modelo con imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">final_si_impute</span> <span class="op">&lt;-</span> <span class="fu">finalize_workflow</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">wf_si_impute</span>,</span>
<span>  parameters <span class="op">=</span> <span class="va">mejor_si_impute</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span>data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="predicciones-train" class="level2"><h2 class="anchored" data-anchor-id="predicciones-train">Predicciones Train</h2>
<ul>
<li>Modelo sin imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_no_impute_train</span> <span class="op">&lt;-</span> <span class="va">final_no_impute</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="va">train</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Modelo con imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_si_impute_train</span> <span class="op">&lt;-</span> <span class="va">final_si_impute</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="va">train</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="predicciones-test" class="level2"><h2 class="anchored" data-anchor-id="predicciones-test">Predicciones Test</h2>
<ul>
<li>Modelo sin imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_no_impute_test</span> <span class="op">&lt;-</span> <span class="va">final_no_impute</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="va">test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Modelo con imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_si_impute_test</span> <span class="op">&lt;-</span> <span class="va">final_si_impute</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="va">test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="matriz-de-confusión-train" class="level2"><h2 class="anchored" data-anchor-id="matriz-de-confusión-train">Matriz de confusión Train</h2>
<ul>
<li>Matriz de confusión modelo sin imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  predicho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">pred_no_impute_train</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span>,</span>
<span>  real <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">train</span><span class="op">$</span><span class="va">diagnosis</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">real</span>, estimate <span class="op">=</span> <span class="va">predicho</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Prediction</span>, y <span class="op">=</span> <span class="va">Truth</span>, alpha <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Matriz de confusión en train - modelo sin imputación</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Matriz de confusión modelo con imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  predicho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">pred_si_impute_train</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span>,</span>
<span>  real <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">train</span><span class="op">$</span><span class="va">diagnosis</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">real</span>, estimate <span class="op">=</span> <span class="va">predicho</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Prediction</span>, y <span class="op">=</span> <span class="va">Truth</span>, alpha <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Matriz de confusión en train - modelo con imputación</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="matriz-de-confusión-test" class="level2"><h2 class="anchored" data-anchor-id="matriz-de-confusión-test">Matriz de confusión Test</h2>
<ul>
<li>Matriz de confusión modelo sin imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  predicho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">pred_no_impute_test</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span>,</span>
<span>  real <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">diagnosis</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">real</span>, estimate <span class="op">=</span> <span class="va">predicho</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Prediction</span>, y <span class="op">=</span> <span class="va">Truth</span>, alpha <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Matriz de confusión en test - modelo sin imputación</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Matriz de confusión modelo con imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  predicho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">pred_si_impute_test</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span>,</span>
<span>  real <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">diagnosis</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">real</span>, estimate <span class="op">=</span> <span class="va">predicho</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Prediction</span>, y <span class="op">=</span> <span class="va">Truth</span>, alpha <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Matriz de confusión en test - modelo con imputación</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="desempeño-de-modelos" class="level2"><h2 class="anchored" data-anchor-id="desempeño-de-modelos">Desempeño de modelos</h2>
<ul>
<li>Genero una base de datos con los resultados de las clases predichas en cada tipo de modelo (con y sin imputación) para los conjuntos de entrenamiento y prueba.</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tabla_accuracy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  predicho <span class="op">=</span> <span class="va">pred_no_impute_train</span><span class="op">$</span><span class="va">.pred_class</span>,</span>
<span>  real <span class="op">=</span> <span class="va">train</span><span class="op">$</span><span class="va">diagnosis</span>,</span>
<span>  datos <span class="op">=</span> <span class="st">"Train"</span>,</span>
<span>  tipo <span class="op">=</span> <span class="st">"Sin imputación"</span>"</span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>      predicho <span class="op">=</span> <span class="va">pred_si_impute_train</span><span class="op">$</span><span class="va">.pred_class</span>,</span>
<span>      real <span class="op">=</span> <span class="va">train</span><span class="op">$</span><span class="va">diagnosis</span>,</span>
<span>      datos <span class="op">=</span> <span class="st">"Train"</span>,</span>
<span>      tipo <span class="op">=</span> <span class="st">"Con imputación"</span>"</span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>      predicho <span class="op">=</span> <span class="va">pred_no_impute_test</span><span class="op">$</span><span class="va">.pred_class</span>,</span>
<span>      real <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">diagnosis</span>,</span>
<span>      datos <span class="op">=</span> <span class="st">"Test"</span>,</span>
<span>      tipo <span class="op">=</span> <span class="st">"Sin imputación"</span>"</span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>      predicho <span class="op">=</span> <span class="va">pred_si_impute_test</span><span class="op">$</span><span class="va">.pred_class</span>,</span>
<span>      real <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">diagnosis</span>,</span>
<span>      datos <span class="op">=</span> <span class="st">"Test"</span>,</span>
<span>      tipo <span class="op">=</span> <span class="st">"Con imputación"</span>"</span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tabla_accuracy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">datos</span>, <span class="va">tipo</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fu">accuracy_vec</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">real</span>, estimate <span class="op">=</span> <span class="va">predicho</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Accuracy en train y test para dos modelos XGBoost"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Accuracy en train y test para dos modelos XGBoost</caption>
<thead><tr class="header">
<th style="text-align: left;">datos</th>
<th style="text-align: left;">tipo</th>
<th style="text-align: right;">accuracy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Test</td>
<td style="text-align: left;">Con imputación</td>
<td style="text-align: right;">0.7540984</td>
</tr>
<tr class="even">
<td style="text-align: left;">Test</td>
<td style="text-align: left;">Sin imputación</td>
<td style="text-align: right;">0.7814208</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Train</td>
<td style="text-align: left;">Con imputación</td>
<td style="text-align: right;">0.8481532</td>
</tr>
<tr class="even">
<td style="text-align: left;">Train</td>
<td style="text-align: left;">Sin imputación</td>
<td style="text-align: right;">0.9972640</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Gráfico <em>Accuracy:</em> la capacidad predictiva es superior en el modelo que fue entrenado sin acudir a la imputación de datos.</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tabla_accuracy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">datos</span>, <span class="va">tipo</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fu">accuracy_vec</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">real</span>, estimate <span class="op">=</span> <span class="va">predicho</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tipo</span>, y <span class="op">=</span> <span class="va">accuracy</span>, color <span class="op">=</span> <span class="va">datos</span>, fill <span class="op">=</span> <span class="va">datos</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://nanx.me/ggsci/reference/scale_jama.html">scale_color_jama</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://nanx.me/ggsci/reference/scale_jama.html">scale_fill_jama</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Preprocesamiento"</span>, y <span class="op">=</span> <span class="st">"Accuracy"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">""</span>, fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Accuracy en train y test para dos modelos XGBoost</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="importancia-de-variables" class="level2"><h2 class="anchored" data-anchor-id="importancia-de-variables">Importancia de variables</h2>
<ul>
<li>10 variables de mayor importancia en modelo sin imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">final_no_impute</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">pull_workflow_fit</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/vip/man/vip.html">vip</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Importancia de variables - modelo sin imputación</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>10 variables de mayor importancia en modelo sin imputación:</li>
</ul>
<div class="cell">
<details><summary>Código</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">final_si_impute</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">pull_workflow_fit</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/vip/man/vip.html">vip</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="XGBoost_R_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Importancia de variables - modelo con imputación</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section></section><section id="referencias" class="level1"><h1>Referencias</h1>
<ul>
<li>Hyde, R.M., Down, P.M., Bradley, A.J. et al.&nbsp;<em>“Automated prediction of mastitis infection patterns in dairy herds using machine learning”</em>. Sci Rep 10, 4289 (2020). https://doi.org/10.1038/s41598-020-61126-8</li>
<li>Chen Tianqi, Guestrin Carlos. <em>“XGBoost: A Scalable Tree Boosting System”</em>. CoRR, Vol 1603.02754 (2016). https://arxiv.org/abs/1603.02754</li>
<li>Boehmke Bradley, Greenwell Brandon. <em>“Hands-On Machine Learning with R”</em>. Chapman and Hall/CRC (2019). https://bradleyboehmke.github.io/HOML/gbm.html</li>
<li>Shewry, M, and H Wynn. <em>“Maximum Entropy Sampling.”</em> Journal of Applied Statistics 14 (2): 165–70 (1987). https://doi.org/10.1080/02664768700000020</li>
<li>Kuhn Max, Silge Julia. <em>“Tidy Modeling with R”</em>. (2020). https://www.tmwr.org/</li>
</ul>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Correr el código</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb38" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "XGBoost con R"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Edimer (Sidereus)"</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "05-01-2021"</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Algortimo XGBoost con R para resolver problemas de aprendizaje supervisado (clasificación)."</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - R</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - xgboost</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - Gradient Boosting</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - ML</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "img2.png "</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="an">lang:</span><span class="co"> es</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="an">css:</span><span class="co"> estilo.css</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "Tabla de contenido"</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 4</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: github</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: </span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true </span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true </span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Learn more about creating blogs with Distill at:</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="co"># https://rstudio.github.io/distill/blog.html</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="fu">## Documentación `xgboost`</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Documentación oficial `xgboost`</span><span class="co">](https://xgboost.readthedocs.io/en/latest/#)</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Biblioteca `xgboost` en R</span><span class="co">](https://cran.r-project.org/web/packages/xgboost/xgboost.pdf)</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Tutorial de `xgboost` en R</span><span class="co">](https://xgboost.readthedocs.io/en/latest/R-package/xgboostPresentation.html)</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a><span class="fu"># Datos de ejemplo</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>En este documento se muestra cómo implementar el algoritmo *XGBoost* con R a través de la biblioteca que lleva el mismo nombre y haciendo uso del [`tidymodels`.](https://www.tidymodels.org/) Para ejemplificar el ajuste de *modelos de clasificación* se obtuvieron datos de ejemplo aplicado en ciencias animales, específicamente en la detección de patrones de infección de mastitis en vacas.</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a><span class="fu">## Detección de mastitis</span></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Artículo publicado en PLOS ONE</span><span class="co">](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0249136)</span></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;</span></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span> <span class="ot">=</span> <span class="st">"img/paper_classification.PNG"</span> <span class="er">width</span> <span class="ot">=</span> <span class="st">750</span><span class="kw">/&gt;</span></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/center&gt;</span></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a><span class="fu"># Requisitos previos</span></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Para replicar este documento es necesario instalar las siguientes bibliotecas:</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`tidyverse`:** manipulación  y visualización de datos.</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`readxl`:** lectura de datos en formato de Excel.</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`janitor`:** manipulación de datos.</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`visdat`:** análisis exploratorio de datos. </span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`tidymodels`:** entrenamiento y evaluación de modelos de machine learning.</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`xgboost`:** algoritmo <span class="in">`xgboost`</span>. </span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`doParallel`:** procesamiento en paralelo (cómputo distribuido).</span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`parallel`** procesamiento en paralelo (cómputo distribuido).</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`vip`:** calcular importancia de variables.</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`ggsci`:** paletas de colores.</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`ggforce`** complemento para gráficos.</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`FactoMineR`:** análisis multivariado.</span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**`knitr`:** presentación de tablas (<span class="in">`data.frame`</span>).</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Descargar los datos para ejemplo:</span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="co">[</span><span class="ot">Datos para detección de mastitis</span><span class="co">](https://www.nature.com/articles/s41598-020-61126-8#Sec15)</span></span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Nota:** es importante mencionar que cuando cargamos la *meta-biblioteca* <span class="in">`tidymodels`</span> se activan otras bibliotecas que usaremos más adelante.</span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a><span class="fu"># Bibliotecas</span></span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)</span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsci)</span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a><span class="fu"># Tema para `ggplot2`</span></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a>mi_temagg <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"gray5"</span>),</span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(mi_temagg)</span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-111"><a href="#cb38-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-112"><a href="#cb38-112" aria-hidden="true" tabindex="-1"></a><span class="fu"># Detección de mastitis</span></span>
<span id="cb38-113"><a href="#cb38-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-114"><a href="#cb38-114" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La variable respuesta está identificada como <span class="in">`diagnosis`</span>. En principio tiene 4 niveles, sin embargo, para el ejemplo fueron filtrados sólo los niveles <span class="in">`EDP`</span> (transmisión en el período seco - sin lactancia) y <span class="in">`EL`</span> (transmisión en período de lactancia).</span>
<span id="cb38-115"><a href="#cb38-115" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La base de datos consta de 1000 observaciones y 229 variables, es decir, que existen 228 variables predictoras. Cuando se aplicó el filtro quedaron 914 observaciones.</span>
<span id="cb38-116"><a href="#cb38-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-117"><a href="#cb38-117" aria-hidden="true" tabindex="-1"></a><span class="fu">## Base de datos</span></span>
<span id="cb38-118"><a href="#cb38-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-121"><a href="#cb38-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-122"><a href="#cb38-122" aria-hidden="true" tabindex="-1"></a>mastitis <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/mastitis.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-123"><a href="#cb38-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-124"><a href="#cb38-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(diagnosis <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"EDP"</span>, <span class="st">"EL"</span>))</span>
<span id="cb38-125"><a href="#cb38-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-126"><a href="#cb38-126" aria-hidden="true" tabindex="-1"></a>mastitis <span class="sc">%&gt;%</span> </span>
<span id="cb38-127"><a href="#cb38-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(diagnosis, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-128"><a href="#cb38-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-129"><a href="#cb38-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"6 primeras filas de la base de datos con 6 columnas"</span>)</span>
<span id="cb38-130"><a href="#cb38-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-131"><a href="#cb38-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-132"><a href="#cb38-132" aria-hidden="true" tabindex="-1"></a><span class="fu">## Análisis exploratorio</span></span>
<span id="cb38-133"><a href="#cb38-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-134"><a href="#cb38-134" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Frecuencia absoluta para niveles de la variable respuesta.</span>
<span id="cb38-135"><a href="#cb38-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-136"><a href="#cb38-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Frecuencia absoluta de variable respuesta"}</span></span>
<span id="cb38-137"><a href="#cb38-137" aria-hidden="true" tabindex="-1"></a>mastitis <span class="sc">%&gt;%</span> </span>
<span id="cb38-138"><a href="#cb38-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(diagnosis) <span class="sc">%&gt;%</span> </span>
<span id="cb38-139"><a href="#cb38-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diagnosis, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb38-140"><a href="#cb38-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"dodgerblue3"</span>, <span class="at">fill =</span> <span class="st">"dodgerblue3"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-141"><a href="#cb38-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> n)) <span class="sc">+</span></span>
<span id="cb38-142"><a href="#cb38-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Diagnóstico"</span>, <span class="at">y =</span> <span class="st">"Frecuencia"</span>)</span>
<span id="cb38-143"><a href="#cb38-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-144"><a href="#cb38-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-145"><a href="#cb38-145" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Distribuciones de algunas variables numéricas: como el número de variables es alto, selecciono al azar 8 de ellas para construir el gráfico.</span>
<span id="cb38-146"><a href="#cb38-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-147"><a href="#cb38-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,fig.width=8, fig.cap="Densidades de 8 variables al azar (transformación con logaritmo en base 10)", fig.height=4.5}</span></span>
<span id="cb38-148"><a href="#cb38-148" aria-hidden="true" tabindex="-1"></a><span class="co"># Números al azar</span></span>
<span id="cb38-149"><a href="#cb38-149" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1992</span>)</span>
<span id="cb38-150"><a href="#cb38-150" aria-hidden="true" tabindex="-1"></a>variables_azar <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">228</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-151"><a href="#cb38-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-152"><a href="#cb38-152" aria-hidden="true" tabindex="-1"></a>mastitis <span class="sc">%&gt;%</span> </span>
<span id="cb38-153"><a href="#cb38-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(diagnosis, variables_azar) <span class="sc">%&gt;%</span> </span>
<span id="cb38-154"><a href="#cb38-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>diagnosis) <span class="sc">%&gt;%</span> </span>
<span id="cb38-155"><a href="#cb38-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> diagnosis, <span class="at">color =</span> diagnosis)) <span class="sc">+</span></span>
<span id="cb38-156"><a href="#cb38-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb38-157"><a href="#cb38-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-158"><a href="#cb38-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb38-159"><a href="#cb38-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_jama</span>() <span class="sc">+</span></span>
<span id="cb38-160"><a href="#cb38-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_jama</span>() <span class="sc">+</span></span>
<span id="cb38-161"><a href="#cb38-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Densidad"</span>, <span class="at">color =</span> <span class="st">"Diagnóstico"</span>,</span>
<span id="cb38-162"><a href="#cb38-162" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Diagnóstico"</span>)</span>
<span id="cb38-163"><a href="#cb38-163" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-164"><a href="#cb38-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-165"><a href="#cb38-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-166"><a href="#cb38-166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Verificamos si existen valores ausentes. Se observan algunas filas con valores <span class="in">`NA`</span>.</span>
<span id="cb38-167"><a href="#cb38-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-168"><a href="#cb38-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=8, fig.height=6, fig.cap="Valores ausentes en el conjunto de datos"}</span></span>
<span id="cb38-169"><a href="#cb38-169" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(mastitis)</span>
<span id="cb38-170"><a href="#cb38-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-171"><a href="#cb38-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-172"><a href="#cb38-172" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Con la finalidad de evidenciar si existe algún patrón de asociación subyacente en el total de variables, se realizó análisis de componentes principales y se grafican los dos primeros componentes. No existe algún comportamiento de agrupación al reducir la dimensión a los dos primeros componentes. Se observó que la retención de variabilidad de estas dos coordenadas apenas alcanzó el 30% aproximadamente.</span>
<span id="cb38-173"><a href="#cb38-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-174"><a href="#cb38-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Componente principal 1 vs componente principal 2"}</span></span>
<span id="cb38-175"><a href="#cb38-175" aria-hidden="true" tabindex="-1"></a><span class="co"># Análisis de componentes principales</span></span>
<span id="cb38-176"><a href="#cb38-176" aria-hidden="true" tabindex="-1"></a>datos_pca <span class="ot">&lt;-</span> mastitis</span>
<span id="cb38-177"><a href="#cb38-177" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">PCA</span>(<span class="at">X =</span> datos_pca <span class="sc">%&gt;%</span></span>
<span id="cb38-178"><a href="#cb38-178" aria-hidden="true" tabindex="-1"></a>             <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)),</span>
<span id="cb38-179"><a href="#cb38-179" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale.unit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-180"><a href="#cb38-180" aria-hidden="true" tabindex="-1"></a>           <span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-181"><a href="#cb38-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-182"><a href="#cb38-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregando componentes a la base de datos</span></span>
<span id="cb38-183"><a href="#cb38-183" aria-hidden="true" tabindex="-1"></a>datos_pca<span class="sc">$</span>cp1 <span class="ot">&lt;-</span> pca<span class="sc">$</span>ind<span class="sc">$</span>coord[, <span class="dv">1</span>]</span>
<span id="cb38-184"><a href="#cb38-184" aria-hidden="true" tabindex="-1"></a>datos_pca<span class="sc">$</span>cp2 <span class="ot">&lt;-</span> pca<span class="sc">$</span>ind<span class="sc">$</span>coord[, <span class="dv">2</span>]</span>
<span id="cb38-185"><a href="#cb38-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-186"><a href="#cb38-186" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de las 2 primeras componentes</span></span>
<span id="cb38-187"><a href="#cb38-187" aria-hidden="true" tabindex="-1"></a>datos_pca <span class="sc">%&gt;%</span> </span>
<span id="cb38-188"><a href="#cb38-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cp1, <span class="at">y =</span> cp2, <span class="at">color =</span> diagnosis)) <span class="sc">+</span></span>
<span id="cb38-189"><a href="#cb38-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-190"><a href="#cb38-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb38-191"><a href="#cb38-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb38-192"><a href="#cb38-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_jama</span>() <span class="sc">+</span></span>
<span id="cb38-193"><a href="#cb38-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"CP1 (15.74 %)"</span>, <span class="at">y =</span> <span class="st">"CP2 (14.09 %)"</span>, <span class="at">color =</span> <span class="st">"Diagnóstico"</span>)</span>
<span id="cb38-194"><a href="#cb38-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-195"><a href="#cb38-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-196"><a href="#cb38-196" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Los resultados exploratorios sugieren cuatro cosas importantes:</span>
<span id="cb38-197"><a href="#cb38-197" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>El problema de clasificación bajo análisis podría ser denominado de *clases balanceadas*, ya que las frecuencias absolutas son similares para cada nivel a predecir.</span>
<span id="cb38-198"><a href="#cb38-198" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Algunas variables predictoras no tienen comportamiento gaussiano. Parte de la estrategia del análisis, en estos casos, podría ser la implementación de algún tipo de transformación previo al entrenamiento de los modelos, no obstante, este paso no se aplicará dada la robustez que presenta el algoritmo *XGBoost* frente a distribuciones asimétricas.</span>
<span id="cb38-199"><a href="#cb38-199" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Existen observaciones con valores ausentes para una o más variables. Algunos algoritmos como la *regresión logística* o los *bosques aleatorios*, no permiten la inclusión de valores `NA` al entrenar los modelos, sin embargo, con *XGBoost* no existe este inconveniente, puesto que soporta valores vacíos.</span>
<span id="cb38-200"><a href="#cb38-200" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>El análisis de componentes principales no muestra alguna tendencia de agrupación entre las clases evaluadas. La retención de variabilidad de las tres primeras componentes no supera el 50%, resultado que podría sugerir que las relaciones de tipo lineal no son plausibles en este conjunto de datos.</span>
<span id="cb38-201"><a href="#cb38-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-202"><a href="#cb38-202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Train y Test</span></span>
<span id="cb38-203"><a href="#cb38-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-204"><a href="#cb38-204" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>En este ejemplo los datos fueron divididos en *train* y *test* con proporciones de 80 y 20 %, respectivamente. Se utiliza muestreo estratificado en función de la variable respuesta. Se eliminaron 4 variables que tienen información de fechas; aunque podrían ser tratadas de alguna manera especial, en este caso no fueron tenidas en cuenta.</span>
<span id="cb38-205"><a href="#cb38-205" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La biblioteca <span class="co">[</span><span class="ot">`rsample`</span><span class="co">](https://rsample.tidymodels.org/)</span> permite realizar la división.</span>
<span id="cb38-206"><a href="#cb38-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-209"><a href="#cb38-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-210"><a href="#cb38-210" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables fechas</span></span>
<span id="cb38-211"><a href="#cb38-211" aria-hidden="true" tabindex="-1"></a>variables_fechas <span class="ot">&lt;-</span> mastitis <span class="sc">%&gt;%</span> </span>
<span id="cb38-212"><a href="#cb38-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(is.character, <span class="sc">-</span>diagnosis) <span class="sc">%&gt;%</span> </span>
<span id="cb38-213"><a href="#cb38-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb38-214"><a href="#cb38-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-215"><a href="#cb38-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos para modelos</span></span>
<span id="cb38-216"><a href="#cb38-216" aria-hidden="true" tabindex="-1"></a>data_modelos <span class="ot">&lt;-</span> mastitis <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>variables_fechas)</span>
<span id="cb38-217"><a href="#cb38-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-218"><a href="#cb38-218" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1992</span>)</span>
<span id="cb38-219"><a href="#cb38-219" aria-hidden="true" tabindex="-1"></a>particiones <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> data_modelos, <span class="at">prop =</span> <span class="fl">0.80</span>, <span class="at">strata =</span> diagnosis)</span>
<span id="cb38-220"><a href="#cb38-220" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">training</span>(particiones)</span>
<span id="cb38-221"><a href="#cb38-221" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">testing</span>(particiones)</span>
<span id="cb38-222"><a href="#cb38-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-223"><a href="#cb38-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-224"><a href="#cb38-224" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Podemos ver el objeto <span class="in">`particiones`</span> que proporciona información de la partición de datos. Los modelos son entrenados con 733 observaciones y con 181 se evalúa el desempeño de los mismos.</span>
<span id="cb38-225"><a href="#cb38-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-228"><a href="#cb38-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-229"><a href="#cb38-229" aria-hidden="true" tabindex="-1"></a>particiones</span>
<span id="cb38-230"><a href="#cb38-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-231"><a href="#cb38-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-232"><a href="#cb38-232" aria-hidden="true" tabindex="-1"></a><span class="fu">## Validación cruzada</span></span>
<span id="cb38-233"><a href="#cb38-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-234"><a href="#cb38-234" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Se utiliza validación cruzada *k-fold* con $k = 10$.</span>
<span id="cb38-235"><a href="#cb38-235" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La biblioteca <span class="co">[</span><span class="ot">`rsample`</span><span class="co">](https://rsample.tidymodels.org/)</span> permite configurar diferentes métodos de validación cruzada.</span>
<span id="cb38-236"><a href="#cb38-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-239"><a href="#cb38-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-240"><a href="#cb38-240" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1992</span>)</span>
<span id="cb38-241"><a href="#cb38-241" aria-hidden="true" tabindex="-1"></a>config_cv <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(<span class="at">data =</span> train, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb38-242"><a href="#cb38-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-243"><a href="#cb38-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-244"><a href="#cb38-244" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preprocesamiento</span></span>
<span id="cb38-245"><a href="#cb38-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-246"><a href="#cb38-246" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>En este ejemplo no se hará énfasis en las estrategias de preprocesamiento o ingeniería de características, sin embargo, serán comparados algoritmos con imputación de valores ausentes (con método k vecinos más cercanos) respecto a algoritmos sin imputación. </span>
<span id="cb38-247"><a href="#cb38-247" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La biblioteca <span class="co">[</span><span class="ot">`recipes`</span><span class="co">](https://recipes.tidymodels.org/)</span> permite realizar múltiples tareas de preprocesamiento e ingeniería de características.</span>
<span id="cb38-248"><a href="#cb38-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-251"><a href="#cb38-251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-252"><a href="#cb38-252" aria-hidden="true" tabindex="-1"></a>no_impute <span class="ot">&lt;-</span> <span class="fu">recipe</span>(diagnosis <span class="sc">~</span> ., <span class="at">data =</span> train)</span>
<span id="cb38-253"><a href="#cb38-253" aria-hidden="true" tabindex="-1"></a>si_impute <span class="ot">&lt;-</span> <span class="fu">recipe</span>(diagnosis <span class="sc">~</span> ., <span class="at">data =</span> train) <span class="sc">%&gt;%</span> </span>
<span id="cb38-254"><a href="#cb38-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_knn</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb38-255"><a href="#cb38-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-256"><a href="#cb38-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-257"><a href="#cb38-257" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modelo XGBoost</span></span>
<span id="cb38-258"><a href="#cb38-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-259"><a href="#cb38-259" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>El algoritmo *XGboost* tiene múltiples hiperparámetros que pueden ser sintonizados, sin embargo, en este ejemplo sólo ser hará tuning sobre los siguientes:</span>
<span id="cb38-260"><a href="#cb38-260" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`mtry`</span>: número de predictores que se muestrearán aleatoriamente en cada división al crear los modelos.</span>
<span id="cb38-261"><a href="#cb38-261" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`min_n`</span>: número mínimo de observaciones requeridas en un nodo para que se produzca la división.</span>
<span id="cb38-262"><a href="#cb38-262" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`tree_depth`</span>: profundidad máxima del árbol (número de divisiones).</span>
<span id="cb38-263"><a href="#cb38-263" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>El número de árboles (<span class="in">`trees`</span>) se estableció en 1000.</span>
<span id="cb38-264"><a href="#cb38-264" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La tasa de aprendizaje (<span class="in">`learn_rate`</span>) se estableció en 0.1.</span>
<span id="cb38-265"><a href="#cb38-265" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La proporción de observaciones muestreadas (<span class="in">`sample_size`</span>) en cada rutina de ajuste se estableció en 0.8.</span>
<span id="cb38-266"><a href="#cb38-266" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Los demás hiperparámetros se mantienen por defecto.</span>
<span id="cb38-267"><a href="#cb38-267" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Para más información acerca de los hiperparámetros que permite ajustar <span class="co">[</span><span class="ot">`parsnip`</span><span class="co">](https://parsnip.tidymodels.org/)</span>, consultar <span class="co">[</span><span class="ot">este enlace.</span><span class="co">](https://parsnip.tidymodels.org/reference/boost_tree.html)</span></span>
<span id="cb38-268"><a href="#cb38-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-271"><a href="#cb38-271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-272"><a href="#cb38-272" aria-hidden="true" tabindex="-1"></a>modelo_xgboost <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(),</span>
<span id="cb38-273"><a href="#cb38-273" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_n =</span> <span class="fu">tune</span>(),</span>
<span id="cb38-274"><a href="#cb38-274" aria-hidden="true" tabindex="-1"></a>                             <span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb38-275"><a href="#cb38-275" aria-hidden="true" tabindex="-1"></a>                             <span class="at">trees =</span> <span class="dv">1000</span>,</span>
<span id="cb38-276"><a href="#cb38-276" aria-hidden="true" tabindex="-1"></a>                             <span class="at">learn_rate =</span> <span class="fl">0.1</span>,</span>
<span id="cb38-277"><a href="#cb38-277" aria-hidden="true" tabindex="-1"></a>                             <span class="at">sample_size =</span> <span class="fl">0.8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-278"><a href="#cb38-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-279"><a href="#cb38-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb38-280"><a href="#cb38-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-281"><a href="#cb38-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-282"><a href="#cb38-282" aria-hidden="true" tabindex="-1"></a><span class="fu">## Flujos de trabajo (*pipelines*)</span></span>
<span id="cb38-283"><a href="#cb38-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-284"><a href="#cb38-284" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Los flujos de trabajo son una manera flexible de trabajar con *tidymodels*. Se fundamenta en la misma idea de los *pipelines* de <span class="co">[</span><span class="ot">scikit-learn</span><span class="co">](https://scikit-learn.org/stable/)</span> de Python. Es posible construir nuestro flujo de trabajo con recetas y modelos declarados previamente.</span>
<span id="cb38-285"><a href="#cb38-285" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Consultar más información de la biblioteca <span class="co">[</span><span class="ot">workflows.</span><span class="co">](https://workflows.tidymodels.org/)</span> </span>
<span id="cb38-286"><a href="#cb38-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-287"><a href="#cb38-287" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Flujo de trabajo sin imputación:</span>
<span id="cb38-288"><a href="#cb38-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-291"><a href="#cb38-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-292"><a href="#cb38-292" aria-hidden="true" tabindex="-1"></a>wf_no_impute <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-293"><a href="#cb38-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(no_impute) <span class="sc">%&gt;%</span> </span>
<span id="cb38-294"><a href="#cb38-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(modelo_xgboost)</span>
<span id="cb38-295"><a href="#cb38-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-296"><a href="#cb38-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-297"><a href="#cb38-297" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Flujo de trabajo con imputación:</span>
<span id="cb38-298"><a href="#cb38-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-301"><a href="#cb38-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-302"><a href="#cb38-302" aria-hidden="true" tabindex="-1"></a>wf_si_impute <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-303"><a href="#cb38-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(si_impute) <span class="sc">%&gt;%</span> </span>
<span id="cb38-304"><a href="#cb38-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(modelo_xgboost)</span>
<span id="cb38-305"><a href="#cb38-305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-306"><a href="#cb38-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-307"><a href="#cb38-307" aria-hidden="true" tabindex="-1"></a><span class="fu">## Grid </span></span>
<span id="cb38-308"><a href="#cb38-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-309"><a href="#cb38-309" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>En este caso se utiliza la cuadrícula a través de diseños de llenado de espacio (*space-filling designs*), los cuales intentan encontrar una configuración de puntos (combinaciones) que cubren el espacio de parámetros con menor probabilidad de valores que se traslapan. Para este ejemplo el tamaño de la cuadrícula fue de 10.</span>
<span id="cb38-310"><a href="#cb38-310" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Para este caso particular se usan diseños de máxima entropía, descritos en el año 1987 por Shewry y Wynn en el artículo *"Maximum Entropy Sampling".* También podrían ser implementados diseños de hipercubos latinos o diseños de proyección máxima. Si no se desea utilizar alguno de estos métodos, podría ser implementada una cuadrícula regular a través de métodos aleatorios (*grid random*).</span>
<span id="cb38-311"><a href="#cb38-311" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Mayor información en la página web de la biblioteca <span class="co">[</span><span class="ot">dials.</span><span class="co">](https://dials.tidymodels.org/index.html)</span></span>
<span id="cb38-312"><a href="#cb38-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-315"><a href="#cb38-315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-316"><a href="#cb38-316" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros para tuning</span></span>
<span id="cb38-317"><a href="#cb38-317" aria-hidden="true" tabindex="-1"></a>params_xgb <span class="ot">&lt;-</span> <span class="fu">parameters</span>(</span>
<span id="cb38-318"><a href="#cb38-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize</span>(<span class="fu">mtry</span>(), <span class="at">x =</span> train[, <span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb38-319"><a href="#cb38-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min_n</span>(<span class="at">range =</span> <span class="fu">c</span>(2L, 50L)),</span>
<span id="cb38-320"><a href="#cb38-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tree_depth</span>(<span class="at">range =</span> <span class="fu">c</span>(3L, 8L))</span>
<span id="cb38-321"><a href="#cb38-321" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-322"><a href="#cb38-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-323"><a href="#cb38-323" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid</span></span>
<span id="cb38-324"><a href="#cb38-324" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2021</span>)</span>
<span id="cb38-325"><a href="#cb38-325" aria-hidden="true" tabindex="-1"></a>grid_xgb <span class="ot">&lt;-</span> params_xgb <span class="sc">%&gt;%</span> </span>
<span id="cb38-326"><a href="#cb38-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grid_max_entropy</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb38-327"><a href="#cb38-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-328"><a href="#cb38-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-329"><a href="#cb38-329" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A continuación se muestra la cuadrícula de búsqueda de los mejores hiperparámetros. Se evidencia que los puntos no se solapan, de tal manera que el espacio de búsqueda no es redundante.</span>
<span id="cb38-330"><a href="#cb38-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-331"><a href="#cb38-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Cuadrícula de tamaño 10 con método de máxima entropía"}</span></span>
<span id="cb38-332"><a href="#cb38-332" aria-hidden="true" tabindex="-1"></a>grid_xgb <span class="sc">%&gt;%</span> </span>
<span id="cb38-333"><a href="#cb38-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .panel_x, <span class="at">y =</span> .panel_y)) <span class="sc">+</span></span>
<span id="cb38-334"><a href="#cb38-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_matrix</span>(<span class="fu">vars</span>(mtry, min_n, tree_depth), <span class="at">layer.diag =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb38-335"><a href="#cb38-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb38-336"><a href="#cb38-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-337"><a href="#cb38-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-338"><a href="#cb38-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-339"><a href="#cb38-339" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tuning con `tidymodels`</span></span>
<span id="cb38-340"><a href="#cb38-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-341"><a href="#cb38-341" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La función <span class="in">`tune_grid()`</span> de la biblioteca <span class="co">[</span><span class="ot">tune</span><span class="co">](https://tune.tidymodels.org/)</span> permite evaluar los modelos con cada combinación de paramétros establecidos previamente en la cuadrícula.</span>
<span id="cb38-342"><a href="#cb38-342" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Tuning sin imputación:</span>
<span id="cb38-343"><a href="#cb38-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-344"><a href="#cb38-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb38-345"><a href="#cb38-345" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># Inicio Paralelización</span></span>
<span id="cb38-346"><a href="#cb38-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-347"><a href="#cb38-347" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2021</span>)</span>
<span id="cb38-348"><a href="#cb38-348" aria-hidden="true" tabindex="-1"></a>tuned_no_impute <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(</span>
<span id="cb38-349"><a href="#cb38-349" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> wf_no_impute,</span>
<span id="cb38-350"><a href="#cb38-350" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> config_cv,</span>
<span id="cb38-351"><a href="#cb38-351" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> grid_xgb</span>
<span id="cb38-352"><a href="#cb38-352" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-353"><a href="#cb38-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-354"><a href="#cb38-354" aria-hidden="true" tabindex="-1"></a><span class="fu">stopImplicitCluster</span>() <span class="co"># Fin Paralelización</span></span>
<span id="cb38-355"><a href="#cb38-355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-356"><a href="#cb38-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-357"><a href="#cb38-357" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Tuning con imputación:</span>
<span id="cb38-358"><a href="#cb38-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-359"><a href="#cb38-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb38-360"><a href="#cb38-360" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># Inicio Paralelización</span></span>
<span id="cb38-361"><a href="#cb38-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-362"><a href="#cb38-362" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2021</span>)</span>
<span id="cb38-363"><a href="#cb38-363" aria-hidden="true" tabindex="-1"></a>tuned_si_impute <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(</span>
<span id="cb38-364"><a href="#cb38-364" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> wf_si_impute,</span>
<span id="cb38-365"><a href="#cb38-365" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> config_cv,</span>
<span id="cb38-366"><a href="#cb38-366" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> grid_xgb</span>
<span id="cb38-367"><a href="#cb38-367" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-368"><a href="#cb38-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-369"><a href="#cb38-369" aria-hidden="true" tabindex="-1"></a><span class="fu">stopImplicitCluster</span>() <span class="co"># Fin Paralelización</span></span>
<span id="cb38-370"><a href="#cb38-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-371"><a href="#cb38-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-372"><a href="#cb38-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb38-373"><a href="#cb38-373" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"tune_no_impute.Rdata"</span>)</span>
<span id="cb38-374"><a href="#cb38-374" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"tune_si_impute.Rdata"</span>)</span>
<span id="cb38-375"><a href="#cb38-375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-376"><a href="#cb38-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-377"><a href="#cb38-377" aria-hidden="true" tabindex="-1"></a><span class="fu">## Resultados *Accuracy*</span></span>
<span id="cb38-378"><a href="#cb38-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-379"><a href="#cb38-379" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Resultados de *Accuracy* en modelos sin imputación. La precisión más alta se consigue con aproximadamente 150 variables (<span class="in">`mtry`</span>), menos de 10 observaciones para que se produzca la división del árbol (<span class="in">`min_n`</span>) y profunidad de más o menos 6 (<span class="in">`tree_depth`</span>).</span>
<span id="cb38-380"><a href="#cb38-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-383"><a href="#cb38-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-384"><a href="#cb38-384" aria-hidden="true" tabindex="-1"></a>tuned_no_impute <span class="sc">%&gt;%</span> </span>
<span id="cb38-385"><a href="#cb38-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-386"><a href="#cb38-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"accuracy"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-387"><a href="#cb38-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mtry, <span class="at">y =</span> min_n, <span class="at">size =</span> tree_depth, <span class="at">color =</span> mean)) <span class="sc">+</span></span>
<span id="cb38-388"><a href="#cb38-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-389"><a href="#cb38-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb38-390"><a href="#cb38-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Accuracy"</span>)</span>
<span id="cb38-391"><a href="#cb38-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-392"><a href="#cb38-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-393"><a href="#cb38-393" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Resultados de *Accuracy* en modelos con imputación. La precisión más alta se consigue con aproximadamente 25 variables (<span class="in">`mtry`</span>), poco menos de 50 observaciones para que se produzca la división del árbol (<span class="in">`min_n`</span>) y profunidad de más o menos 4 (<span class="in">`tree_depth`</span>).</span>
<span id="cb38-394"><a href="#cb38-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-397"><a href="#cb38-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-398"><a href="#cb38-398" aria-hidden="true" tabindex="-1"></a>tuned_si_impute <span class="sc">%&gt;%</span> </span>
<span id="cb38-399"><a href="#cb38-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-400"><a href="#cb38-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"accuracy"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-401"><a href="#cb38-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mtry, <span class="at">y =</span> min_n, <span class="at">size =</span> tree_depth, <span class="at">color =</span> mean)) <span class="sc">+</span></span>
<span id="cb38-402"><a href="#cb38-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-403"><a href="#cb38-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb38-404"><a href="#cb38-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Accuracy"</span>)</span>
<span id="cb38-405"><a href="#cb38-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-406"><a href="#cb38-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-407"><a href="#cb38-407" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Se observa que los mejores hiperparámetros para los algoritmos entrenados con y sin imputación, discrepan considerablemente. Aunque en este caso realicé la evaluación del desempeño de los modelos basado en la métrica *Accuracy*, es posible utilizar cualquier otra para problemas de clasificación.</span>
<span id="cb38-408"><a href="#cb38-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-409"><a href="#cb38-409" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mejores hiperparámetros</span></span>
<span id="cb38-410"><a href="#cb38-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-411"><a href="#cb38-411" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Mejores hiperparámetros en modelos sin imputación:</span>
<span id="cb38-412"><a href="#cb38-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-415"><a href="#cb38-415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-416"><a href="#cb38-416" aria-hidden="true" tabindex="-1"></a>mejor_no_impute <span class="ot">&lt;-</span> tuned_no_impute <span class="sc">%&gt;%</span> </span>
<span id="cb38-417"><a href="#cb38-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>(<span class="at">metric =</span> <span class="st">"accuracy"</span>)</span>
<span id="cb38-418"><a href="#cb38-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-419"><a href="#cb38-419" aria-hidden="true" tabindex="-1"></a>mejor_no_impute</span>
<span id="cb38-420"><a href="#cb38-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-421"><a href="#cb38-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-422"><a href="#cb38-422" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Mejores hiperparámetros en modelos con imputación:</span>
<span id="cb38-423"><a href="#cb38-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-426"><a href="#cb38-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-427"><a href="#cb38-427" aria-hidden="true" tabindex="-1"></a>mejor_si_impute <span class="ot">&lt;-</span> tuned_si_impute <span class="sc">%&gt;%</span> </span>
<span id="cb38-428"><a href="#cb38-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>(<span class="at">metric =</span> <span class="st">"accuracy"</span>)</span>
<span id="cb38-429"><a href="#cb38-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-430"><a href="#cb38-430" aria-hidden="true" tabindex="-1"></a>mejor_si_impute</span>
<span id="cb38-431"><a href="#cb38-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-432"><a href="#cb38-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-433"><a href="#cb38-433" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ajuste final</span></span>
<span id="cb38-434"><a href="#cb38-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-435"><a href="#cb38-435" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modelo sin imputación:</span>
<span id="cb38-436"><a href="#cb38-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-437"><a href="#cb38-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE, message=FALSE}</span></span>
<span id="cb38-438"><a href="#cb38-438" aria-hidden="true" tabindex="-1"></a>final_no_impute <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(</span>
<span id="cb38-439"><a href="#cb38-439" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> wf_no_impute,</span>
<span id="cb38-440"><a href="#cb38-440" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> mejor_no_impute</span>
<span id="cb38-441"><a href="#cb38-441" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-442"><a href="#cb38-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> train)</span>
<span id="cb38-443"><a href="#cb38-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-444"><a href="#cb38-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-445"><a href="#cb38-445" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modelo con imputación:</span>
<span id="cb38-446"><a href="#cb38-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-447"><a href="#cb38-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE, message=FALSE}</span></span>
<span id="cb38-448"><a href="#cb38-448" aria-hidden="true" tabindex="-1"></a>final_si_impute <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(</span>
<span id="cb38-449"><a href="#cb38-449" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> wf_si_impute,</span>
<span id="cb38-450"><a href="#cb38-450" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> mejor_si_impute</span>
<span id="cb38-451"><a href="#cb38-451" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-452"><a href="#cb38-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> train)</span>
<span id="cb38-453"><a href="#cb38-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-454"><a href="#cb38-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-455"><a href="#cb38-455" aria-hidden="true" tabindex="-1"></a><span class="fu">## Predicciones Train</span></span>
<span id="cb38-456"><a href="#cb38-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-457"><a href="#cb38-457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modelo sin imputación:</span>
<span id="cb38-458"><a href="#cb38-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-461"><a href="#cb38-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-462"><a href="#cb38-462" aria-hidden="true" tabindex="-1"></a>pred_no_impute_train <span class="ot">&lt;-</span> final_no_impute <span class="sc">%&gt;%</span> </span>
<span id="cb38-463"><a href="#cb38-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> train, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb38-464"><a href="#cb38-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-465"><a href="#cb38-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-466"><a href="#cb38-466" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modelo con imputación:</span>
<span id="cb38-467"><a href="#cb38-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-470"><a href="#cb38-470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-471"><a href="#cb38-471" aria-hidden="true" tabindex="-1"></a>pred_si_impute_train <span class="ot">&lt;-</span> final_si_impute <span class="sc">%&gt;%</span> </span>
<span id="cb38-472"><a href="#cb38-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> train, <span class="at">type =</span> <span class="st">"class"</span>) </span>
<span id="cb38-473"><a href="#cb38-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-474"><a href="#cb38-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-475"><a href="#cb38-475" aria-hidden="true" tabindex="-1"></a><span class="fu">## Predicciones Test</span></span>
<span id="cb38-476"><a href="#cb38-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-477"><a href="#cb38-477" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modelo sin imputación:</span>
<span id="cb38-478"><a href="#cb38-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-481"><a href="#cb38-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-482"><a href="#cb38-482" aria-hidden="true" tabindex="-1"></a>pred_no_impute_test <span class="ot">&lt;-</span> final_no_impute <span class="sc">%&gt;%</span> </span>
<span id="cb38-483"><a href="#cb38-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb38-484"><a href="#cb38-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-485"><a href="#cb38-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-486"><a href="#cb38-486" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modelo con imputación:</span>
<span id="cb38-487"><a href="#cb38-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-490"><a href="#cb38-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-491"><a href="#cb38-491" aria-hidden="true" tabindex="-1"></a>pred_si_impute_test <span class="ot">&lt;-</span> final_si_impute <span class="sc">%&gt;%</span> </span>
<span id="cb38-492"><a href="#cb38-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> test, <span class="at">type =</span> <span class="st">"class"</span>) </span>
<span id="cb38-493"><a href="#cb38-493" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-494"><a href="#cb38-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-495"><a href="#cb38-495" aria-hidden="true" tabindex="-1"></a><span class="fu">## Matriz de confusión Train</span></span>
<span id="cb38-496"><a href="#cb38-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-497"><a href="#cb38-497" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Matriz de confusión modelo sin imputación:</span>
<span id="cb38-498"><a href="#cb38-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-499"><a href="#cb38-499" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Matriz de confusión en train - modelo sin imputación"}</span></span>
<span id="cb38-500"><a href="#cb38-500" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb38-501"><a href="#cb38-501" aria-hidden="true" tabindex="-1"></a>  <span class="at">predicho =</span> <span class="fu">as.factor</span>(pred_no_impute_train<span class="sc">$</span>.pred_class),</span>
<span id="cb38-502"><a href="#cb38-502" aria-hidden="true" tabindex="-1"></a>  <span class="at">real =</span> <span class="fu">as.factor</span>(train<span class="sc">$</span>diagnosis)</span>
<span id="cb38-503"><a href="#cb38-503" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-504"><a href="#cb38-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> real, <span class="at">estimate =</span> predicho) <span class="sc">%&gt;%</span> </span>
<span id="cb38-505"><a href="#cb38-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-506"><a href="#cb38-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb38-507"><a href="#cb38-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Prediction, <span class="at">y =</span> Truth, <span class="at">alpha =</span> n)) <span class="sc">+</span></span>
<span id="cb38-508"><a href="#cb38-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb38-509"><a href="#cb38-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">colour =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb38-510"><a href="#cb38-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-511"><a href="#cb38-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-512"><a href="#cb38-512" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Matriz de confusión modelo con imputación:</span>
<span id="cb38-513"><a href="#cb38-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-514"><a href="#cb38-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Matriz de confusión en train - modelo con imputación"}</span></span>
<span id="cb38-515"><a href="#cb38-515" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb38-516"><a href="#cb38-516" aria-hidden="true" tabindex="-1"></a>  <span class="at">predicho =</span> <span class="fu">as.factor</span>(pred_si_impute_train<span class="sc">$</span>.pred_class),</span>
<span id="cb38-517"><a href="#cb38-517" aria-hidden="true" tabindex="-1"></a>  <span class="at">real =</span> <span class="fu">as.factor</span>(train<span class="sc">$</span>diagnosis)</span>
<span id="cb38-518"><a href="#cb38-518" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-519"><a href="#cb38-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> real, <span class="at">estimate =</span> predicho) <span class="sc">%&gt;%</span> </span>
<span id="cb38-520"><a href="#cb38-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-521"><a href="#cb38-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb38-522"><a href="#cb38-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Prediction, <span class="at">y =</span> Truth, <span class="at">alpha =</span> n)) <span class="sc">+</span></span>
<span id="cb38-523"><a href="#cb38-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb38-524"><a href="#cb38-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">colour =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb38-525"><a href="#cb38-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-526"><a href="#cb38-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-527"><a href="#cb38-527" aria-hidden="true" tabindex="-1"></a><span class="fu">## Matriz de confusión Test</span></span>
<span id="cb38-528"><a href="#cb38-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-529"><a href="#cb38-529" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Matriz de confusión modelo sin imputación:</span>
<span id="cb38-530"><a href="#cb38-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-531"><a href="#cb38-531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Matriz de confusión en test - modelo sin imputación"}</span></span>
<span id="cb38-532"><a href="#cb38-532" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb38-533"><a href="#cb38-533" aria-hidden="true" tabindex="-1"></a>  <span class="at">predicho =</span> <span class="fu">as.factor</span>(pred_no_impute_test<span class="sc">$</span>.pred_class),</span>
<span id="cb38-534"><a href="#cb38-534" aria-hidden="true" tabindex="-1"></a>  <span class="at">real =</span> <span class="fu">as.factor</span>(test<span class="sc">$</span>diagnosis)</span>
<span id="cb38-535"><a href="#cb38-535" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-536"><a href="#cb38-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> real, <span class="at">estimate =</span> predicho) <span class="sc">%&gt;%</span> </span>
<span id="cb38-537"><a href="#cb38-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-538"><a href="#cb38-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb38-539"><a href="#cb38-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Prediction, <span class="at">y =</span> Truth, <span class="at">alpha =</span> n)) <span class="sc">+</span></span>
<span id="cb38-540"><a href="#cb38-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb38-541"><a href="#cb38-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">colour =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb38-542"><a href="#cb38-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-543"><a href="#cb38-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-544"><a href="#cb38-544" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Matriz de confusión modelo con imputación:</span>
<span id="cb38-545"><a href="#cb38-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-546"><a href="#cb38-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Matriz de confusión en test - modelo con imputación"}</span></span>
<span id="cb38-547"><a href="#cb38-547" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb38-548"><a href="#cb38-548" aria-hidden="true" tabindex="-1"></a>  <span class="at">predicho =</span> <span class="fu">as.factor</span>(pred_si_impute_test<span class="sc">$</span>.pred_class),</span>
<span id="cb38-549"><a href="#cb38-549" aria-hidden="true" tabindex="-1"></a>  <span class="at">real =</span> <span class="fu">as.factor</span>(test<span class="sc">$</span>diagnosis)</span>
<span id="cb38-550"><a href="#cb38-550" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-551"><a href="#cb38-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> real, <span class="at">estimate =</span> predicho) <span class="sc">%&gt;%</span> </span>
<span id="cb38-552"><a href="#cb38-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-553"><a href="#cb38-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb38-554"><a href="#cb38-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Prediction, <span class="at">y =</span> Truth, <span class="at">alpha =</span> n)) <span class="sc">+</span></span>
<span id="cb38-555"><a href="#cb38-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb38-556"><a href="#cb38-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">colour =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb38-557"><a href="#cb38-557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-558"><a href="#cb38-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-559"><a href="#cb38-559" aria-hidden="true" tabindex="-1"></a><span class="fu">## Desempeño de modelos</span></span>
<span id="cb38-560"><a href="#cb38-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-561"><a href="#cb38-561" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Genero una base de datos con los resultados de las clases predichas en cada tipo de modelo (con y sin imputación) para los conjuntos de entrenamiento y prueba.</span>
<span id="cb38-562"><a href="#cb38-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-565"><a href="#cb38-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-566"><a href="#cb38-566" aria-hidden="true" tabindex="-1"></a>tabla_accuracy <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-567"><a href="#cb38-567" aria-hidden="true" tabindex="-1"></a>  <span class="at">predicho =</span> pred_no_impute_train<span class="sc">$</span>.pred_class,</span>
<span id="cb38-568"><a href="#cb38-568" aria-hidden="true" tabindex="-1"></a>  <span class="at">real =</span> train<span class="sc">$</span>diagnosis,</span>
<span id="cb38-569"><a href="#cb38-569" aria-hidden="true" tabindex="-1"></a>  <span class="at">datos =</span> <span class="st">"Train"</span>,</span>
<span id="cb38-570"><a href="#cb38-570" aria-hidden="true" tabindex="-1"></a>  <span class="at">tipo =</span> <span class="st">"Sin imputación"</span></span>
<span id="cb38-571"><a href="#cb38-571" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb38-572"><a href="#cb38-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb38-573"><a href="#cb38-573" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb38-574"><a href="#cb38-574" aria-hidden="true" tabindex="-1"></a>      <span class="at">predicho =</span> pred_si_impute_train<span class="sc">$</span>.pred_class,</span>
<span id="cb38-575"><a href="#cb38-575" aria-hidden="true" tabindex="-1"></a>      <span class="at">real =</span> train<span class="sc">$</span>diagnosis,</span>
<span id="cb38-576"><a href="#cb38-576" aria-hidden="true" tabindex="-1"></a>      <span class="at">datos =</span> <span class="st">"Train"</span>,</span>
<span id="cb38-577"><a href="#cb38-577" aria-hidden="true" tabindex="-1"></a>      <span class="at">tipo =</span> <span class="st">"Con imputación"</span></span>
<span id="cb38-578"><a href="#cb38-578" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-579"><a href="#cb38-579" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb38-580"><a href="#cb38-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb38-581"><a href="#cb38-581" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb38-582"><a href="#cb38-582" aria-hidden="true" tabindex="-1"></a>      <span class="at">predicho =</span> pred_no_impute_test<span class="sc">$</span>.pred_class,</span>
<span id="cb38-583"><a href="#cb38-583" aria-hidden="true" tabindex="-1"></a>      <span class="at">real =</span> test<span class="sc">$</span>diagnosis,</span>
<span id="cb38-584"><a href="#cb38-584" aria-hidden="true" tabindex="-1"></a>      <span class="at">datos =</span> <span class="st">"Test"</span>,</span>
<span id="cb38-585"><a href="#cb38-585" aria-hidden="true" tabindex="-1"></a>      <span class="at">tipo =</span> <span class="st">"Sin imputación"</span></span>
<span id="cb38-586"><a href="#cb38-586" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-587"><a href="#cb38-587" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-588"><a href="#cb38-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb38-589"><a href="#cb38-589" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb38-590"><a href="#cb38-590" aria-hidden="true" tabindex="-1"></a>      <span class="at">predicho =</span> pred_si_impute_test<span class="sc">$</span>.pred_class,</span>
<span id="cb38-591"><a href="#cb38-591" aria-hidden="true" tabindex="-1"></a>      <span class="at">real =</span> test<span class="sc">$</span>diagnosis,</span>
<span id="cb38-592"><a href="#cb38-592" aria-hidden="true" tabindex="-1"></a>      <span class="at">datos =</span> <span class="st">"Test"</span>,</span>
<span id="cb38-593"><a href="#cb38-593" aria-hidden="true" tabindex="-1"></a>      <span class="at">tipo =</span> <span class="st">"Con imputación"</span></span>
<span id="cb38-594"><a href="#cb38-594" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-595"><a href="#cb38-595" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-596"><a href="#cb38-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), as.factor))</span>
<span id="cb38-597"><a href="#cb38-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-598"><a href="#cb38-598" aria-hidden="true" tabindex="-1"></a>tabla_accuracy <span class="sc">%&gt;%</span></span>
<span id="cb38-599"><a href="#cb38-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(datos, tipo) <span class="sc">%&gt;%</span> </span>
<span id="cb38-600"><a href="#cb38-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">accuracy =</span> <span class="fu">accuracy_vec</span>(<span class="at">truth =</span> real, <span class="at">estimate =</span> predicho)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-601"><a href="#cb38-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Accuracy en train y test para dos modelos XGBoost"</span>)</span>
<span id="cb38-602"><a href="#cb38-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-603"><a href="#cb38-603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-604"><a href="#cb38-604" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Gráfico *Accuracy:* la capacidad predictiva es superior en el modelo que fue entrenado sin acudir a la imputación de datos.</span>
<span id="cb38-605"><a href="#cb38-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-606"><a href="#cb38-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Accuracy en train y test para dos modelos XGBoost"}</span></span>
<span id="cb38-607"><a href="#cb38-607" aria-hidden="true" tabindex="-1"></a>tabla_accuracy <span class="sc">%&gt;%</span></span>
<span id="cb38-608"><a href="#cb38-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(datos, tipo) <span class="sc">%&gt;%</span> </span>
<span id="cb38-609"><a href="#cb38-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">accuracy =</span> <span class="fu">accuracy_vec</span>(<span class="at">truth =</span> real, <span class="at">estimate =</span> predicho)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-610"><a href="#cb38-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tipo, <span class="at">y =</span> accuracy, <span class="at">color =</span> datos, <span class="at">fill =</span> datos)) <span class="sc">+</span></span>
<span id="cb38-611"><a href="#cb38-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-612"><a href="#cb38-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_jama</span>() <span class="sc">+</span></span>
<span id="cb38-613"><a href="#cb38-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_jama</span>() <span class="sc">+</span></span>
<span id="cb38-614"><a href="#cb38-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Preprocesamiento"</span>, <span class="at">y =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb38-615"><a href="#cb38-615" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">""</span>)</span>
<span id="cb38-616"><a href="#cb38-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-617"><a href="#cb38-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-618"><a href="#cb38-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-619"><a href="#cb38-619" aria-hidden="true" tabindex="-1"></a><span class="fu">## Importancia de variables</span></span>
<span id="cb38-620"><a href="#cb38-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-621"><a href="#cb38-621" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>10 variables de mayor importancia en modelo sin imputación:</span>
<span id="cb38-622"><a href="#cb38-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-623"><a href="#cb38-623" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Importancia de variables - modelo sin imputación"}</span></span>
<span id="cb38-624"><a href="#cb38-624" aria-hidden="true" tabindex="-1"></a>final_no_impute <span class="sc">%&gt;%</span> </span>
<span id="cb38-625"><a href="#cb38-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-626"><a href="#cb38-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>(<span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb38-627"><a href="#cb38-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-628"><a href="#cb38-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-629"><a href="#cb38-629" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>10 variables de mayor importancia en modelo sin imputación:</span>
<span id="cb38-630"><a href="#cb38-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-631"><a href="#cb38-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Importancia de variables - modelo con imputación"}</span></span>
<span id="cb38-632"><a href="#cb38-632" aria-hidden="true" tabindex="-1"></a>final_si_impute <span class="sc">%&gt;%</span> </span>
<span id="cb38-633"><a href="#cb38-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-634"><a href="#cb38-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>(<span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb38-635"><a href="#cb38-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-636"><a href="#cb38-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-637"><a href="#cb38-637" aria-hidden="true" tabindex="-1"></a><span class="fu"># Referencias</span></span>
<span id="cb38-638"><a href="#cb38-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-639"><a href="#cb38-639" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hyde, R.M., Down, P.M., Bradley, A.J. et al. *"Automated prediction of mastitis infection patterns in dairy herds using machine learning"*. Sci Rep 10, 4289 (2020). https://doi.org/10.1038/s41598-020-61126-8</span>
<span id="cb38-640"><a href="#cb38-640" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Chen Tianqi, Guestrin Carlos. *"XGBoost: A Scalable Tree Boosting System"*. CoRR, Vol 1603.02754 (2016). https://arxiv.org/abs/1603.02754</span>
<span id="cb38-641"><a href="#cb38-641" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Boehmke Bradley, Greenwell Brandon. *"Hands-On Machine Learning with R"*. Chapman and Hall/CRC (2019). https://bradleyboehmke.github.io/HOML/gbm.html</span>
<span id="cb38-642"><a href="#cb38-642" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Shewry, M, and H Wynn. *"Maximum Entropy Sampling."* Journal of Applied Statistics 14 (2): 165–70  (1987). https://doi.org/10.1080/02664768700000020</span>
<span id="cb38-643"><a href="#cb38-643" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Kuhn Max, Silge Julia. *"Tidy Modeling with R"*. (2020). https://www.tmwr.org/</span>
</code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>