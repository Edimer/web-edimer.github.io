<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>Machine Learning con R y Python: XGBoost: R</title>

<meta property="description" itemprop="description" content="Algortimo XGBoost con R para resolver problemas de aprendizaje supervisado (clasificaci贸n)."/>

<link rel="icon" type="image/png" href="../../logo.png"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-05-01"/>
<meta property="article:created" itemprop="dateCreated" content="2021-05-01"/>
<meta name="article:author" content="Edimer David Jaramillo (Sidereus)"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Machine Learning con R y Python: XGBoost: R"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Algortimo XGBoost con R para resolver problemas de aprendizaje supervisado (clasificaci贸n)."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Machine Learning con R y Python"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="Machine Learning con R y Python: XGBoost: R"/>
<meta property="twitter:description" content="Algortimo XGBoost con R para resolver problemas de aprendizaje supervisado (clasificaci贸n)."/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","preview","author","date","categories","output"]}},"value":[{"type":"character","attributes":{},"value":["XGBoost: R"]},{"type":"character","attributes":{},"value":["Algortimo XGBoost con R para resolver problemas de aprendizaje supervisado (clasificaci贸n)."]},{"type":"character","attributes":{},"value":["img2.png"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","affiliation","affiliation_url"]}},"value":[{"type":"character","attributes":{},"value":["Edimer David Jaramillo (Sidereus)"]},{"type":"character","attributes":{},"value":["https://edimer.github.io/"]},{"type":"character","attributes":{},"value":["R+Py"]},{"type":"character","attributes":{},"value":["https://edimer.github.io/"]}]}]},{"type":"character","attributes":{},"value":["05-01-2021"]},{"type":"character","attributes":{},"value":["R","xgboost","Gradient Boosting"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["coming.gif","data/mastitis.csv","data/sorgo.xlsx","img/paper_classification.PNG","img2.png","tune_no_impute.Rdata","tune_si_impute.Rdata","XGBoost_R_files/anchor-4.2.2/anchor.min.js","XGBoost_R_files/bowser-1.9.3/bowser.min.js","XGBoost_R_files/distill-2.2.21/template.v2.js","XGBoost_R_files/figure-html5/unnamed-chunk-16-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-20-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-21-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-30-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-31-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-32-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-33-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-35-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-36-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-37-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-4-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-5-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-6-1.png","XGBoost_R_files/figure-html5/unnamed-chunk-7-1.png","XGBoost_R_files/header-attrs-2.6/header-attrs.js","XGBoost_R_files/header-attrs-2.7/header-attrs.js","XGBoost_R_files/jquery-1.11.3/jquery.min.js","XGBoost_R_files/popper-2.6.0/popper.min.js","XGBoost_R_files/tippy-6.2.7/tippy-bundle.umd.min.js","XGBoost_R_files/tippy-6.2.7/tippy-light-border.css","XGBoost_R_files/tippy-6.2.7/tippy.css","XGBoost_R_files/tippy-6.2.7/tippy.umd.min.js","XGBoost_R_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.7/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"XGBoost: R","description":"Algortimo XGBoost con R para resolver problemas de aprendizaje supervisado (clasificaci贸n).","authors":[{"author":"Edimer David Jaramillo (Sidereus)","authorURL":"https://edimer.github.io/","affiliation":"R+Py","affiliationURL":"https://edimer.github.io/","orcidID":""}],"publishedDate":"2021-05-01T00:00:00.000-05:00","citationText":"(Sidereus), 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<span class="logo">
<img src="../../logo.png"/>
</span>
<a href="../../index.html" class="title">Machine Learning con R y Python</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Inicio</a>
<a href="../../about.html">Blog</a>
<a href="https://github.com/web-edimer/web-edimer.github.io">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>XGBoost: R</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:R" class="dt-tag">R</a>
  <a href="../../index.html#category:xgboost" class="dt-tag">xgboost</a>
  <a href="../../index.html#category:Gradient_Boosting" class="dt-tag">Gradient Boosting</a>
</div>
<!--/radix_placeholder_categories-->
<p>Algortimo XGBoost con R para resolver problemas de aprendizaje supervisado (clasificaci贸n).</p>
</div>

<div class="d-byline">
  Edimer David Jaramillo (Sidereus) <a href="https://edimer.github.io/" class="uri">https://edimer.github.io/</a> (R+Py)<a href="https://edimer.github.io/" class="uri">https://edimer.github.io/</a>
  
<br/>05-01-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#documentaci贸n-xgboost">Documentaci贸n <code>xgboost</code></a></li>
<li><a href="#datos-de-ejemplo">Datos de ejemplo</a>
<ul>
<li><a href="#detecci贸n-de-mastitis">Detecci贸n de mastitis</a></li>
</ul></li>
<li><a href="#requisitos-previos">Requisitos previos</a></li>
<li><a href="#bibliotecas">Bibliotecas</a></li>
<li><a href="#tema-para-ggplot2">Tema para <code>ggplot2</code></a></li>
<li><a href="#detecci贸n-de-mastitis-1">Detecci贸n de mastitis</a>
<ul>
<li><a href="#base-de-datos">Base de datos</a></li>
<li><a href="#an谩lisis-exploratorio">An谩lisis exploratorio</a></li>
<li><a href="#train-y-test">Train y Test</a></li>
<li><a href="#validaci贸n-cruzada">Validaci贸n cruzada</a></li>
<li><a href="#preprocesamiento">Preprocesamiento</a></li>
<li><a href="#modelo-xgboost">Modelo XGBoost</a></li>
<li><a href="#flujos-de-trabajo-pipelines">Flujos de trabajo (<em>pipelines</em>)</a></li>
<li><a href="#grid">Grid</a></li>
<li><a href="#tuning-con-tidymodels">Tuning con <code>tidymodels</code></a></li>
<li><a href="#resultados-accuracy">Resultados <em>Accuracy</em></a></li>
<li><a href="#mejores-hiperpar谩metros">Mejores hiperpar谩metros</a></li>
<li><a href="#ajuste-final">Ajuste final</a></li>
<li><a href="#predicciones-train">Predicciones Train</a></li>
<li><a href="#predicciones-test">Predicciones Test</a></li>
<li><a href="#matriz-de-confusi贸n-train">Matriz de confusi贸n Train</a></li>
<li><a href="#matriz-de-confusi贸n-test">Matriz de confusi贸n Test</a></li>
<li><a href="#desempe帽o-de-modelos">Desempe帽o de modelos</a></li>
<li><a href="#importancia-de-variables">Importancia de variables</a></li>
</ul></li>
<li><a href="#referencias">Referencias</a></li>
</ul>
</nav>
</div>
<h2 id="documentaci贸n-xgboost">Documentaci贸n <code>xgboost</code></h2>
<ul>
<li><a href="https://xgboost.readthedocs.io/en/latest/#">Documentaci贸n oficial <code>xgboost</code></a></li>
<li><a href="https://cran.r-project.org/web/packages/xgboost/xgboost.pdf">Biblioteca <code>xgboost</code> en R</a></li>
<li><a href="https://xgboost.readthedocs.io/en/latest/R-package/xgboostPresentation.html">Tutorial de <code>xgboost</code> en R</a></li>
</ul>
<h1 id="datos-de-ejemplo">Datos de ejemplo</h1>
<p>En este documento se muestra c贸mo implementar el algoritmo <em>XGBoost</em> con R a trav茅s de la biblioteca que lleva el mismo nombre y haciendo uso del <a href="https://www.tidymodels.org/"><code>tidymodels</code>.</a> Para ejemplificar el ajuste de <em>modelos de clasificaci贸n</em> se obtuvieron datos de ejemplo aplicado en ciencias animales, espec铆ficamente en la detecci贸n de patrones de infecci贸n de mastitis en vacas.</p>
<h2 id="detecci贸n-de-mastitis">Detecci贸n de mastitis</h2>
<ul>
<li><a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0249136">Art铆culo publicado en PLOS ONE</a></li>
</ul>
<center>
<img src = "img/paper_classification.PNG" width = 750/>
</center>
<h1 id="requisitos-previos">Requisitos previos</h1>
<ul>
<li>Para replicar este documento es necesario instalar las siguientes bibliotecas:
<ul>
<li><strong><code>tidyverse</code>:</strong> manipulaci贸n y visualizaci贸n de datos.</li>
<li><strong><code>readxl</code>:</strong> lectura de datos en formato de Excel.</li>
<li><strong><code>janitor</code>:</strong> manipulaci贸n de datos.</li>
<li><strong><code>visdat</code>:</strong> an谩lisis exploratorio de datos.</li>
<li><strong><code>tidymodels</code>:</strong> entrenamiento y evaluaci贸n de modelos de machine learning.</li>
<li><strong><code>xgboost</code>:</strong> algoritmo <code>xgboost</code>.</li>
<li><strong><code>doParallel</code>:</strong> procesamiento en paralelo (c贸mputo distribuido).</li>
<li><strong><code>parallel</code></strong> procesamiento en paralelo (c贸mputo distribuido).</li>
<li><strong><code>vip</code>:</strong> calcular importancia de variables.</li>
<li><strong><code>ggsci</code>:</strong> paletas de colores.</li>
<li><strong><code>ggforce</code></strong> complemento para gr谩ficos.</li>
<li><strong><code>FactoMineR</code>:</strong> an谩lisis multivariado.</li>
<li><strong><code>knitr</code>:</strong> presentaci贸n de tablas (<code>data.frame</code>).</li>
</ul></li>
<li>Descargar los datos para ejemplo:
<ul>
<li><a href="https://www.nature.com/articles/s41598-020-61126-8#Sec15">Datos para detecci贸n de mastitis</a></li>
</ul></li>
<li><strong>Nota:</strong> es importante mencionar que cuando cargamos la <em>meta-biblioteca</em> <code>tidymodels</code> se activan otras bibliotecas que usaremos m谩s adelante.</li>
</ul>
<h1 id="bibliotecas">Bibliotecas</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://readxl.tidyverse.org'>readxl</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://visdat.njtierney.com/'>visdat</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/sfirke/janitor'>janitor</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://factominer.free.fr'>FactoMineR</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidymodels.tidymodels.org'>tidymodels</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/dmlc/xgboost'>xgboost</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>doParallel</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>parallel</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/koalaverse/vip/'>vip</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://nanx.me/ggsci/'>ggsci</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggforce.data-imaginist.com'>ggforce</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://yihui.org/knitr/'>knitr</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="tema-para-ggplot2">Tema para <code>ggplot2</code></h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mi_temagg</span> <span class='op'>&lt;-</span> <span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span>,
        axis.text.y <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span>,
        strip.background <span class='op'>=</span> <span class='fu'>element_rect</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"gray5"</span><span class='op'>)</span>,
        strip.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"white"</span>, size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span>,
        legend.position <span class='op'>=</span> <span class='st'>"top"</span><span class='op'>)</span>

<span class='fu'>theme_set</span><span class='op'>(</span><span class='va'>mi_temagg</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="detecci贸n-de-mastitis-1">Detecci贸n de mastitis</h1>
<ul>
<li>La variable respuesta est谩 identificada como <code>diagnosis</code>. En principio tiene 4 niveles, sin embargo, para el ejemplo fueron filtrados s贸lo los niveles <code>EDP</code> (transmisi贸n en el per铆odo seco - sin lactancia) y <code>EL</code> (transmisi贸n en per铆odo de lactancia).</li>
<li>La base de datos consta de 1000 observaciones y 229 variables, es decir, que existen 228 variables predictoras. Cuando se aplic贸 el filtro quedaron 914 observaciones.</li>
</ul>
<h2 id="base-de-datos">Base de datos</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mastitis</span> <span class='op'>&lt;-</span> <span class='fu'>read_csv</span><span class='op'>(</span><span class='st'>"data/mastitis.csv"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/janitor/man/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>diagnosis</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"EDP"</span>, <span class='st'>"EL"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>mastitis</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>diagnosis</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span>caption <span class='op'>=</span> <span class='st'>"6 primeras filas de la base de datos con 6 columnas"</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<caption><span id="tab:unnamed-chunk-3">Table 1: </span>6 primeras filas de la base de datos con 6 columnas</caption>
<colgroup>
<col style="width: 8%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 23%" />
<col style="width: 20%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">diagnosis</th>
<th style="text-align: left;">quarter_dates_q0</th>
<th style="text-align: right;">no_recordings_q0</th>
<th style="text-align: right;">l_1_q0_bmscc_000_cells_ml</th>
<th style="text-align: right;">l_1_q0_percent_chronic</th>
<th style="text-align: right;">l_1_q0_percent_200k</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EDP</td>
<td style="text-align: left;">06/10/2009</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">EDP</td>
<td style="text-align: left;">06/12/2009</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">284</td>
<td style="text-align: right;">27.8</td>
<td style="text-align: right;">40.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EL</td>
<td style="text-align: left;">20/04/2012</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">EL</td>
<td style="text-align: left;">16/07/2009</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">21.1</td>
<td style="text-align: right;">26.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EL</td>
<td style="text-align: left;">16/10/2013</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">251</td>
<td style="text-align: right;">27.5</td>
<td style="text-align: right;">34.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">EDP</td>
<td style="text-align: left;">12/01/2013</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">154</td>
<td style="text-align: right;">12.3</td>
<td style="text-align: right;">17.0</td>
</tr>
</tbody>
</table>
</div>
<h2 id="an谩lisis-exploratorio">An谩lisis exploratorio</h2>
<ul>
<li>Frecuencia absoluta para niveles de la variable respuesta.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mastitis</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>diagnosis</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>diagnosis</span>, y <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"dodgerblue3"</span>, fill <span class='op'>=</span> <span class='st'>"dodgerblue3"</span>, alpha <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_label</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Diagn贸stico"</span>, y <span class='op'>=</span> <span class='st'>"Frecuencia"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-4"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-4-1.png" alt="Frecuencia absoluta de variable respuesta" width="624" />
<p class="caption">
Figure 1: Frecuencia absoluta de variable respuesta
</p>
</div>
</div>
<ul>
<li>Distribuciones de algunas variables num茅ricas: como el n煤mero de variables es alto, selecciono al azar 8 de ellas para construir el gr谩fico.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># N煤meros al azar</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1992</span><span class='op'>)</span>
<span class='va'>variables_azar</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>228</span>, size <span class='op'>=</span> <span class='fl'>8</span>, replace <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='va'>mastitis</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>diagnosis</span>, <span class='va'>variables_azar</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='op'>-</span><span class='va'>diagnosis</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>value</span>, fill <span class='op'>=</span> <span class='va'>diagnosis</span>, color <span class='op'>=</span> <span class='va'>diagnosis</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span><span class='va'>name</span>, scales <span class='op'>=</span> <span class='st'>"free"</span>, ncol <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_density</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_log10</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://nanx.me/ggsci/reference/scale_jama.html'>scale_color_jama</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://nanx.me/ggsci/reference/scale_jama.html'>scale_fill_jama</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>""</span>, y <span class='op'>=</span> <span class='st'>"Densidad"</span>, color <span class='op'>=</span> <span class='st'>"Diagn贸stico"</span>,
       fill <span class='op'>=</span> <span class='st'>"Diagn贸stico"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-5-1.png" alt="Densidades de 8 variables al azar (transformaci贸n con logaritmo en base 10)" width="768" />
<p class="caption">
Figure 2: Densidades de 8 variables al azar (transformaci贸n con logaritmo en base 10)
</p>
</div>
</div>
<ul>
<li>Verificamos si existen valores ausentes. Se observan algunas filas con valores <code>NA</code>.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='http://visdat.njtierney.com//reference/vis_miss.html'>vis_miss</a></span><span class='op'>(</span><span class='va'>mastitis</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-6"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-6-1.png" alt="Valores ausentes en el conjunto de datos" width="768" />
<p class="caption">
Figure 3: Valores ausentes en el conjunto de datos
</p>
</div>
</div>
<ul>
<li>Con la finalidad de evidenciar si existe alg煤n patr贸n de asociaci贸n subyacente en el total de variables, se realiz贸 an谩lisis de componentes principales y se grafican los dos primeros componentes. No existe alg煤n comportamiento de agrupaci贸n al reducir la dimensi贸n a los dos primeros componentes. Se observ贸 que la retenci贸n de variabilidad de estas dos coordenadas apenas alcanz贸 el 30% aproximadamente.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># An谩lisis de componentes principales</span>
<span class='va'>datos_pca</span> <span class='op'>&lt;-</span> <span class='va'>mastitis</span>
<span class='va'>pca</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/FactoMineR/man/PCA.html'>PCA</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>datos_pca</span> <span class='op'>%&gt;%</span>
             <span class='fu'>select</span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span><span class='op'>)</span>,
           scale.unit <span class='op'>=</span> <span class='cn'>TRUE</span>,
           graph <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='co'># Agregando componentes a la base de datos</span>
<span class='va'>datos_pca</span><span class='op'>$</span><span class='va'>cp1</span> <span class='op'>&lt;-</span> <span class='va'>pca</span><span class='op'>$</span><span class='va'>ind</span><span class='op'>$</span><span class='va'>coord</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>
<span class='va'>datos_pca</span><span class='op'>$</span><span class='va'>cp2</span> <span class='op'>&lt;-</span> <span class='va'>pca</span><span class='op'>$</span><span class='va'>ind</span><span class='op'>$</span><span class='va'>coord</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span>

<span class='co'># Gr谩fico de las 2 primeras componentes</span>
<span class='va'>datos_pca</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>cp1</span>, y <span class='op'>=</span> <span class='va'>cp2</span>, color <span class='op'>=</span> <span class='va'>diagnosis</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_hline</span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fl'>0</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linetype <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_vline</span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linetype <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://nanx.me/ggsci/reference/scale_jama.html'>scale_color_jama</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"CP1 (15.74 %)"</span>, y <span class='op'>=</span> <span class='st'>"CP2 (14.09 %)"</span>, color <span class='op'>=</span> <span class='st'>"Diagn贸stico"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-7"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-7-1.png" alt="Componente principal 1 vs componente principal 2" width="624" />
<p class="caption">
Figure 4: Componente principal 1 vs componente principal 2
</p>
</div>
</div>
<ul>
<li>Los resultados exploratorios sugieren cuatro cosas importantes:
<ul>
<li>El problema de clasificaci贸n bajo an谩lisis podr铆a ser denominado de <em>clases balanceadas</em>, ya que las frecuencias absolutas son similares para cada nivel a predecir.</li>
<li>Algunas variables predictoras no tienen comportamiento gaussiano. Parte de la estrategia del an谩lisis, en estos casos, podr铆a ser la implementaci贸n de alg煤n tipo de transformaci贸n previo al entrenamiento de los modelos, no obstante, este paso no se aplicar谩 dada la robustez que presenta el algoritmo <em>XGBoost</em> frente a distribuciones asim茅tricas.</li>
<li>Existen observaciones con valores ausentes para una o m谩s variables. Algunos algoritmos como la <em>regresi贸n log铆stica</em> o los <em>bosques aleatorios</em>, no permiten la inclusi贸n de valores <code>NA</code> al entrenar los modelos, sin embargo, con <em>XGBoost</em> no existe este inconveniente, puesto que soporta valores vac铆os.</li>
<li>El an谩lisis de componentes principales no muestra alguna tendencia de agrupaci贸n entre las clases evaluadas. La retenci贸n de variabilidad de las tres primeras componentes no supera el 50%, resultado que podr铆a sugerir que las relaciones de tipo lineal no son plausibles en este conjunto de datos.</li>
</ul></li>
</ul>
<h2 id="train-y-test">Train y Test</h2>
<ul>
<li>En este ejemplo los datos fueron divididos en <em>train</em> y <em>test</em> con proporciones de 80 y 20 %, respectivamente. Se utiliza muestreo estratificado en funci贸n de la variable respuesta. Se eliminaron 4 variables que tienen informaci贸n de fechas; aunque podr铆an ser tratadas de alguna manera especial, en este caso no fueron tenidas en cuenta.</li>
<li>La biblioteca <a href="https://rsample.tidymodels.org/"><code>rsample</code></a> permite realizar la divisi贸n.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Variables fechas</span>
<span class='va'>variables_fechas</span> <span class='op'>&lt;-</span> <span class='va'>mastitis</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>is.character</span>, <span class='op'>-</span><span class='va'>diagnosis</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># Datos para modelos</span>
<span class='va'>data_modelos</span> <span class='op'>&lt;-</span> <span class='va'>mastitis</span> <span class='op'>%&gt;%</span> <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>variables_fechas</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1992</span><span class='op'>)</span>
<span class='va'>particiones</span> <span class='op'>&lt;-</span> <span class='fu'>initial_split</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>data_modelos</span>, prop <span class='op'>=</span> <span class='fl'>0.80</span>, strata <span class='op'>=</span> <span class='va'>diagnosis</span><span class='op'>)</span>
<span class='va'>train</span> <span class='op'>&lt;-</span> <span class='fu'>training</span><span class='op'>(</span><span class='va'>particiones</span><span class='op'>)</span>
<span class='va'>test</span> <span class='op'>&lt;-</span> <span class='fu'>testing</span><span class='op'>(</span><span class='va'>particiones</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li>Podemos ver el objeto <code>particiones</code> que proporciona informaci贸n de la partici贸n de datos. Los modelos son entrenados con 733 observaciones y con 181 se eval煤a el desempe帽o de los mismos.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>particiones</span>
</code></pre>
</div>
<pre><code>&lt;Analysis/Assess/Total&gt;
&lt;733/181/914&gt;</code></pre>
</div>
<h2 id="validaci贸n-cruzada">Validaci贸n cruzada</h2>
<ul>
<li>Se utiliza validaci贸n cruzada <em>k-fold</em> con <span class="math inline">\(k = 10\)</span>.</li>
<li>La biblioteca <a href="https://rsample.tidymodels.org/"><code>rsample</code></a> permite configurar diferentes m茅todos de validaci贸n cruzada.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1992</span><span class='op'>)</span>
<span class='va'>config_cv</span> <span class='op'>&lt;-</span> <span class='fu'>vfold_cv</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train</span>, v <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="preprocesamiento">Preprocesamiento</h2>
<ul>
<li>En este ejemplo no se har谩 茅nfasis en las estrategias de preprocesamiento o ingenier铆a de caracter铆sticas, sin embargo, ser谩n comparados algoritmos con imputaci贸n de valores ausentes (con m茅todo k vecinos m谩s cercanos) respecto a algoritmos sin imputaci贸n.</li>
<li>La biblioteca <a href="https://recipes.tidymodels.org/"><code>recipes</code></a> permite realizar m煤ltiples tareas de preprocesamiento e ingenier铆a de caracter铆sticas.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>no_impute</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>diagnosis</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>train</span><span class='op'>)</span>
<span class='va'>si_impute</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>diagnosis</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>train</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_impute_knn</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="modelo-xgboost">Modelo XGBoost</h2>
<ul>
<li>El algoritmo <em>XGboost</em> tiene m煤ltiples hiperpar谩metros que pueden ser sintonizados, sin embargo, en este ejemplo s贸lo ser har谩 tuning sobre los siguientes:
<ul>
<li><code>mtry</code>: n煤mero de predictores que se muestrear谩n aleatoriamente en cada divisi贸n al crear los modelos.</li>
<li><code>min_n</code>: n煤mero m铆nimo de observaciones requeridas en un nodo para que se produzca la divisi贸n.</li>
<li><code>tree_depth</code>: profundidad m谩xima del 谩rbol (n煤mero de divisiones).</li>
</ul></li>
<li>El n煤mero de 谩rboles (<code>trees</code>) se estableci贸 en 1000.</li>
<li>La tasa de aprendizaje (<code>learn_rate</code>) se estableci贸 en 0.1.</li>
<li>La proporci贸n de observaciones muestreadas (<code>sample_size</code>) en cada rutina de ajuste se estableci贸 en 0.8.</li>
<li>Los dem谩s hiperpar谩metros se mantienen por defecto.</li>
<li>Para m谩s informaci贸n acerca de los hiperpar谩metros que permite ajustar <a href="https://parsnip.tidymodels.org/"><code>parsnip</code></a>, consultar <a href="https://parsnip.tidymodels.org/reference/boost_tree.html">este enlace.</a></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>modelo_xgboost</span> <span class='op'>&lt;-</span> <span class='fu'>boost_tree</span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>,
                             min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>,
                             tree_depth <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>,
                             trees <span class='op'>=</span> <span class='fl'>1000</span>,
                             learn_rate <span class='op'>=</span> <span class='fl'>0.1</span>,
                             sample_size <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"xgboost"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"classification"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="flujos-de-trabajo-pipelines">Flujos de trabajo (<em>pipelines</em>)</h2>
<ul>
<li><p>Los flujos de trabajo son una manera flexible de trabajar con <em>tidymodels</em>. Se fundamenta en la misma idea de los <em>pipelines</em> de <a href="https://scikit-learn.org/stable/">scikit-learn</a> de Python. Es posible construir nuestro flujo de trabajo con recetas y modelos declarados previamente.</p></li>
<li><p>Consultar m谩s informaci贸n de la biblioteca <a href="https://workflows.tidymodels.org/">workflows.</a></p></li>
<li><p>Flujo de trabajo sin imputaci贸n:</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wf_no_impute</span> <span class='op'>&lt;-</span> <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>no_impute</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>modelo_xgboost</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li>Flujo de trabajo con imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wf_si_impute</span> <span class='op'>&lt;-</span> <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>si_impute</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>modelo_xgboost</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="grid">Grid</h2>
<ul>
<li>En este caso se utiliza la cuadr铆cula a trav茅s de dise帽os de llenado de espacio (<em>space-filling designs</em>), los cuales intentan encontrar una configuraci贸n de puntos (combinaciones) que cubren el espacio de par谩metros con menor probabilidad de valores que se traslapan. Para este ejemplo el tama帽o de la cuadr铆cula fue de 10.</li>
<li>Para este caso particular se usan dise帽os de m谩xima entrop铆a, descritos en el a帽o 1987 por Shewry y Wynn en el art铆culo <em>Maximum Entropy Sampling.</em> Tambi茅n podr铆an ser implementados dise帽os de hipercubos latinos o dise帽os de proyecci贸n m谩xima. Si no se desea utilizar alguno de estos m茅todos, podr铆a ser implementada una cuadr铆cula regular a trav茅s de m茅todos aleatorios (<em>grid random</em>).</li>
<li>Mayor informaci贸n en la p谩gina web de la biblioteca <a href="https://dials.tidymodels.org/index.html">dials.</a></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Par谩metros para tuning</span>
<span class='va'>params_xgb</span> <span class='op'>&lt;-</span> <span class='fu'>parameters</span><span class='op'>(</span>
  <span class='fu'>finalize</span><span class='op'>(</span><span class='fu'>mtry</span><span class='op'>(</span><span class='op'>)</span>, x <span class='op'>=</span> <span class='va'>train</span><span class='op'>[</span>, <span class='op'>-</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>,
  <span class='fu'>min_n</span><span class='op'>(</span>range <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2L</span>, <span class='fl'>50L</span><span class='op'>)</span><span class='op'>)</span>,
  <span class='fu'>tree_depth</span><span class='op'>(</span>range <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3L</span>, <span class='fl'>8L</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='co'># Grid</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>2021</span><span class='op'>)</span>
<span class='va'>grid_xgb</span> <span class='op'>&lt;-</span> <span class='va'>params_xgb</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>grid_max_entropy</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li>A continuaci贸n se muestra la cuadr铆cula de b煤squeda de los mejores hiperpar谩metros. Se evidencia que los puntos no se solapan, de tal manera que el espacio de b煤squeda no es redundante.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grid_xgb</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>.panel_x</span>, y <span class='op'>=</span> <span class='va'>.panel_y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggforce.data-imaginist.com/reference/facet_matrix.html'>facet_matrix</a></span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>mtry</span>, <span class='va'>min_n</span>, <span class='va'>tree_depth</span><span class='op'>)</span>, layer.diag <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-16"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-16-1.png" alt="Cuadr铆cula de tama帽o 10 con m茅todo de m谩xima entrop铆a" width="624" />
<p class="caption">
Figure 5: Cuadr铆cula de tama帽o 10 con m茅todo de m谩xima entrop铆a
</p>
</div>
</div>
<h2 id="tuning-con-tidymodels">Tuning con <code>tidymodels</code></h2>
<ul>
<li>La funci贸n <code>tune_grid()</code> de la biblioteca <a href="https://tune.tidymodels.org/">tune</a> permite evaluar los modelos con cada combinaci贸n de param茅tros establecidos previamente en la cuadr铆cula.</li>
<li>Tuning sin imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/doParallel/man/registerDoParallel.html'>registerDoParallel</a></span><span class='op'>(</span><span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/detectCores.html'>detectCores</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='co'># Inicio Paralelizaci贸n</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>2021</span><span class='op'>)</span>
<span class='va'>tuned_no_impute</span> <span class='op'>&lt;-</span> <span class='fu'>tune_grid</span><span class='op'>(</span>
  object <span class='op'>=</span> <span class='va'>wf_no_impute</span>,
  resamples <span class='op'>=</span> <span class='va'>config_cv</span>,
  grid <span class='op'>=</span> <span class='va'>grid_xgb</span>
<span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/pkg/doParallel/man/registerDoParallel.html'>stopImplicitCluster</a></span><span class='op'>(</span><span class='op'>)</span> <span class='co'># Fin Paralelizaci贸n</span>
</code></pre>
</div>
</div>
<ul>
<li>Tuning con imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/doParallel/man/registerDoParallel.html'>registerDoParallel</a></span><span class='op'>(</span><span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/detectCores.html'>detectCores</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='co'># Inicio Paralelizaci贸n</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>2021</span><span class='op'>)</span>
<span class='va'>tuned_si_impute</span> <span class='op'>&lt;-</span> <span class='fu'>tune_grid</span><span class='op'>(</span>
  object <span class='op'>=</span> <span class='va'>wf_si_impute</span>,
  resamples <span class='op'>=</span> <span class='va'>config_cv</span>,
  grid <span class='op'>=</span> <span class='va'>grid_xgb</span>
<span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/pkg/doParallel/man/registerDoParallel.html'>stopImplicitCluster</a></span><span class='op'>(</span><span class='op'>)</span> <span class='co'># Fin Paralelizaci贸n</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="resultados-accuracy">Resultados <em>Accuracy</em></h2>
<ul>
<li>Resultados de <em>Accuracy</em> en modelos sin imputaci贸n. La precisi贸n m谩s alta se consigue con aproximadamente 150 variables (<code>mtry</code>), menos de 10 observaciones para que se produzca la divisi贸n del 谩rbol (<code>min_n</code>) y profunidad de m谩s o menos 6 (<code>tree_depth</code>).</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tuned_no_impute</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"accuracy"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>mtry</span>, y <span class='op'>=</span> <span class='va'>min_n</span>, size <span class='op'>=</span> <span class='va'>tree_depth</span>, color <span class='op'>=</span> <span class='va'>mean</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_viridis_c</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"Accuracy"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="XGBoost_R_files/figure-html5/unnamed-chunk-20-1.png" width="624" /></p>
</div>
<ul>
<li>Resultados de <em>Accuracy</em> en modelos con imputaci贸n. La precisi贸n m谩s alta se consigue con aproximadamente 25 variables (<code>mtry</code>), poco menos de 50 observaciones para que se produzca la divisi贸n del 谩rbol (<code>min_n</code>) y profunidad de m谩s o menos 4 (<code>tree_depth</code>).</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tuned_si_impute</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"accuracy"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>mtry</span>, y <span class='op'>=</span> <span class='va'>min_n</span>, size <span class='op'>=</span> <span class='va'>tree_depth</span>, color <span class='op'>=</span> <span class='va'>mean</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_viridis_c</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"Accuracy"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="XGBoost_R_files/figure-html5/unnamed-chunk-21-1.png" width="624" /></p>
</div>
<ul>
<li>Se observa que los mejores hiperpar谩metros para los algoritmos entrenados con y sin imputaci贸n, discrepan considerablemente. Aunque en este caso realic茅 la evaluaci贸n del desempe帽o de los modelos basado en la m茅trica <em>Accuracy</em>, es posible utilizar cualquier otra para problemas de clasificaci贸n.</li>
</ul>
<h2 id="mejores-hiperpar谩metros">Mejores hiperpar谩metros</h2>
<ul>
<li>Mejores hiperpar谩metros en modelos sin imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mejor_no_impute</span> <span class='op'>&lt;-</span> <span class='va'>tuned_no_impute</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"accuracy"</span><span class='op'>)</span>

<span class='va'>mejor_no_impute</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 4
   mtry min_n tree_depth .config              
  &lt;int&gt; &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                
1   149     9          7 Preprocessor1_Model09</code></pre>
</div>
<ul>
<li>Mejores hiperpar谩metros en modelos con imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mejor_si_impute</span> <span class='op'>&lt;-</span> <span class='va'>tuned_si_impute</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"accuracy"</span><span class='op'>)</span>

<span class='va'>mejor_si_impute</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 4
   mtry min_n tree_depth .config              
  &lt;int&gt; &lt;int&gt;      &lt;int&gt; &lt;chr&gt;                
1    25    49          5 Preprocessor1_Model01</code></pre>
</div>
<h2 id="ajuste-final">Ajuste final</h2>
<ul>
<li>Modelo sin imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_no_impute</span> <span class='op'>&lt;-</span> <span class='fu'>finalize_workflow</span><span class='op'>(</span>
  x <span class='op'>=</span> <span class='va'>wf_no_impute</span>,
  parameters <span class='op'>=</span> <span class='va'>mejor_no_impute</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>fit</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[22:33:31] WARNING: amalgamation/../src/learner.cc:1095: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective &#39;binary:logistic&#39; was changed from &#39;error&#39; to &#39;logloss&#39;. Explicitly set eval_metric if you&#39;d like to restore the old behavior.</code></pre>
</div>
<ul>
<li>Modelo con imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_si_impute</span> <span class='op'>&lt;-</span> <span class='fu'>finalize_workflow</span><span class='op'>(</span>
  x <span class='op'>=</span> <span class='va'>wf_si_impute</span>,
  parameters <span class='op'>=</span> <span class='va'>mejor_si_impute</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>fit</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[22:34:15] WARNING: amalgamation/../src/learner.cc:1095: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective &#39;binary:logistic&#39; was changed from &#39;error&#39; to &#39;logloss&#39;. Explicitly set eval_metric if you&#39;d like to restore the old behavior.</code></pre>
</div>
<h2 id="predicciones-train">Predicciones Train</h2>
<ul>
<li>Modelo sin imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pred_no_impute_train</span> <span class='op'>&lt;-</span> <span class='va'>final_no_impute</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>train</span>, type <span class='op'>=</span> <span class='st'>"class"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li>Modelo con imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pred_si_impute_train</span> <span class='op'>&lt;-</span> <span class='va'>final_si_impute</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>train</span>, type <span class='op'>=</span> <span class='st'>"class"</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<h2 id="predicciones-test">Predicciones Test</h2>
<ul>
<li>Modelo sin imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pred_no_impute_test</span> <span class='op'>&lt;-</span> <span class='va'>final_no_impute</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"class"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li>Modelo con imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pred_si_impute_test</span> <span class='op'>&lt;-</span> <span class='va'>final_si_impute</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"class"</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<h2 id="matriz-de-confusi贸n-train">Matriz de confusi贸n Train</h2>
<ul>
<li>Matriz de confusi贸n modelo sin imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
  predicho <span class='op'>=</span> <span class='va'>pred_no_impute_train</span><span class='op'>$</span><span class='va'>.pred_class</span>,
  real <span class='op'>=</span> <span class='va'>train</span><span class='op'>$</span><span class='va'>diagnosis</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>conf_mat</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>real</span>, estimate <span class='op'>=</span> <span class='va'>predicho</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pluck</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span>  <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Prediction</span>, y <span class='op'>=</span> <span class='va'>Truth</span>, alpha <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_tile</span><span class='op'>(</span>show.legend <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>, colour <span class='op'>=</span> <span class='st'>"white"</span>, alpha <span class='op'>=</span> <span class='fl'>1</span>, size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-30"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-30-1.png" alt="Matriz de confusi贸n en train - modelo sin imputaci贸n" width="624" />
<p class="caption">
Figure 6: Matriz de confusi贸n en train - modelo sin imputaci贸n
</p>
</div>
</div>
<ul>
<li>Matriz de confusi贸n modelo con imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
  predicho <span class='op'>=</span> <span class='va'>pred_si_impute_train</span><span class='op'>$</span><span class='va'>.pred_class</span>,
  real <span class='op'>=</span> <span class='va'>train</span><span class='op'>$</span><span class='va'>diagnosis</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>conf_mat</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>real</span>, estimate <span class='op'>=</span> <span class='va'>predicho</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pluck</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span>  <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Prediction</span>, y <span class='op'>=</span> <span class='va'>Truth</span>, alpha <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_tile</span><span class='op'>(</span>show.legend <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>, colour <span class='op'>=</span> <span class='st'>"white"</span>, alpha <span class='op'>=</span> <span class='fl'>1</span>, size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-31"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-31-1.png" alt="Matriz de confusi贸n en train - modelo con imputaci贸n" width="624" />
<p class="caption">
Figure 7: Matriz de confusi贸n en train - modelo con imputaci贸n
</p>
</div>
</div>
<h2 id="matriz-de-confusi贸n-test">Matriz de confusi贸n Test</h2>
<ul>
<li>Matriz de confusi贸n modelo sin imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
  predicho <span class='op'>=</span> <span class='va'>pred_no_impute_test</span><span class='op'>$</span><span class='va'>.pred_class</span>,
  real <span class='op'>=</span> <span class='va'>test</span><span class='op'>$</span><span class='va'>diagnosis</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>conf_mat</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>real</span>, estimate <span class='op'>=</span> <span class='va'>predicho</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pluck</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span>  <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Prediction</span>, y <span class='op'>=</span> <span class='va'>Truth</span>, alpha <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_tile</span><span class='op'>(</span>show.legend <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>, colour <span class='op'>=</span> <span class='st'>"white"</span>, alpha <span class='op'>=</span> <span class='fl'>1</span>, size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-32"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-32-1.png" alt="Matriz de confusi贸n en test - modelo sin imputaci贸n" width="624" />
<p class="caption">
Figure 8: Matriz de confusi贸n en test - modelo sin imputaci贸n
</p>
</div>
</div>
<ul>
<li>Matriz de confusi贸n modelo con imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
  predicho <span class='op'>=</span> <span class='va'>pred_si_impute_test</span><span class='op'>$</span><span class='va'>.pred_class</span>,
  real <span class='op'>=</span> <span class='va'>test</span><span class='op'>$</span><span class='va'>diagnosis</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>conf_mat</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>real</span>, estimate <span class='op'>=</span> <span class='va'>predicho</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pluck</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span>  <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Prediction</span>, y <span class='op'>=</span> <span class='va'>Truth</span>, alpha <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_tile</span><span class='op'>(</span>show.legend <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>, colour <span class='op'>=</span> <span class='st'>"white"</span>, alpha <span class='op'>=</span> <span class='fl'>1</span>, size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-33"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-33-1.png" alt="Matriz de confusi贸n en test - modelo con imputaci贸n" width="624" />
<p class="caption">
Figure 9: Matriz de confusi贸n en test - modelo con imputaci贸n
</p>
</div>
</div>
<h2 id="desempe帽o-de-modelos">Desempe帽o de modelos</h2>
<ul>
<li>Genero una base de datos con los resultados de las clases predichas en cada tipo de modelo (con y sin imputaci贸n) para los conjuntos de entrenamiento y prueba.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tabla_accuracy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
  predicho <span class='op'>=</span> <span class='va'>pred_no_impute_train</span><span class='op'>$</span><span class='va'>.pred_class</span>,
  real <span class='op'>=</span> <span class='va'>train</span><span class='op'>$</span><span class='va'>diagnosis</span>,
  datos <span class='op'>=</span> <span class='st'>"Train"</span>,
  tipo <span class='op'>=</span> <span class='st'>"Sin imputaci贸n"</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>bind_rows</span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
      predicho <span class='op'>=</span> <span class='va'>pred_si_impute_train</span><span class='op'>$</span><span class='va'>.pred_class</span>,
      real <span class='op'>=</span> <span class='va'>train</span><span class='op'>$</span><span class='va'>diagnosis</span>,
      datos <span class='op'>=</span> <span class='st'>"Train"</span>,
      tipo <span class='op'>=</span> <span class='st'>"Con imputaci贸n"</span>
    <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>bind_rows</span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
      predicho <span class='op'>=</span> <span class='va'>pred_no_impute_test</span><span class='op'>$</span><span class='va'>.pred_class</span>,
      real <span class='op'>=</span> <span class='va'>test</span><span class='op'>$</span><span class='va'>diagnosis</span>,
      datos <span class='op'>=</span> <span class='st'>"Test"</span>,
      tipo <span class='op'>=</span> <span class='st'>"Sin imputaci贸n"</span>
    <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>bind_rows</span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
      predicho <span class='op'>=</span> <span class='va'>pred_si_impute_test</span><span class='op'>$</span><span class='va'>.pred_class</span>,
      real <span class='op'>=</span> <span class='va'>test</span><span class='op'>$</span><span class='va'>diagnosis</span>,
      datos <span class='op'>=</span> <span class='st'>"Test"</span>,
      tipo <span class='op'>=</span> <span class='st'>"Con imputaci贸n"</span>
    <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.character</span><span class='op'>)</span>, <span class='va'>as.factor</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>tabla_accuracy</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>datos</span>, <span class='va'>tipo</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarise</span><span class='op'>(</span>accuracy <span class='op'>=</span> <span class='fu'>accuracy_vec</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>real</span>, estimate <span class='op'>=</span> <span class='va'>predicho</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span>caption <span class='op'>=</span> <span class='st'>"Accuracy en train y test para dos modelos XGBoost"</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<caption><span id="tab:unnamed-chunk-34">Table 2: </span>Accuracy en train y test para dos modelos XGBoost</caption>
<thead>
<tr class="header">
<th style="text-align: left;">datos</th>
<th style="text-align: left;">tipo</th>
<th style="text-align: right;">accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Test</td>
<td style="text-align: left;">Con imputaci贸n</td>
<td style="text-align: right;">0.7127072</td>
</tr>
<tr class="even">
<td style="text-align: left;">Test</td>
<td style="text-align: left;">Sin imputaci贸n</td>
<td style="text-align: right;">0.7403315</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Train</td>
<td style="text-align: left;">Con imputaci贸n</td>
<td style="text-align: right;">0.8390177</td>
</tr>
<tr class="even">
<td style="text-align: left;">Train</td>
<td style="text-align: left;">Sin imputaci贸n</td>
<td style="text-align: right;">0.9959072</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>Gr谩fico <em>Accuracy:</em> la capacidad predictiva es superior en el modelo que fue entrenado sin acudir a la imputaci贸n de datos.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tabla_accuracy</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>datos</span>, <span class='va'>tipo</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarise</span><span class='op'>(</span>accuracy <span class='op'>=</span> <span class='fu'>accuracy_vec</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>real</span>, estimate <span class='op'>=</span> <span class='va'>predicho</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>tipo</span>, y <span class='op'>=</span> <span class='va'>accuracy</span>, color <span class='op'>=</span> <span class='va'>datos</span>, fill <span class='op'>=</span> <span class='va'>datos</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>position <span class='op'>=</span> <span class='st'>"dodge"</span>, alpha <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://nanx.me/ggsci/reference/scale_jama.html'>scale_color_jama</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://nanx.me/ggsci/reference/scale_jama.html'>scale_fill_jama</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Preprocesamiento"</span>, y <span class='op'>=</span> <span class='st'>"Accuracy"</span>,
       color <span class='op'>=</span> <span class='st'>""</span>, fill <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-35"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-35-1.png" alt="Accuracy en train y test para dos modelos XGBoost" width="624" />
<p class="caption">
Figure 10: Accuracy en train y test para dos modelos XGBoost
</p>
</div>
</div>
<h2 id="importancia-de-variables">Importancia de variables</h2>
<ul>
<li>10 variables de mayor importancia en modelo sin imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_no_impute</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pull_workflow_fit</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/vip/man/vip.html'>vip</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"point"</span>, n <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-36"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-36-1.png" alt="Importancia de variables - modelo sin imputaci贸n" width="624" />
<p class="caption">
Figure 11: Importancia de variables - modelo sin imputaci贸n
</p>
</div>
</div>
<ul>
<li>10 variables de mayor importancia en modelo sin imputaci贸n:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_si_impute</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pull_workflow_fit</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/vip/man/vip.html'>vip</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"point"</span>, n <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-37"></span>
<img src="XGBoost_R_files/figure-html5/unnamed-chunk-37-1.png" alt="Importancia de variables - modelo con imputaci贸n" width="624" />
<p class="caption">
Figure 12: Importancia de variables - modelo con imputaci贸n
</p>
</div>
</div>
<h1 id="referencias">Referencias</h1>
<ul>
<li>Hyde, R.M., Down, P.M., Bradley, A.J. et al.<em>Automated prediction of mastitis infection patterns in dairy herds using machine learning</em>. Sci Rep 10, 4289 (2020). <a href="https://doi.org/10.1038/s41598-020-61126-8" class="uri">https://doi.org/10.1038/s41598-020-61126-8</a></li>
<li>Chen Tianqi, Guestrin Carlos. <em>XGBoost: A Scalable Tree Boosting System</em>. CoRR, Vol 1603.02754 (2016). <a href="https://arxiv.org/abs/1603.02754" class="uri">https://arxiv.org/abs/1603.02754</a></li>
<li>Boehmke Bradley, Greenwell Brandon. <em>Hands-On Machine Learning with R</em>. Chapman and Hall/CRC (2019). <a href="https://bradleyboehmke.github.io/HOML/gbm.html" class="uri">https://bradleyboehmke.github.io/HOML/gbm.html</a></li>
<li>Shewry, M, and H Wynn. <em>Maximum Entropy Sampling.</em> Journal of Applied Statistics 14 (2): 16570 (1987). <a href="https://doi.org/10.1080/02664768700000020" class="uri">https://doi.org/10.1080/02664768700000020</a></li>
<li>Kuhn Max, Silge Julia. <em>Tidy Modeling with R</em>. (2020). <a href="https://www.tmwr.org/" class="uri">https://www.tmwr.org/</a></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
