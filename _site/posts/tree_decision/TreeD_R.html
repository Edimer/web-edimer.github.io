<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Edimer (Sidereus)">
<meta name="description" content="Ejemplo de árboles de decisión en machine learning supervisado para clasificación. Uso de las bibliotecas rpart, rpart.plot y caret en perfilamiento de riesgo crediticio.">
<title>Machine Learning con R y Python - Árbol de clasificación con R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sín resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la busqueda",
    "search-hide-matches-text": "Esconder resultados adicionales",
    "search-more-match-text": "hay más resultados en este documento",
    "search-more-matches-text": "más resultados en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Eviar"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script src="../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="../../site_libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="../../site_libs/vis-9.1.0/vis-network.min.js"></script><script src="../../site_libs/visNetwork-binding-2.1.0/visNetwork.js"></script><script src="../../site_libs/FileSaver-1.1.20151003/FileSaver.min.js"></script><script src="../../site_libs/Blob-1.0/Blob.js"></script><script src="../../site_libs/canvas-toBlob-1.0/canvas-toBlob.js"></script><script src="../../site_libs/html2canvas-0.5.0/html2canvas.js"></script><script src="../../site_libs/jspdf-1.3.2/jspdf.debug.js"></script><script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script><link href="../../site_libs/jquery-sparkline-2.1.2/jquery.sparkline.css" rel="stylesheet">
<script src="../../site_libs/jquery-sparkline-2.1.2/jquery.sparkline.js"></script><script src="../../site_libs/sparkline-binding-2.0/sparkline.js"></script><link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script><link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="estilo.css">
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Machine Learning con R y Python</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../about.html">Información</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Edimer"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://co.linkedin.com/in/edimer-david-jaramillo-94a510199"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 </a>
  </li>  
</ul>
<div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Árbol de clasificación con R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Código</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Enseñar el código</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Esconder el código</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Ver el código</a></li></ul></div></div>
                  <div>
        <div class="description">
          Ejemplo de árboles de decisión en machine learning supervisado para clasificación. Uso de las bibliotecas rpart, rpart.plot y caret en perfilamiento de riesgo crediticio.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Tree Decision</div>
                <div class="quarto-category">ML</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Autor</div>
      <div class="quarto-title-meta-contents">
               <p>Edimer (Sidereus) </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Fecha de Publicación</div>
      <div class="quarto-title-meta-contents">
        <p class="date">18 de julio de 2020</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Tabla de contenido</h2>
   
  <ul>
<li><a href="#contenido" id="toc-contenido" class="nav-link active" data-scroll-target="#contenido">Contenido</a></li>
  <li><a href="#requisitos-previos" id="toc-requisitos-previos" class="nav-link" data-scroll-target="#requisitos-previos">Requisitos previos</a></li>
  <li><a href="#bibliotecas" id="toc-bibliotecas" class="nav-link" data-scroll-target="#bibliotecas">Bibliotecas</a></li>
  <li><a href="#descripci%C3%B3n-de-variables" id="toc-descripción-de-variables" class="nav-link" data-scroll-target="#descripci%C3%B3n-de-variables">Descripción de variables</a></li>
  <li><a href="#datos" id="toc-datos" class="nav-link" data-scroll-target="#datos">Datos</a></li>
  <li><a href="#distribuci%C3%B3n-de-variable-respuesta" id="toc-distribución-de-variable-respuesta" class="nav-link" data-scroll-target="#distribuci%C3%B3n-de-variable-respuesta">Distribución de variable respuesta</a></li>
  <li><a href="#exploratorio" id="toc-exploratorio" class="nav-link" data-scroll-target="#exploratorio">Exploratorio</a></li>
  <li><a href="#inferencia" id="toc-inferencia" class="nav-link" data-scroll-target="#inferencia">Inferencia</a></li>
  <li>
<a href="#%C3%A1rboles-de-decisi%C3%B3n" id="toc-árboles-de-decisión" class="nav-link" data-scroll-target="#%C3%A1rboles-de-decisi%C3%B3n">Árboles de decisión</a>
  <ul class="collapse">
<li><a href="#generalidades" id="toc-generalidades" class="nav-link" data-scroll-target="#generalidades">Generalidades</a></li>
  <li><a href="#train---test" id="toc-train---test" class="nav-link" data-scroll-target="#train---test">Train - Test</a></li>
  <li><a href="#rpart-default" id="toc-rpart-default" class="nav-link" data-scroll-target="#rpart-default"><code>rpart</code> <em>default</em></a></li>
  <li><a href="#tuning-con-caret" id="toc-tuning-con-caret" class="nav-link" data-scroll-target="#tuning-con-caret">Tuning con caret</a></li>
  </ul>
</li>
  <li>
<a href="#complementario" id="toc-complementario" class="nav-link" data-scroll-target="#complementario">Complementario</a>
  <ul class="collapse">
<li><a href="#funci%C3%B3n-plot-caret" id="toc-función-plot-caret" class="nav-link" data-scroll-target="#funci%C3%B3n-plot-caret">Función <code>plot</code> + <code>caret</code></a></li>
  <li><a href="#gr%C3%A1fico-interactivo-con-visnetwork" id="toc-gráfico-interactivo-con-visnetwork" class="nav-link" data-scroll-target="#gr%C3%A1fico-interactivo-con-visnetwork">Gráfico interactivo con <code>visNetwork</code></a></li>
  <li><a href="#funci%C3%B3n-myroc" id="toc-función-myroc" class="nav-link" data-scroll-target="#funci%C3%B3n-myroc">Función <code>myROC()</code></a></li>
  </ul>
</li>
  <li><a href="#recursos-de-informaci%C3%B3n" id="toc-recursos-de-información" class="nav-link" data-scroll-target="#recursos-de-informaci%C3%B3n">Recursos de información</a></li>
  </ul></nav>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p>subscribe.html</p>
</div></div>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><center>
<img src="www/img2.png">
</center>
<section id="contenido" class="level1"><h1>Contenido</h1>
<p><strong>1.</strong> Información general (requisitos previos, bibliotecas, etc).<br><strong>2.</strong> Análisis inicial de los datos. Como el objetivo principal del documento es entrenar un modelo de <em>árbol de decisión</em> con R, el análisis inicial incluye sólo una parte exploratoria y algunas pruebas estadísticas.<br><strong>3.</strong> Entrenamiento de modelo por defecto con <code>rpart</code>.<br><strong>4.</strong> Ajuste de hiperparámetros con la biblioteca <code>caret</code>. La métrica para evaluar el desempeño predictivo de los modelos es el <a href="https://towardsdatascience.com/understanding-auc-roc-curve-68b2303cc9c5">área bajo la curva ROC.</a><br><strong>5.</strong> Material complementario.<br><strong>6.</strong> Recursos de información.</p>
</section><section id="requisitos-previos" class="level1"><h1>Requisitos previos</h1>
<ul>
<li>Instalar las bibliotecas <a href="https://cran.r-project.org/web/packages/rpart/rpart.pdf"><code>rpart</code></a> y <a href="https://cran.r-project.org/web/packages/rpart.plot/rpart.plot.pdf">rpart.plot</a> para entrenar y gráficar modelos basados en árboles.</li>
<li>Instalar la biblioteca <a href="http://topepo.github.io/caret/index.html"><code>caret</code>.</a>
</li>
<li>
<a href="https://www.openml.org/d/31">Descargar datos para ejemplo</a> desde la página <a href="https://www.openml.org/">openML</a>. La base de datos proporciona información de personas perfiladas con riesgo crediticio <em>bueno</em> o <em>malo</em>.</li>
<li>
<strong>Bibliotecas complementarias:</strong> para visualizaciones <strong><code>ggplot2</code></strong>, <strong><code>jcolors</code></strong> y <strong><code>hrbrthemes</code></strong>, para manejo de datos <strong><code>dplyr</code></strong> y para métricas de error y/o precisión <strong><code>Metrics</code></strong> y <strong><code>pROC</code></strong>.</li>
</ul></section><section id="bibliotecas" class="level1"><h1>Bibliotecas</h1>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jaredhuling.github.io/jcolors/">jcolors</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/hrbrmstr/hrbrthemes">hrbrthemes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart">rpart</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.org/rpart-plot/index.html">rpart.plot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mfrasco/Metrics">Metrics</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://expasy.org/tools/pROC/">pROC</a></span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="descripción-de-variables" class="level1"><h1>Descripción de variables</h1>
<ul>
<li>Además de la variable respuesta <em>class</em>, se cuenta con las siguientes 20 variables.</li>
</ul>
<center>
<img src="www/img1.png">
</center>
</section><section id="datos" class="level1"><h1>Datos</h1>
<ul>
<li>Se importan los datos y se aplica la función <code><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_if()</a></code> para eliminar las comillas simples (<em>’’</em>) que están presentes en las variables tipo texto (<code>character</code>). A continuación sólo se muestran 5 variables (columnas) con 10 observaciones. La variable <strong><code>class</code></strong> es nuestro <em>target</em> o <em>variable respuesta</em>.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/dataset_31_credit-g.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_if</a></span><span class="op">(</span><span class="va">is.character</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"'"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">21</span><span class="op">)</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span> <span class="co"># Imprimiendo sólo 5 columnas</span>s</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["checking_status"],"name":[1],"type":["chr"],"align":["left"]},{"label":["credit_amount"],"name":[2],"type":["int"],"align":["right"]},{"label":["other_parties"],"name":[3],"type":["chr"],"align":["left"]},{"label":["housing"],"name":[4],"type":["chr"],"align":["left"]},{"label":["class"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"<0","2":"1169","3":"none","4":"own","5":"good"},{"1":"0<=X<200","2":"5951","3":"none","4":"own","5":"bad"},{"1":"no checking","2":"2096","3":"none","4":"own","5":"good"},{"1":"<0","2":"7882","3":"guarantor","4":"for free","5":"good"},{"1":"<0","2":"4870","3":"none","4":"for free","5":"bad"},{"1":"no checking","2":"9055","3":"none","4":"for free","5":"good"},{"1":"no checking","2":"2835","3":"none","4":"own","5":"good"},{"1":"0<=X<200","2":"6948","3":"none","4":"rent","5":"good"},{"1":"no checking","2":"3059","3":"none","4":"own","5":"good"},{"1":"0<=X<200","2":"5234","3":"none","4":"own","5":"bad"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ul>
<li><strong>Dimensión de la base de datos:</strong></li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1000   21</code></pre>
</div>
</div>
</section><section id="distribución-de-variable-respuesta" class="level1"><h1>Distribución de variable respuesta</h1>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">class</span>, fill <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#5A5156"</span>, <span class="st">"#F6222E"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/hrbrthemes/man/theme_ipsum.html">theme_ipsum</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="TreeD_R_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="exploratorio" class="level1"><h1>Exploratorio</h1>
<ul>
<li>
<strong>Distribución de edad por variable objetivo:</strong> se puede apreciar que la edad promedio de los clasificados como <em>“buenos”</em> es más alta, además, los clasificados como <em>“malos”</em> en su mayoría son personas entre 20 y 30 años de edad.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">class</span>, y <span class="op">=</span> <span class="va">age</span>, fill <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#E4E1E3"</span>, width <span class="op">=</span> <span class="fl">0.1</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun.y <span class="op">=</span> <span class="va">mean</span>, color <span class="op">=</span> <span class="st">"#E4E1E3"</span>, pch <span class="op">=</span> <span class="fl">17</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#5A5156"</span>, <span class="st">"#F6222E"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/hrbrthemes/man/theme_ipsum.html">theme_ipsum</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"El triángulo representa el promedio."</span><span class="op">)</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="TreeD_R_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<strong>Propósitos de crédito más frecuentes:</strong> la distribución de personas clasificadas como <em>buenas</em> o <em>malas</em> cuando el propósito es vehículo, discrepa bastante entre la opción de <strong>nuevo</strong> o <strong>usado</strong>. En vehículos usados la gran mayoría son clasificados como “buenos”, sin embargo, cuando se trata de vehículos nuevos, la distribución es similar, lo que permite inferir que es más probable que una persona se comporte como mal pagador en créditos para vehículo nuevo respecto a créditos para vehículos usados. También se podría intuir que cuando se trata de créditos para educación es igual de probable que la persona sea clasificada como “bueno” o “malo”.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">purpose</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">purpose</span>, <span class="va">n</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#E4E1E3"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#5A5156"</span>, <span class="st">"#F6222E"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Purpose"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/hrbrthemes/man/theme_ipsum.html">theme_ipsum</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="TreeD_R_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="inferencia" class="level1"><h1>Inferencia</h1>
<ul>
<li>
<strong>Análisis de varianza:</strong> en vista de la discrepancia que se observa en la distribución de las edades para personas clasificadas como “buenas” o “malas”, realizo el <a href="https://es.wikipedia.org/wiki/An%C3%A1lisis_de_la_varianza">análisis de varianza</a> para contrastar si dichas diferencias son estadísticamente significativas. <strong>Nota:</strong> aunque nuestra variable respuesta es <em>class</em>, en este caso actúa como “predictora” o fuente de variación.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">myAnova</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">age</span> <span class="op">~</span> <span class="va">class</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">myAnova</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>             Df Sum Sq Mean Sq F value  Pr(&gt;F)   
class         1   1074  1073.5   8.357 0.00393 **
Residuals   998 128198   128.5                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<ul>
<li>El resultado de la prueba muestra que existe evidencia estadísticamente significativa (<em>p=0.00393</em>) para considerar que la variación de la edad entre ambos grupos es diferente.</li>
</ul></section><section id="árboles-de-decisión" class="level1"><h1>Árboles de decisión</h1>
<center>
<img src="www/img3.png">
</center>
<section id="generalidades" class="level2"><h2 class="anchored" data-anchor-id="generalidades">Generalidades</h2>
<center>
<img src="www/img4.png">
</center>
<ul>
<li>Los árboles de decisión se pueden utilizar para problemas de regresión y clasificación.</li>
<li>Se pueden definir como una estructura jerárquica que busca particionar el espacio de características e identificar subconjuntos representativos. Desde la parte superior a inferior cada árbol tiene <em>nodo raíz</em>, <em>nodos de decisión o internos</em> y <em>nodos hojas o terminales</em>, los dos primeros se generan con base en reglas binarias. Mayor grado de pureza es la recompensa que busca el algoritmo al particionar el espacio inicial en subregiones, en ese orden de ideas el objetivo siempre será particionar los datos en nodos que sean lo más puros posible, sin embargo, matemáticamente es más fácil medir la <strong>impureza</strong> de una región específica, proporcionando una idea de qué tan heterogéneas son las clases en ese nodo; una métrica de uso común en problemas de clasificación para medir la impureza es el <strong>índice GINI</strong>, donde valores bajos indican mayor grado de pureza. Además del índice GINI también es posible utilizar otras métricas como la <strong>ganancia de información</strong> o la <strong>entropía</strong>.</li>
<li>
<strong>Ventajas:</strong>
<ul>
<li>Fácil de interpretar (sujeto a la profundidad).</li>
<li>No requieren estandarización o normalización de variables predictoras numéricas.</li>
<li>Permiten manipular variables categóricas sin necesidad de aplicar codificaciones tipo <em>one-hot</em> o <em>variables dummy</em>.</li>
<li>Requieren poco preprocesamiento de datos.</li>
<li>Permiten valores ausentes (<code>NA</code>).</li>
<li>Permite relaciones no lineales.</li>
</ul>
</li>
<li>
<strong>Desventajas:</strong>
<ul>
<li>Si no se controla adecuadamente la profundidad del árbol existe alta probabilidad de incurrir en <a href="https://es.wikipedia.org/wiki/Sobreajuste"><em>sobreajuste (overfitting)</em>.</a>
</li>
<li>Alta varianza, pequeños cambios en los datos pueden arrojar resultados muy diferentes.</li>
</ul>
</li>
<li>
<strong>Hiperparámetros:</strong> aunque ejecutar la función <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart()</a></code> con valores predeterminados puede ser una buena estrategia para iniciar, siempre estaremos interesados en ajustar determinados parámetros que nos permitan obtener mejor rendimiento predictivo. La función <code><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control()</a></code> permite controlar manualmente otras opciones. Dentro los hiperparámetros más importantes en árboles de decisión están los siguientes:
<ul>
<li>Mínimo número de observaciones para generar una partición. En la biblioteca <code>rpart</code> lleva el nombre de <code>minsplit</code> y su valor por defecto es 20.</li>
<li>Máxima profundiad del árbol. En la biblioteca <code>rpart</code> lleva el nombre de <code>maxdepth</code> y su valor predeterminado es 30. Este parámetro es de alta relevancia para evitar el sobreajuste.</li>
<li>Parámetro de complejidad. En la biblioteca <code>rpart</code> lleva el nombre de <code>cp</code> y su valor por defecto es 0.01. Este parámetro sirve al propósito de penalizar y contolar el tamaño del árbol, valores bajos indican árboles de mayor complejidad, es decir, mayor número de divisiones. La función <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart()</a></code> internamente ejecuta <a href="https://es.wikipedia.org/wiki/Validaci%C3%B3n_cruzada">validación cruzada</a> 10 veces para estimar el valor óptimo de <strong>cp</strong>, es posible acceder a dicho resultado a través de la función <code><a href="https://rdrr.io/pkg/rpart/man/plotcp.html">plotcp()</a></code> que permitirá facilmente determinar el valor adecuado para este parámetro. Cuando se tiene el valor óptimo de <strong>cp</strong> será posible “podar” el árbol para que el modelo sea optimizado, dicho resultado es posible a través de la función <code><a href="https://rdrr.io/pkg/rpart/man/prune.rpart.html">prune()</a></code>.</li>
</ul>
</li>
</ul></section><section id="train---test" class="level2"><h2 class="anchored" data-anchor-id="train---test">Train - Test</h2>
<ul>
<li>Para entrenar el modelo inicialmente fracciono los datos en <em>train</em> y <em>test</em> con proporciones de 70 y 30%, respectivamente. Este proceso aunque es posible hacerlo manualmente con la función <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code>, la función <code><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition()</a></code> del paquete <code>caret</code> agiliza el procedimiento. Para garantizar replicabilidad en los resultados se agrega la semilla.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1992</span><span class="op">)</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">class</span>, times <span class="op">=</span> <span class="fl">1</span>, p <span class="op">=</span> <span class="fl">0.70</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dataTrain</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">idx</span>, <span class="op">]</span></span>
<span><span class="va">dataTest</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="va">idx</span>, <span class="op">]</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="rpart-default" class="level2"><h2 class="anchored" data-anchor-id="rpart-default">
<code>rpart</code> <em>default</em>
</h2>
<ul>
<li>
<strong>Ajuste del modelo:</strong> en este caso se utilizan todas las variables predictoras para entrenar el modelo. Al imprimir el objeto que contiene el modelo podemos observar el conjunto de reglas que dan como resultado la estructura final del árbol. El método igualado a <strong><code>method = "class"</code></strong> indica que es un problema de clasificación, si fuese un problema de regresión el argumento tomaría el valor de <strong><code>method = "anova"</code></strong>, aunque también permite otras opciones (consulte <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html">?rpart</a></code> o <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html">help("rpart")</a></code>).</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modArbol0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">dataTrain</span>, method <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">modArbol0</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>n= 700 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

  1) root 700 210 good (0.3000000 0.7000000)  
    2) checking_status=&lt;0,0&lt;=X&lt;200 385 168 good (0.4363636 0.5636364)  
      4) credit_history=all paid,no credits/all paid 51  14 bad (0.7254902 0.2745098)  
        8) savings_status=&lt;100,100&lt;=X&lt;500 42   8 bad (0.8095238 0.1904762) *
        9) savings_status=500&lt;=X&lt;1000,no known savings 9   3 good (0.3333333 0.6666667) *
      5) credit_history=critical/other existing credit,delayed previously,existing paid 334 131 good (0.3922156 0.6077844)  
       10) duration&gt;=27.5 77  30 bad (0.6103896 0.3896104)  
         20) purpose=domestic appliance,education,furniture/equipment,new car 39  10 bad (0.7435897 0.2564103) *
         21) purpose=business,other,radio/tv,repairs,used car 38  18 good (0.4736842 0.5263158)  
           42) checking_status=&lt;0 19   7 bad (0.6315789 0.3684211) *
           43) checking_status=0&lt;=X&lt;200 19   6 good (0.3157895 0.6842105) *
       11) duration&lt; 27.5 257  84 good (0.3268482 0.6731518)  
         22) purpose=domestic appliance,education,new car,retraining 83  41 good (0.4939759 0.5060241)  
           44) age&lt; 35.5 42  13 bad (0.6904762 0.3095238)  
             88) credit_amount&lt; 1392 20   1 bad (0.9500000 0.0500000) *
             89) credit_amount&gt;=1392 22  10 good (0.4545455 0.5454545)  
              178) property_magnitude=life insurance,real estate 13   4 bad (0.6923077 0.3076923) *
              179) property_magnitude=car,no known property 9   1 good (0.1111111 0.8888889) *
           45) age&gt;=35.5 41  12 good (0.2926829 0.7073171) *
         23) purpose=business,furniture/equipment,other,radio/tv,repairs,used car 174  43 good (0.2471264 0.7528736) *
    3) checking_status=&gt;=200,no checking 315  42 good (0.1333333 0.8666667) *</code></pre>
</div>
</div>
<ul>
<li>
<strong>Gráfico del modelo:</strong> la variable más importante y que da origen al nodo raíz es <strong><code>checking_status</code></strong>, que hace referencia al estado de la cuenta corriente. El historial crediticio, la duración del tiempo para pagar el crédito, el estado de la cuenta de ahorros y el propósito del crédito, también son factores determinantes. No tener suficiente capital en cualquiera de las dos cuentas, tener mal historial crediticio y además solicitar períodos de pago de alta duración, pueden ser características no deseables a la hora de solicitar un crédito.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">modArbol0</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="TreeD_R_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<strong>Matriz de confusión:</strong> el modelo por <em>default</em> tiene precisión promedio de 0.7167, con dificultades para clasificar de forma correcta los “malos”, es decir, que tiene baja especificidad.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">predichos_mod0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">modArbol0</span>, newdata <span class="op">=</span> <span class="va">dataTest</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predichos_mod0</span>, reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">dataTest</span><span class="op">$</span><span class="va">class</span><span class="op">)</span>,</span>
<span>                positive <span class="op">=</span> <span class="st">"good"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction bad good
      bad   31   26
      good  59  184
                                        
               Accuracy : 0.7167        
                 95% CI : (0.662, 0.767)
    No Information Rate : 0.7           
    P-Value [Acc &gt; NIR] : 0.2873596     
                                        
                  Kappa : 0.2465        
                                        
 Mcnemar's Test P-Value : 0.0005187     
                                        
            Sensitivity : 0.8762        
            Specificity : 0.3444        
         Pos Pred Value : 0.7572        
         Neg Pred Value : 0.5439        
             Prevalence : 0.7000        
         Detection Rate : 0.6133        
   Detection Prevalence : 0.8100        
      Balanced Accuracy : 0.6103        
                                        
       'Positive' Class : good          
                                        </code></pre>
</div>
</div>
<ul>
<li><strong>Área bajo la curva:</strong></li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Probabilidades predichas para la clase "good"</span></span>
<span><span class="va">pred0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">modArbol0</span>,</span>
<span>                               newdata <span class="op">=</span> <span class="va">dataTest</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">good</span></span>
<span></span>
<span><span class="co"># Transformando respuesta a entero. A la clase "good" le agrego 1 y </span></span>
<span><span class="co"># a la clase "bad" le agrego 0.</span></span>
<span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">dataTest</span><span class="op">$</span><span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># AUC</span></span>
<span><span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/auc.html">auc</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">target</span>, predicted <span class="op">=</span> <span class="va">pred0</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7034392</code></pre>
</div>
</div>
<ul>
<li>
<strong>Curva ROC:</strong> la función con la que obtengo el siguiente gráfico puede ser encontrada en <a href="https://github.com/web-edimer/web-edimer.github.io/blob/master/_posts/TreeD_R/functions/myROC.R">mi Github.</a>
</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Cargando función</span>n</span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"functions/myROC.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ver función myROC() al final en material complementario    </span> </span>
<span><span class="fu">myROC</span><span class="op">(</span>predichos <span class="op">=</span> <span class="va">pred0</span>, reales <span class="op">=</span> <span class="va">target</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="TreeD_R_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>Parámetro de complejidad (CP):</strong></li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/rpart/man/plotcp.html">plotcp</a></span><span class="op">(</span><span class="va">modArbol0</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="TreeD_R_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<strong>“Podando” el árbol:</strong> se elige el valor de cp = 0.025 por mostrar mejores resultados (bajo error).</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modArbol0_prune</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/prune.rpart.html">prune</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">modArbol0</span>, cp <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span></span>
<span><span class="va">modArbol0_prune</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>n= 700 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

 1) root 700 210 good (0.3000000 0.7000000)  
   2) checking_status=&lt;0,0&lt;=X&lt;200 385 168 good (0.4363636 0.5636364)  
     4) credit_history=all paid,no credits/all paid 51  14 bad (0.7254902 0.2745098) *
     5) credit_history=critical/other existing credit,delayed previously,existing paid 334 131 good (0.3922156 0.6077844)  
      10) duration&gt;=27.5 77  30 bad (0.6103896 0.3896104) *
      11) duration&lt; 27.5 257  84 good (0.3268482 0.6731518)  
        22) purpose=domestic appliance,education,new car,retraining 83  41 good (0.4939759 0.5060241)  
          44) age&lt; 35.5 42  13 bad (0.6904762 0.3095238) *
          45) age&gt;=35.5 41  12 good (0.2926829 0.7073171) *
        23) purpose=business,furniture/equipment,other,radio/tv,repairs,used car 174  43 good (0.2471264 0.7528736) *
   3) checking_status=&gt;=200,no checking 315  42 good (0.1333333 0.8666667) *</code></pre>
</div>
</div>
<ul>
<li><strong>Gráfico de árbol con “poda”:</strong></li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">modArbol0_prune</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="TreeD_R_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<strong>Matriz de confusión árbol con “poda”:</strong> respecto al árbol sin podar, la diferencia en precisión es muy pequeña (&lt;0.01), sin embargo, la especificidad se aumenta de 0.3444 a 0.4556 con la “poda”, aunque la sensitividad haya reducido de 0.8762 a 0.8381.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">predichos_mod0_prune</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">modArbol0_prune</span>, newdata <span class="op">=</span> <span class="va">dataTest</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predichos_mod0_prune</span>, reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">dataTest</span><span class="op">$</span><span class="va">class</span><span class="op">)</span>,</span>
<span>                positive <span class="op">=</span> <span class="st">"good"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction bad good
      bad   41   34
      good  49  176
                                         
               Accuracy : 0.7233         
                 95% CI : (0.669, 0.7732)
    No Information Rate : 0.7            
    P-Value [Acc &gt; NIR] : 0.2072         
                                         
                  Kappa : 0.3083         
                                         
 Mcnemar's Test P-Value : 0.1244         
                                         
            Sensitivity : 0.8381         
            Specificity : 0.4556         
         Pos Pred Value : 0.7822         
         Neg Pred Value : 0.5467         
             Prevalence : 0.7000         
         Detection Rate : 0.5867         
   Detection Prevalence : 0.7500         
      Balanced Accuracy : 0.6468         
                                         
       'Positive' Class : good           
                                         </code></pre>
</div>
</div>
<ul>
<li><strong>Área bajo la curva de árbol con “poda”:</strong></li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Probabilidades predichas para la clase "good"</span></span>
<span><span class="va">pred0_prune</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">modArbol0_prune</span>,</span>
<span>                                     newdata <span class="op">=</span> <span class="va">dataTest</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">good</span></span>
<span></span>
<span><span class="co"># AUC</span></span>
<span><span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/auc.html">auc</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">target</span>, predicted <span class="op">=</span> <span class="va">pred0_prune</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7203175</code></pre>
</div>
</div>
<ul>
<li><strong>Curva ROC:</strong></li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ver función myROC() al final en material complementario    </span> </span>
<span><span class="fu">myROC</span><span class="op">(</span>predichos <span class="op">=</span> <span class="va">pred0_prune</span>, reales <span class="op">=</span> <span class="va">target</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="TreeD_R_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="tuning-con-caret" class="level2"><h2 class="anchored" data-anchor-id="tuning-con-caret">Tuning con caret</h2>
<ul>
<li>A diferencia de los parámetros que se “aprenden” duarante el entrenamiento del modelo, los hipeparámetros se definen previo al ajuste del mismo.</li>
<li>El ajuste de <a href="https://en.wikipedia.org/wiki/Hyperparameter_(machine_learning)">hiperparámetros</a> se constituye como parte fundamental de la optimización del modelo.</li>
<li>La biblioteca <a href="http://topepo.github.io/caret/index.html"><code>caret</code></a> proporciona un marco de trabajo unificado para entrenar y validar modelos de machine learning. En este caso, con <code>caret</code> podremos ajustar dos de los tres hiperparámetros mencionados anteriormente, el parámetro de complejidad y la profundidad del árbol. Las funciones <strong><code><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl()</a></code></strong> y <strong><code>train</code></strong> de la biblioteca <code>caret</code> facilitan el proceso.
<ul>
<li>
<strong><code><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl()</a></code>:</strong> permite establecer la estrategia de validación, por ejemplo validación cruzada <em>k-fold</em>, validación cruzada repetida, bootstrapping, entre otras. Desde esta misma función también es posible determinar el método de búsqueda de hiperparámetros, que puede ser <em>aleatoria</em> o <em>cuadrícula (grid)</em>. En este caso particular utilizo <em>validación cruzada con repeticiones</em>, con k = 5 y 3 repeticiones. El argumento <code>summaryFunction = twoClassSummary</code> permite computar las métricas necesarias (sensitividad y especificidad) para obtener ROC. Busque más ayuda con <code><a href="https://rdrr.io/pkg/caret/man/trainControl.html">help("trainControl")</a></code>.</li>
<li>
<strong><code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code>:</strong> ajuste el modelo estableciendo la fórmula habitual en R, el método o algoritmo para entrenar, (<a href="http://topepo.github.io/caret/available-models.html">lista de algoritmos en <code>caret</code></a>) los datos, la configuración para el entrenamiento (<code>tcConrol = myControl</code>) y la longitud de hiperparámetros a considerar en el entrenamiento (<code>tuneLenth</code>). Este último argumento dependerá de los hiperparámetros que estén disponibles en <code>caret</code>, aunque también es posible asignarlos manualmente a través de <code><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid()</a></code>. Utilizar el método igualado a “rpart” permitirá optimizar el parámetro <em>cp</em> y utilizando “rpart2” es posible optimizar la máxima profundidad del árbol. Cuando se declara <code>tuneLength = 5</code> se informa que el número máximo de profundidades a probar será 5, es decir, que al final existirán 5 resultados diferentes con el mismo algoritmo. Por último, se agrega la métrica que será utilizada para comparar los resultados de la validación cruzada.</li>
</ul>
</li>
<li>
<strong>Nota:</strong> como el procedimiento de validación cruzada implica muestreo aleatorio, es necesario asignar la semilla para garantizar replicabilidad de resultados.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">myControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"repeatedcv"</span>,</span>
<span>                          number <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                          repeats <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          classProbs <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># Permite predecir probabilidades</span></span>
<span>                          summaryFunction <span class="op">=</span> <span class="va">twoClassSummary</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1992</span><span class="op">)</span></span>
<span><span class="va">modArbol_tune</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                       method <span class="op">=</span> <span class="st">"rpart2"</span>,</span>
<span>                       data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                       trControl <span class="op">=</span> <span class="va">myControl</span>,</span>
<span>                       tuneLength <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                       metric <span class="op">=</span> <span class="st">"ROC"</span><span class="op">)</span></span>
<span><span class="va">modArbol_tune</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>CART 

1000 samples
  20 predictor
   2 classes: 'bad', 'good' 

No pre-processing
Resampling: Cross-Validated (5 fold, repeated 3 times) 
Summary of sample sizes: 800, 800, 800, 800, 800, 800, ... 
Resampling results across tuning parameters:

  maxdepth  ROC        Sens       Spec     
   3        0.7028968  0.3011111  0.8885714
   6        0.7138095  0.3244444  0.8880952
  11        0.7211151  0.3988889  0.8642857
  14        0.7213571  0.4055556  0.8623810
  18        0.7211746  0.3911111  0.8671429

ROC was used to select the optimal model using the largest value.
The final value used for the model was maxdepth = 14.</code></pre>
</div>
</div>
<ul>
<li>Se observa que la mejor profundidad es 14 con la mayor sensitividad aún cuando no tiene la mejor especificidad. A continuación la matriz de confusión en el conjunto de test muestra mejoras en la capacidad de detectar los clasificados como “malos”, ademas la precisión es notablemente superior.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">predichos_tune</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">modArbol_tune</span>, newdata <span class="op">=</span> <span class="va">dataTest</span>, type <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predichos_tune</span>, reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">dataTest</span><span class="op">$</span><span class="va">class</span><span class="op">)</span>,</span>
<span>                positive <span class="op">=</span> <span class="st">"good"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction bad good
      bad   52   29
      good  38  181
                                          
               Accuracy : 0.7767          
                 95% CI : (0.7253, 0.8225)
    No Information Rate : 0.7             
    P-Value [Acc &gt; NIR] : 0.001839        
                                          
                  Kappa : 0.4526          
                                          
 Mcnemar's Test P-Value : 0.328393        
                                          
            Sensitivity : 0.8619          
            Specificity : 0.5778          
         Pos Pred Value : 0.8265          
         Neg Pred Value : 0.6420          
             Prevalence : 0.7000          
         Detection Rate : 0.6033          
   Detection Prevalence : 0.7300          
      Balanced Accuracy : 0.7198          
                                          
       'Positive' Class : good            
                                          </code></pre>
</div>
</div>
<ul>
<li>
<strong>Área bajo la curva</strong> el modelo evidentemente consigue mejores resultados respecto a los ajustados inicialmente, de tal manera que el ajuste de hiperparámetros ha logrado mejorar nuestras predicciones en datos que el modelo aún no ha visto. Posiblemente el hecho de ajustar la máxima profundidad sumado al uso de validación cruzada, permite que el modelo capture de mejor manera las relaciones subyacentes entre características.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Probabilidades predichas para la clase "good"</span></span>
<span><span class="va">pred_tune</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">modArbol_tune</span>,</span>
<span>                                   newdata <span class="op">=</span> <span class="va">dataTest</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">good</span></span>
<span></span>
<span><span class="co"># AUC</span></span>
<span><span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/auc.html">auc</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">target</span>, predicted <span class="op">=</span> <span class="va">pred_tune</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7888624</code></pre>
</div>
</div>
<ul>
<li><strong>Curva ROC:</strong></li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ver función myROC() al final en material complementario    </span> </span>
<span><span class="fu">myROC</span><span class="op">(</span>predichos <span class="op">=</span> <span class="va">pred_tune</span>, reales <span class="op">=</span> <span class="va">target</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="TreeD_R_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="complementario" class="level1"><h1>Complementario</h1>
<section id="función-plot-caret" class="level2"><h2 class="anchored" data-anchor-id="función-plot-caret">Función <code>plot</code> + <code>caret</code>
</h2>
<ul>
<li>La función <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> tiene un método específico para resultados obtenidos a través de <code>caret</code>, en este caso muestra el gráfico del hiperparámetro de interés, la máxima profundidad del árbol vs la curva ROC en el eje Y, tratando de evidenicar el valor óptimo.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">modArbol_tune</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="TreeD_R_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="gráfico-interactivo-con-visnetwork" class="level2"><h2 class="anchored" data-anchor-id="gráfico-interactivo-con-visnetwork">Gráfico interactivo con <code>visNetwork</code>
</h2>
<ul>
<li>La biblioteca <a href="https://datastorm-open.github.io/visNetwork/"><code>visNetwork</code></a> permite crear gráficos interactivos para objetos de la clase <em>rpart</em>. A manera de ejemplo se presenta el gráfico para el árbol de decisión con poda. Recuerde que es interactivo y puede manipularlo con el <em>mouse</em>.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://datastorm-open.github.io/visNetwork/">visNetwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visTree.html">visTree</a></span><span class="op">(</span><span class="va">modArbol0_prune</span>, </span>
<span>        main <span class="op">=</span> <span class="st">"Árbol con poda"</span>", width<span class="op">=</span>=<span class="st">"100%"</span>",</span>
<span>        height <span class="op">=</span> <span class="st">"800px"</span>,  edgesFontSize <span class="op">=</span> <span class="fl">14</span>, nodesFontSize <span class="op">=</span> <span class="fl">16</span>,<span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="htmlwidget-4b2849920125f3c0d1eb" style="width:100%;height:800px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-4b2849920125f3c0d1eb">{"x":{"nodes":{"id":[1,2,4,5,10,11,22,44,45,23,3],"label":["checking_status","credit_history","bad","duration","bad","purpose","age","bad","good","good","good"],"level":[1,2,3,3,4,4,5,6,6,5,2],"color":["#F1B8C2","#DAC49C","#7D91B6","#A9D1A5","#7D91B6","#8AD3D0","#B4C7ED","#7D91B6","#B9828C","#B9828C","#B9828C"],"value":[700,385,51,334,77,257,83,42,41,174,315],"shape":["dot","dot","square","dot","square","dot","dot","square","square","square","square"],"title":["<div style=\"text-align:center;\">N : <b>100%<\/b> (700)<br>Complexity : <b>0.055<\/b><br>bad : <b>30%<\/b> (210)<br>good : <b>70%<\/b> (490)<\/div>","<div style=\"text-align:center;\">N : <b>55%<\/b> (385)<br>Complexity : <b>0.055<\/b><br>bad : <b>43.6%<\/b> (168)<br>good : <b>56.4%<\/b> (217)<hr class = \"rPartvisNetwork\">\n<div class =\"showOnMe2\"><div style=\"text-align:center;\"><U style=\"color:blue;\"  onmouseover=\"this.style.cursor='pointer';\" onmouseout=\"this.style.cursor='default';\">Rules<\/U><\/div>\n<div class=\"showMeRpartTTp2\" style=\"display:none;\">\n<b> checking_status <\/b> <0, 0<=X<200<\/script><script type=\"text/javascript\">$(document).ready(function(){\n$(\".showOnMe2\").click(function(){\n$(\".showMeRpartTTp2\").toggle();\n$.sparkline_display_visible();\n});\n  });<\/script><\/div><\/div>\n\n<\/div>","<div style=\"text-align:center;\">N : <b>7.3%<\/b> (51)<br>Complexity : <b>0.014<\/b><br>bad : <b>72.5%<\/b> (37)<br>good : <b>27.5%<\/b> (14)<hr class = \"rPartvisNetwork\">\n<div class =\"showOnMe2\"><div style=\"text-align:center;\"><U style=\"color:blue;\"  onmouseover=\"this.style.cursor='pointer';\" onmouseout=\"this.style.cursor='default';\">Rules<\/U><\/div>\n<div class=\"showMeRpartTTp2\" style=\"display:none;\">\n<b> checking_status <\/b> <0, 0<=X<200<br><b> credit_history <\/b> all paid, no credits/all paid<\/script><script type=\"text/javascript\">$(document).ready(function(){\n$(\".showOnMe2\").click(function(){\n$(\".showMeRpartTTp2\").toggle();\n$.sparkline_display_visible();\n});\n  });<\/script><\/div><\/div>\n\n<\/div>","<div style=\"text-align:center;\">N : <b>47.7%<\/b> (334)<br>Complexity : <b>0.055<\/b><br>bad : <b>39.2%<\/b> (131)<br>good : <b>60.8%<\/b> (203)<hr class = \"rPartvisNetwork\">\n<div class =\"showOnMe2\"><div style=\"text-align:center;\"><U style=\"color:blue;\"  onmouseover=\"this.style.cursor='pointer';\" onmouseout=\"this.style.cursor='default';\">Rules<\/U><\/div>\n<div class=\"showMeRpartTTp2\" style=\"display:none;\">\n<b> checking_status <\/b> <0, 0<=X<200<br><b> credit_history <\/b> critical/other existing credit, delayed previously, existing paid<\/script><script type=\"text/javascript\">$(document).ready(function(){\n$(\".showOnMe2\").click(function(){\n$(\".showMeRpartTTp2\").toggle();\n$.sparkline_display_visible();\n});\n  });<\/script><\/div><\/div>\n\n<\/div>","<div style=\"text-align:center;\">N : <b>11%<\/b> (77)<br>Complexity : <b>0.017<\/b><br>bad : <b>61%<\/b> (47)<br>good : <b>39%<\/b> (30)<hr class = \"rPartvisNetwork\">\n<div class =\"showOnMe2\"><div style=\"text-align:center;\"><U style=\"color:blue;\"  onmouseover=\"this.style.cursor='pointer';\" onmouseout=\"this.style.cursor='default';\">Rules<\/U><\/div>\n<div class=\"showMeRpartTTp2\" style=\"display:none;\">\n<b> checking_status <\/b> <0, 0<=X<200<br><b> credit_history <\/b> critical/other existing credit, delayed previously, existing paid<br><b> duration <\/b> >= 27.5<\/script><script type=\"text/javascript\">$(document).ready(function(){\n$(\".showOnMe2\").click(function(){\n$(\".showMeRpartTTp2\").toggle();\n$.sparkline_display_visible();\n});\n  });<\/script><\/div><\/div>\n\n<\/div>","<div style=\"text-align:center;\">N : <b>36.7%<\/b> (257)<br>Complexity : <b>0.038<\/b><br>bad : <b>32.7%<\/b> (84)<br>good : <b>67.3%<\/b> (173)<hr class = \"rPartvisNetwork\">\n<div class =\"showOnMe2\"><div style=\"text-align:center;\"><U style=\"color:blue;\"  onmouseover=\"this.style.cursor='pointer';\" onmouseout=\"this.style.cursor='default';\">Rules<\/U><\/div>\n<div class=\"showMeRpartTTp2\" style=\"display:none;\">\n<b> checking_status <\/b> <0, 0<=X<200<br><b> credit_history <\/b> critical/other existing credit, delayed previously, existing paid<br><b> duration <\/b> < 27.5<\/script><script type=\"text/javascript\">$(document).ready(function(){\n$(\".showOnMe2\").click(function(){\n$(\".showMeRpartTTp2\").toggle();\n$.sparkline_display_visible();\n});\n  });<\/script><\/div><\/div>\n\n<\/div>","<div style=\"text-align:center;\">N : <b>11.9%<\/b> (83)<br>Complexity : <b>0.038<\/b><br>bad : <b>49.4%<\/b> (41)<br>good : <b>50.6%<\/b> (42)<hr class = \"rPartvisNetwork\">\n<div class =\"showOnMe2\"><div style=\"text-align:center;\"><U style=\"color:blue;\"  onmouseover=\"this.style.cursor='pointer';\" onmouseout=\"this.style.cursor='default';\">Rules<\/U><\/div>\n<div class=\"showMeRpartTTp2\" style=\"display:none;\">\n<b> checking_status <\/b> <0, 0<=X<200<br><b> credit_history <\/b> critical/other existing credit, delayed previously, existing paid<br><b> duration <\/b> < 27.5<br><b> purpose <\/b> domestic appliance, education, new car, retraining<\/script><script type=\"text/javascript\">$(document).ready(function(){\n$(\".showOnMe2\").click(function(){\n$(\".showMeRpartTTp2\").toggle();\n$.sparkline_display_visible();\n});\n  });<\/script><\/div><\/div>\n\n<\/div>","<div style=\"text-align:center;\">N : <b>6%<\/b> (42)<br>Complexity : <b>0.017<\/b><br>bad : <b>69%<\/b> (29)<br>good : <b>31%<\/b> (13)<hr class = \"rPartvisNetwork\">\n<div class =\"showOnMe2\"><div style=\"text-align:center;\"><U style=\"color:blue;\"  onmouseover=\"this.style.cursor='pointer';\" onmouseout=\"this.style.cursor='default';\">Rules<\/U><\/div>\n<div class=\"showMeRpartTTp2\" style=\"display:none;\">\n<b> checking_status <\/b> <0, 0<=X<200<br><b> credit_history <\/b> critical/other existing credit, delayed previously, existing paid<br><b> duration <\/b> < 27.5<br><b> purpose <\/b> domestic appliance, education, new car, retraining<br><b> age <\/b> < 35.5<\/script><script type=\"text/javascript\">$(document).ready(function(){\n$(\".showOnMe2\").click(function(){\n$(\".showMeRpartTTp2\").toggle();\n$.sparkline_display_visible();\n});\n  });<\/script><\/div><\/div>\n\n<\/div>","<div style=\"text-align:center;\">N : <b>5.9%<\/b> (41)<br>Complexity : <b>0.01<\/b><br>bad : <b>29.3%<\/b> (12)<br>good : <b>70.7%<\/b> (29)<hr class = \"rPartvisNetwork\">\n<div class =\"showOnMe2\"><div style=\"text-align:center;\"><U style=\"color:blue;\"  onmouseover=\"this.style.cursor='pointer';\" onmouseout=\"this.style.cursor='default';\">Rules<\/U><\/div>\n<div class=\"showMeRpartTTp2\" style=\"display:none;\">\n<b> checking_status <\/b> <0, 0<=X<200<br><b> credit_history <\/b> critical/other existing credit, delayed previously, existing paid<br><b> duration <\/b> < 27.5<br><b> purpose <\/b> domestic appliance, education, new car, retraining<br><b> age <\/b> >= 35.5<\/script><script type=\"text/javascript\">$(document).ready(function(){\n$(\".showOnMe2\").click(function(){\n$(\".showMeRpartTTp2\").toggle();\n$.sparkline_display_visible();\n});\n  });<\/script><\/div><\/div>\n\n<\/div>","<div style=\"text-align:center;\">N : <b>24.9%<\/b> (174)<br>Complexity : <b>0.01<\/b><br>bad : <b>24.7%<\/b> (43)<br>good : <b>75.3%<\/b> (131)<hr class = \"rPartvisNetwork\">\n<div class =\"showOnMe2\"><div style=\"text-align:center;\"><U style=\"color:blue;\"  onmouseover=\"this.style.cursor='pointer';\" onmouseout=\"this.style.cursor='default';\">Rules<\/U><\/div>\n<div class=\"showMeRpartTTp2\" style=\"display:none;\">\n<b> checking_status <\/b> <0, 0<=X<200<br><b> credit_history <\/b> critical/other existing credit, delayed previously, existing paid<br><b> duration <\/b> < 27.5<br><b> purpose <\/b> business, furniture/equipment, other, radio/tv, repairs, used car<\/script><script type=\"text/javascript\">$(document).ready(function(){\n$(\".showOnMe2\").click(function(){\n$(\".showMeRpartTTp2\").toggle();\n$.sparkline_display_visible();\n});\n  });<\/script><\/div><\/div>\n\n<\/div>","<div style=\"text-align:center;\">N : <b>45%<\/b> (315)<br>Complexity : <b>0.01<\/b><br>bad : <b>13.3%<\/b> (42)<br>good : <b>86.7%<\/b> (273)<hr class = \"rPartvisNetwork\">\n<div class =\"showOnMe2\"><div style=\"text-align:center;\"><U style=\"color:blue;\"  onmouseover=\"this.style.cursor='pointer';\" onmouseout=\"this.style.cursor='default';\">Rules<\/U><\/div>\n<div class=\"showMeRpartTTp2\" style=\"display:none;\">\n<b> checking_status <\/b> >=200, no checking<\/script><script type=\"text/javascript\">$(document).ready(function(){\n$(\".showOnMe2\").click(function(){\n$(\".showMeRpartTTp2\").toggle();\n$.sparkline_display_visible();\n});\n  });<\/script><\/div><\/div>\n\n<\/div>"],"fixed":[true,true,true,true,true,true,true,true,true,true,true],"colorClust":["#B9828C","#B9828C","#7D91B6","#B9828C","#7D91B6","#B9828C","#B9828C","#7D91B6","#B9828C","#B9828C","#B9828C"],"labelClust":["good","good","bad","good","bad","good","good","bad","good","good","good"],"Leaf":[0,0,1,0,1,0,0,1,1,1,1],"font.size":[16,16,16,16,16,16,16,16,16,16,16],"scaling.min":[22.5,22.5,22.5,22.5,22.5,22.5,22.5,22.5,22.5,22.5,22.5],"scaling.max":[22.5,22.5,22.5,22.5,22.5,22.5,22.5,22.5,22.5,22.5,22.5]},"edges":{"id":["edge1","edge2","edge3","edge4","edge5","edge6","edge7","edge8","edge9","edge10"],"from":[1,2,2,5,5,11,22,22,11,1],"to":[2,4,5,10,11,22,44,45,23,3],"label":["<0, 0<=...","all pai...","critica...",">= 27.5","< 27.5","domesti...","< 35.5",">= 35.5","busines...",">=200, ..."],"value":[385,51,334,77,257,83,42,41,174,315],"title":["<div style=\"text-align:center;\"><b>checking_status<\/b><\/div><div style=\"text-align:center;\"><0<\/div><div style=\"text-align:center;\">0<=X<200<\/div>","<div style=\"text-align:center;\"><b>credit_history<\/b><\/div><div style=\"text-align:center;\">all paid<\/div><div style=\"text-align:center;\">no credits/all paid<\/div>","<div style=\"text-align:center;\"><b>credit_history<\/b><\/div><div style=\"text-align:center;\">critical/other existing credit<\/div><div style=\"text-align:center;\">delayed previously<\/div><div style=\"text-align:center;\">existing paid<\/div>","<div style=\"text-align:center;\"><b>duration<\/b><\/div><div style=\"text-align:center;\">>=27.5<\/div>","<div style=\"text-align:center;\"><b>duration<\/b><\/div><div style=\"text-align:center;\"><27.5<\/div>","<div style=\"text-align:center;\"><b>purpose<\/b><\/div><div style=\"text-align:center;\">domestic appliance<\/div><div style=\"text-align:center;\">education<\/div><div style=\"text-align:center;\">new car<\/div><div style=\"text-align:center;\">retraining<\/div>","<div style=\"text-align:center;\"><b>age<\/b><\/div><div style=\"text-align:center;\"><35.5<\/div>","<div style=\"text-align:center;\"><b>age<\/b><\/div><div style=\"text-align:center;\">>=35.5<\/div>","<div style=\"text-align:center;\"><b>purpose<\/b><\/div><div style=\"text-align:center;\">business<\/div><div style=\"text-align:center;\">furniture/equipment<\/div><div style=\"text-align:center;\">other<\/div><div style=\"text-align:center;\">radio/tv<\/div><div style=\"text-align:center;\">repairs<\/div><div style=\"text-align:center;\">used car<\/div>","<div style=\"text-align:center;\"><b>checking_status<\/b><\/div><div style=\"text-align:center;\">>=200<\/div><div style=\"text-align:center;\">no checking<\/div>"],"color":["#8181F7","#8181F7","#8181F7","#8181F7","#8181F7","#8181F7","#8181F7","#8181F7","#8181F7","#8181F7"],"font.size":[14,14,14,14,14,14,14,14,14,14],"font.align":["horizontal","horizontal","horizontal","horizontal","horizontal","horizontal","horizontal","horizontal","horizontal","horizontal"],"smooth.enabled":[true,true,true,true,true,true,true,true,true,true],"smooth.type":["cubicBezier","cubicBezier","cubicBezier","cubicBezier","cubicBezier","cubicBezier","cubicBezier","cubicBezier","cubicBezier","cubicBezier"],"smooth.roundness":[0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"UD"}},"interaction":{"dragNodes":false,"selectConnectedEdges":false,"tooltipDelay":500,"zoomSpeed":1},"edges":{"scaling":{"label":{"enabled":false}}}},"groups":null,"width":"100%","height":"800px","idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Árbol con poda","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-size:12px;text-align:center;"},"footer":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-size:12px;text-align:center;"},"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":50000,"to":0},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":true,"resetHighlight":true,"clusterOptions":{"fixed":true,"physics":false},"keepCoord":true,"labelSuffix":"(cluster)"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;\n                      white-space: nowrap;\n                      font-family: cursive;font-size:12px;font-color:purple;background-color: #E6E6E6;\n                      border-radius: 15px;","OnceEvents":{"stabilized":"function() { \n        this.setOptions({layout:{hierarchical:false}, physics:{solver:'barnesHut', enabled:true, stabilization : false}, nodes : {physics : false, fixed : true}});\n    }"},"legend":{"width":0.1,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["age","checking_status","credit_history","duration","purpose","bad","good"],"color":["#B4C7ED","#F1B8C2","#DAC49C","#A9D1A5","#8AD3D0","#7D91B6","#B9828C"],"shape":["dot","dot","dot","dot","dot","square","square"],"size":[22,22,22,22,22,22,22],"Leaf":[0,0,0,0,0,1,1],"font.size":[16,16,16,16,16,16,16],"id":[10000,10001,10002,10003,10004,10005,10006]},"nodesToDataframe":true},"tree":{"updateShape":true,"shapeVar":"dot","shapeY":"square","colorVar":{"variable":["checking_status","credit_history","duration","purpose","age"],"color":["#F1B8C2","#DAC49C","#A9D1A5","#8AD3D0","#B4C7ED"]},"colorY":{"colorY":{"modality":["bad","good"],"color":["#7D91B6","#B9828C"]},"vardecidedClust":["good","good","bad","good","bad","good","good","bad","good","good","good"]}},"export":{"type":"png","css":"float:right;-webkit-border-radius: 10;\n                  -moz-border-radius: 10;\n                  border-radius: 10px;\n                  font-family: Arial;\n                  color: #ffffff;\n                  font-size: 12px;\n                  background: #090a0a;\n                  padding: 4px 8px 4px 4px;\n                  text-decoration: none;","background":"#fff","name":"network.png","label":"Export as png"}},"evals":["OnceEvents.stabilized"],"jsHooks":[]}</script>
</div>
</div>
</section><section id="función-myroc" class="level2"><h2 class="anchored" data-anchor-id="función-myroc">Función <code>myROC()</code>
</h2>
<ul>
<li>Es necesario tener cargadas las bibliotecaS <code>dplyr</code>, <code>ggplot2</code>, <code>hrbrthemes</code>, <code>Metrics</code> y <code>pROC</code> para ejecutar la función.</li>
</ul>
<div class="cell" data-layout-align="center">
<details><summary>Código</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">myROC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">predichos</span>, <span class="va">reales</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://expasy.org/tools/pROC/">pROC</a></span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mfrasco/Metrics">Metrics</a></span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">reales</span>, <span class="va">predichos</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame</a></span><span class="op">(</span>TPR <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">sensitivities</span>,</span>
<span>                  FPR <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">x</span><span class="op">$</span><span class="va">specificities</span><span class="op">)</span></span>
<span>  <span class="va">gg</span> <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">FPR</span>, ymin <span class="op">=</span> <span class="fl">0</span>, ymax <span class="op">=</span> <span class="va">TPR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">TPR</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#5A5156"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">TPR</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"#F6222E"</span>, size <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span></span>
<span>      intercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      slope <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"gray37"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      linetype <span class="op">=</span> <span class="st">"dashed"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/hrbrthemes/man/theme_ipsum.html">theme_ipsum</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"FPR (1 - Especificidad)"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"TPR (Sensitividad)"</span>,</span>
<span>      title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Curva ROC"</span><span class="op">)</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>        <span class="st">"Valor AUC: "</span>,</span>
<span>        <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/auc.html">auc</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">reales</span>,</span>
<span>                     predicted <span class="op">=</span> <span class="va">predichos</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">gg</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="recursos-de-información" class="level1"><h1>Recursos de información</h1>
<ul>
<li><a href="http://faculty.marshall.usc.edu/gareth-james/ISL/">An Introduction to Statistical Learning with Applications in R.</a></li>
<li><a href="https://www.statmethods.net/advstats/cart.html">Tree-Based Models.</a></li>
<li><a href="https://rpubs.com/Joaquin_AR/255596">Árboles de predicción - Joaquín A. Rodrigo.</a></li>
<li><a href="https://www.datacamp.com/courses/machine-learning-with-tree-based-models-in-r">Curso DataCamp - <em>Tree-Based Models in R</em>.</a></li>
</ul>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Correr el código</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb38" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Árbol de clasificación con R"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Edimer (Sidereus)"</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "07-18-2020"</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Ejemplo de árboles de decisión en machine learning supervisado para clasificación. Uso de las bibliotecas rpart, rpart.plot y caret en perfilamiento de riesgo crediticio."</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - R</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - Tree Decision</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - ML</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "img1.png "</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="an">lang:</span><span class="co"> es</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="an">css:</span><span class="co"> estilo.css</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "Tabla de contenido"</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 4</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: github</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: </span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true </span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true </span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">warning =</span> <span class="cn">FALSE</span>,</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fig.align =</span> <span class="st">"center"</span>)</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Learn more about creating blogs with Distill at:</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="co"># https://rstudio.github.io/distill/blog.html</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargando función</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span> <span class="ot">=</span> <span class="st">"www/img2.png"</span> <span class="kw">/&gt;</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/center&gt;</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a><span class="fu"># Contenido</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>**1.** Información general (requisitos previos, bibliotecas, etc).   </span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>**2.** Análisis inicial de los datos. Como el objetivo principal del documento es entrenar un modelo de *árbol de decisión* con R, el análisis inicial incluye sólo una parte exploratoria y algunas pruebas estadísticas.   </span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>**3.** Entrenamiento de modelo por defecto con <span class="in">`rpart`</span>.   </span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>**4.** Ajuste de hiperparámetros con la biblioteca <span class="in">`caret`</span>. La métrica para evaluar el desempeño predictivo de los modelos es el <span class="co">[</span><span class="ot">área bajo la curva ROC.</span><span class="co">](https://towardsdatascience.com/understanding-auc-roc-curve-68b2303cc9c5)</span>     </span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>**5.** Material complementario.   </span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>**6.** Recursos de información. </span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a><span class="fu"># Requisitos previos</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Instalar las bibliotecas <span class="co">[</span><span class="ot">`rpart`</span><span class="co">](https://cran.r-project.org/web/packages/rpart/rpart.pdf)</span> y <span class="co">[</span><span class="ot">rpart.plot</span><span class="co">](https://cran.r-project.org/web/packages/rpart.plot/rpart.plot.pdf)</span> para entrenar y gráficar modelos basados en árboles.</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Instalar la biblioteca <span class="co">[</span><span class="ot">`caret`.</span><span class="co">](http://topepo.github.io/caret/index.html)</span></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Descargar datos para ejemplo</span><span class="co">](https://www.openml.org/d/31)</span> desde la página <span class="co">[</span><span class="ot">openML</span><span class="co">](https://www.openml.org/)</span>. La base de datos proporciona información de personas perfiladas con riesgo crediticio *bueno* o *malo*.</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Bibliotecas complementarias:** para visualizaciones **`ggplot2`**, **`jcolors`** y **`hrbrthemes`**, para manejo de datos **`dplyr`**  y  para métricas de error y/o precisión **`Metrics`** y **`pROC`**.</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a><span class="fu"># Bibliotecas</span></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jcolors)</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Metrics)</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a><span class="fu"># Descripción de variables</span></span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Además de la variable respuesta *class*, se cuenta con las siguientes 20 variables.</span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;</span></span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span> <span class="ot">=</span> <span class="st">"www/img1.png"</span> <span class="kw">/&gt;</span> </span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/center&gt;</span></span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a><span class="fu"># Datos</span></span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Se importan los datos y se aplica la función <span class="in">`mutate_if()`</span> para eliminar las comillas simples (*''*) que están presentes en las variables tipo texto (`character`). A continuación sólo se muestran 5 variables (columnas) con 10 observaciones. La variable **`class`** es nuestro *target* o *variable respuesta*.</span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="at">file =</span> <span class="st">"data/dataset_31_credit-g.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, <span class="fu">funs</span>(<span class="fu">gsub</span>(<span class="st">"'"</span>, <span class="st">""</span>, .)))</span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">21</span>)], <span class="at">n =</span> 10L) <span class="co"># Imprimiendo sólo 5 columnas</span></span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Dimensión de la base de datos:**</span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data)</span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a><span class="fu"># Distribución de variable respuesta</span></span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-111"><a href="#cb38-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-112"><a href="#cb38-112" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb38-113"><a href="#cb38-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb38-114"><a href="#cb38-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb38-115"><a href="#cb38-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5A5156"</span>, <span class="st">"#F6222E"</span>)) <span class="sc">+</span></span>
<span id="cb38-116"><a href="#cb38-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb38-117"><a href="#cb38-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb38-118"><a href="#cb38-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-119"><a href="#cb38-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-120"><a href="#cb38-120" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exploratorio</span></span>
<span id="cb38-121"><a href="#cb38-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-122"><a href="#cb38-122" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Distribución de edad por variable objetivo:** se puede apreciar que la edad promedio de los clasificados como *"buenos"* es más alta, además, los clasificados como *"malos"* en su mayoría son personas entre 20 y 30 años de edad.</span>
<span id="cb38-123"><a href="#cb38-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-126"><a href="#cb38-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-127"><a href="#cb38-127" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb38-128"><a href="#cb38-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">y =</span> age, <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb38-129"><a href="#cb38-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb38-130"><a href="#cb38-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">color =</span> <span class="st">"#E4E1E3"</span>, <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>)  <span class="sc">+</span></span>
<span id="cb38-131"><a href="#cb38-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.y =</span> mean, <span class="at">color =</span> <span class="st">"#E4E1E3"</span>, <span class="at">pch =</span> <span class="dv">17</span>) <span class="sc">+</span></span>
<span id="cb38-132"><a href="#cb38-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5A5156"</span>, <span class="st">"#F6222E"</span>)) <span class="sc">+</span></span>
<span id="cb38-133"><a href="#cb38-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb38-134"><a href="#cb38-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb38-135"><a href="#cb38-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"El triángulo representa el promedio."</span>)</span>
<span id="cb38-136"><a href="#cb38-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-137"><a href="#cb38-137" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Propósitos de crédito más frecuentes:** la distribución de personas clasificadas como *buenas* o *malas* cuando el propósito es vehículo, discrepa bastante entre la opción de **nuevo** o **usado**. En vehículos usados la gran mayoría son clasificados como "buenos", sin embargo, cuando se trata de vehículos nuevos, la distribución es similar, lo que permite inferir que es más probable que una persona se comporte como mal pagador en créditos para vehículo nuevo respecto a créditos para vehículos usados. También se podría intuir que cuando se trata de créditos para educación es igual de probable que la persona sea clasificada como "bueno" o "malo".</span>
<span id="cb38-138"><a href="#cb38-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-139"><a href="#cb38-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5}</span></span>
<span id="cb38-140"><a href="#cb38-140" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb38-141"><a href="#cb38-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class, purpose) <span class="sc">%&gt;%</span> </span>
<span id="cb38-142"><a href="#cb38-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-143"><a href="#cb38-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(purpose, n), <span class="at">y =</span> n, <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb38-144"><a href="#cb38-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"#E4E1E3"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb38-145"><a href="#cb38-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5A5156"</span>, <span class="st">"#F6222E"</span>)) <span class="sc">+</span></span>
<span id="cb38-146"><a href="#cb38-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Purpose"</span>) <span class="sc">+</span></span>
<span id="cb38-147"><a href="#cb38-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb38-148"><a href="#cb38-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb38-149"><a href="#cb38-149" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb38-150"><a href="#cb38-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-151"><a href="#cb38-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-152"><a href="#cb38-152" aria-hidden="true" tabindex="-1"></a><span class="fu"># Inferencia</span></span>
<span id="cb38-153"><a href="#cb38-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-154"><a href="#cb38-154" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Análisis de varianza:** en vista de la discrepancia que se observa en la distribución de las edades para personas clasificadas como "buenas" o "malas", realizo el [análisis de varianza](https://es.wikipedia.org/wiki/An%C3%A1lisis_de_la_varianza) para contrastar si dichas diferencias son estadísticamente significativas. **Nota:** aunque nuestra variable respuesta es *class*, en este caso actúa como "predictora" o fuente de variación.</span>
<span id="cb38-155"><a href="#cb38-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-158"><a href="#cb38-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-159"><a href="#cb38-159" aria-hidden="true" tabindex="-1"></a>myAnova <span class="ot">&lt;-</span> <span class="fu">aov</span>(age <span class="sc">~</span> class, <span class="at">data =</span> data)</span>
<span id="cb38-160"><a href="#cb38-160" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(myAnova)</span>
<span id="cb38-161"><a href="#cb38-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-162"><a href="#cb38-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-163"><a href="#cb38-163" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>El resultado de la prueba muestra que existe evidencia estadísticamente significativa (*p=0.00393*) para considerar que la variación de la edad entre ambos grupos es diferente.</span>
<span id="cb38-164"><a href="#cb38-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-165"><a href="#cb38-165" aria-hidden="true" tabindex="-1"></a><span class="fu"># Árboles de decisión</span></span>
<span id="cb38-166"><a href="#cb38-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-167"><a href="#cb38-167" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;</span></span>
<span id="cb38-168"><a href="#cb38-168" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span> <span class="ot">=</span> <span class="st">"www/img3.png"</span> <span class="kw">/&gt;</span></span>
<span id="cb38-169"><a href="#cb38-169" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/center&gt;</span></span>
<span id="cb38-170"><a href="#cb38-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-171"><a href="#cb38-171" aria-hidden="true" tabindex="-1"></a><span class="fu">## Generalidades</span></span>
<span id="cb38-172"><a href="#cb38-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-173"><a href="#cb38-173" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;</span></span>
<span id="cb38-174"><a href="#cb38-174" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span> <span class="ot">=</span> <span class="st">"www/img4.png"</span> <span class="kw">/&gt;</span></span>
<span id="cb38-175"><a href="#cb38-175" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/center&gt;</span></span>
<span id="cb38-176"><a href="#cb38-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-177"><a href="#cb38-177" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Los árboles de decisión se pueden utilizar para problemas de regresión y clasificación.</span>
<span id="cb38-178"><a href="#cb38-178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Se pueden definir como una estructura jerárquica que busca particionar el espacio de características e identificar subconjuntos representativos. Desde la parte superior a inferior cada árbol tiene *nodo raíz*, *nodos de decisión o internos* y *nodos hojas o terminales*, los dos primeros  se generan con base en reglas  binarias. Mayor grado de pureza es la recompensa que busca el algoritmo al particionar el espacio inicial en subregiones, en ese orden de ideas el objetivo siempre será particionar los datos en nodos que sean lo más puros posible, sin embargo, matemáticamente es más fácil medir la **impureza** de una región específica, proporcionando una idea de qué tan heterogéneas son las clases en ese nodo; una métrica de uso común en problemas de clasificación para medir la impureza es el **índice GINI**, donde valores bajos indican mayor grado de pureza. Además del índice GINI también es posible utilizar otras métricas como la **ganancia de información** o la **entropía**.</span>
<span id="cb38-179"><a href="#cb38-179" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Ventajas:**</span>
<span id="cb38-180"><a href="#cb38-180" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Fácil de interpretar (sujeto a la profundidad).</span>
<span id="cb38-181"><a href="#cb38-181" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>No requieren estandarización o normalización de variables predictoras numéricas.</span>
<span id="cb38-182"><a href="#cb38-182" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Permiten manipular variables categóricas sin necesidad de aplicar codificaciones tipo *one-hot* o *variables dummy*.</span>
<span id="cb38-183"><a href="#cb38-183" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Requieren poco preprocesamiento de datos.</span>
<span id="cb38-184"><a href="#cb38-184" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Permiten valores ausentes (<span class="in">`NA`</span>).</span>
<span id="cb38-185"><a href="#cb38-185" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Permite relaciones no lineales.</span>
<span id="cb38-186"><a href="#cb38-186" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Desventajas:**</span>
<span id="cb38-187"><a href="#cb38-187" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Si no se controla adecuadamente la profundidad del árbol existe alta probabilidad de incurrir en <span class="co">[</span><span class="ot">*sobreajuste (overfitting)*.</span><span class="co">](https://es.wikipedia.org/wiki/Sobreajuste)</span></span>
<span id="cb38-188"><a href="#cb38-188" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Alta varianza, pequeños cambios en los datos pueden arrojar resultados muy diferentes.</span>
<span id="cb38-189"><a href="#cb38-189" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Hiperparámetros:** aunque ejecutar la función <span class="in">`rpart()`</span> con valores predeterminados puede ser una buena estrategia para iniciar, siempre estaremos interesados en ajustar determinados parámetros que nos permitan obtener mejor rendimiento predictivo. La función <span class="in">`rpart.control()`</span> permite controlar manualmente otras opciones. Dentro los hiperparámetros más importantes en árboles de decisión están los siguientes: </span>
<span id="cb38-190"><a href="#cb38-190" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Mínimo número de observaciones para generar una partición. En la biblioteca <span class="in">`rpart`</span> lleva el nombre de <span class="in">`minsplit`</span> y su valor por defecto es 20.</span>
<span id="cb38-191"><a href="#cb38-191" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Máxima profundiad del árbol. En la biblioteca <span class="in">`rpart`</span> lleva el nombre de <span class="in">`maxdepth`</span> y su valor predeterminado es 30. Este parámetro es de alta relevancia para evitar el sobreajuste.</span>
<span id="cb38-192"><a href="#cb38-192" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Parámetro de complejidad. En la biblioteca <span class="in">`rpart`</span> lleva el nombre de <span class="in">`cp`</span> y su valor por defecto es 0.01. Este parámetro sirve al propósito de penalizar y contolar el tamaño del árbol, valores bajos indican árboles de mayor complejidad, es decir, mayor número de divisiones. La función <span class="in">`rpart()`</span> internamente ejecuta <span class="co">[</span><span class="ot">validación cruzada</span><span class="co">](https://es.wikipedia.org/wiki/Validaci%C3%B3n_cruzada)</span> 10 veces para estimar el valor óptimo de **cp**, es posible acceder a dicho resultado a través de la función `plotcp()` que permitirá facilmente determinar el valor adecuado para este parámetro. Cuando se tiene el valor óptimo de **cp** será posible "podar" el árbol para que el modelo sea optimizado, dicho resultado es posible a través de la función <span class="in">`prune()`</span>.</span>
<span id="cb38-193"><a href="#cb38-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-194"><a href="#cb38-194" aria-hidden="true" tabindex="-1"></a><span class="fu">## Train - Test</span></span>
<span id="cb38-195"><a href="#cb38-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-196"><a href="#cb38-196" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Para entrenar el modelo inicialmente fracciono los datos en *train* y *test* con proporciones de 70 y 30%, respectivamente. Este proceso aunque es posible hacerlo manualmente con la función <span class="in">`sample()`</span>, la función <span class="in">`createDataPartition()`</span> del paquete <span class="in">`caret`</span> agiliza el procedimiento. Para garantizar replicabilidad en los resultados se agrega la semilla.</span>
<span id="cb38-197"><a href="#cb38-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-200"><a href="#cb38-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-201"><a href="#cb38-201" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1992</span>)</span>
<span id="cb38-202"><a href="#cb38-202" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(<span class="at">y =</span> data<span class="sc">$</span>class, <span class="at">times =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="fl">0.70</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-203"><a href="#cb38-203" aria-hidden="true" tabindex="-1"></a>dataTrain <span class="ot">&lt;-</span> data[idx, ]</span>
<span id="cb38-204"><a href="#cb38-204" aria-hidden="true" tabindex="-1"></a>dataTest <span class="ot">&lt;-</span> data[<span class="sc">-</span>idx, ]</span>
<span id="cb38-205"><a href="#cb38-205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-206"><a href="#cb38-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-207"><a href="#cb38-207" aria-hidden="true" tabindex="-1"></a><span class="fu">## `rpart` *default*</span></span>
<span id="cb38-208"><a href="#cb38-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-209"><a href="#cb38-209" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Ajuste del modelo:** en este caso se utilizan todas las variables predictoras para entrenar el modelo. Al imprimir el objeto que contiene el modelo  podemos observar el conjunto de reglas que dan como resultado la estructura final del árbol. El método igualado a **`method = "class"`** indica que es un problema de clasificación, si fuese un problema de regresión el argumento tomaría el valor de  **`method = "anova"`**, aunque también permite otras opciones (consulte <span class="in">`?rpart`</span> o <span class="in">`help("rpart")`</span>).</span>
<span id="cb38-210"><a href="#cb38-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-213"><a href="#cb38-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-214"><a href="#cb38-214" aria-hidden="true" tabindex="-1"></a>modArbol0 <span class="ot">&lt;-</span> <span class="fu">rpart</span>(class <span class="sc">~</span> ., <span class="at">data =</span> dataTrain, <span class="at">method =</span> <span class="st">"class"</span>)</span>
<span id="cb38-215"><a href="#cb38-215" aria-hidden="true" tabindex="-1"></a>modArbol0</span>
<span id="cb38-216"><a href="#cb38-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-217"><a href="#cb38-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-218"><a href="#cb38-218" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Gráfico del modelo:** la variable más importante y que da origen al nodo raíz es **`checking_status`**, que hace referencia al estado de la cuenta corriente. El historial crediticio, la duración del tiempo para pagar el crédito, el estado de la cuenta de ahorros y el propósito del crédito, también son factores determinantes. No tener suficiente capital en cualquiera de las dos cuentas, tener mal historial crediticio y además solicitar períodos de pago de alta duración, pueden ser características no deseables a la hora de solicitar un crédito.</span>
<span id="cb38-219"><a href="#cb38-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-220"><a href="#cb38-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=9, fig.height=8}</span></span>
<span id="cb38-221"><a href="#cb38-221" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(modArbol0)</span>
<span id="cb38-222"><a href="#cb38-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-223"><a href="#cb38-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-224"><a href="#cb38-224" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Matriz de confusión:** el modelo por *default* tiene precisión promedio de 0.7167, con dificultades para clasificar de forma correcta los "malos", es decir, que tiene baja especificidad.</span>
<span id="cb38-225"><a href="#cb38-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-228"><a href="#cb38-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-229"><a href="#cb38-229" aria-hidden="true" tabindex="-1"></a>predichos_mod0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> modArbol0, <span class="at">newdata =</span> dataTest, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb38-230"><a href="#cb38-230" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> predichos_mod0, <span class="at">reference =</span> <span class="fu">as.factor</span>(dataTest<span class="sc">$</span>class),</span>
<span id="cb38-231"><a href="#cb38-231" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"good"</span>)</span>
<span id="cb38-232"><a href="#cb38-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-233"><a href="#cb38-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-234"><a href="#cb38-234" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Área bajo la curva:**</span>
<span id="cb38-235"><a href="#cb38-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-238"><a href="#cb38-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-239"><a href="#cb38-239" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades predichas para la clase "good"</span></span>
<span id="cb38-240"><a href="#cb38-240" aria-hidden="true" tabindex="-1"></a>pred0 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(<span class="at">object =</span> modArbol0,</span>
<span id="cb38-241"><a href="#cb38-241" aria-hidden="true" tabindex="-1"></a>                               <span class="at">newdata =</span> dataTest, <span class="at">type =</span> <span class="st">"prob"</span>))<span class="sc">$</span>good</span>
<span id="cb38-242"><a href="#cb38-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-243"><a href="#cb38-243" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformando respuesta a entero. A la clase "good" le agrego 1 y </span></span>
<span id="cb38-244"><a href="#cb38-244" aria-hidden="true" tabindex="-1"></a><span class="co"># a la clase "bad" le agrego 0.</span></span>
<span id="cb38-245"><a href="#cb38-245" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(dataTest<span class="sc">$</span>class)) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb38-246"><a href="#cb38-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-247"><a href="#cb38-247" aria-hidden="true" tabindex="-1"></a><span class="co"># AUC</span></span>
<span id="cb38-248"><a href="#cb38-248" aria-hidden="true" tabindex="-1"></a>Metrics<span class="sc">::</span><span class="fu">auc</span>(<span class="at">actual =</span> target, <span class="at">predicted =</span> pred0)</span>
<span id="cb38-249"><a href="#cb38-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-250"><a href="#cb38-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-251"><a href="#cb38-251" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Curva ROC:** la función con la que obtengo el siguiente gráfico puede ser encontrada en <span class="co">[</span><span class="ot">mi Github.</span><span class="co">](https://github.com/web-edimer/web-edimer.github.io/blob/master/_posts/TreeD_R/functions/myROC.R)</span></span>
<span id="cb38-252"><a href="#cb38-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-253"><a href="#cb38-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5, fig.width=7}</span></span>
<span id="cb38-254"><a href="#cb38-254" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargando función</span></span>
<span id="cb38-255"><a href="#cb38-255" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"functions/myROC.R"</span>)</span>
<span id="cb38-256"><a href="#cb38-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-257"><a href="#cb38-257" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver función myROC() al final en material complementario    </span></span>
<span id="cb38-258"><a href="#cb38-258" aria-hidden="true" tabindex="-1"></a><span class="fu">myROC</span>(<span class="at">predichos =</span> pred0, <span class="at">reales =</span> target)</span>
<span id="cb38-259"><a href="#cb38-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-260"><a href="#cb38-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-261"><a href="#cb38-261" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Parámetro de complejidad (CP):**</span>
<span id="cb38-262"><a href="#cb38-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-265"><a href="#cb38-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-266"><a href="#cb38-266" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(modArbol0)</span>
<span id="cb38-267"><a href="#cb38-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-268"><a href="#cb38-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-269"><a href="#cb38-269" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**"Podando" el árbol:** se elige el valor de cp = 0.025 por mostrar mejores resultados (bajo error).</span>
<span id="cb38-270"><a href="#cb38-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-273"><a href="#cb38-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-274"><a href="#cb38-274" aria-hidden="true" tabindex="-1"></a>modArbol0_prune <span class="ot">&lt;-</span> <span class="fu">prune</span>(<span class="at">tree =</span> modArbol0, <span class="at">cp =</span> <span class="fl">0.025</span>)</span>
<span id="cb38-275"><a href="#cb38-275" aria-hidden="true" tabindex="-1"></a>modArbol0_prune</span>
<span id="cb38-276"><a href="#cb38-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-277"><a href="#cb38-277" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Gráfico de árbol con "poda":**</span>
<span id="cb38-278"><a href="#cb38-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-279"><a href="#cb38-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5}</span></span>
<span id="cb38-280"><a href="#cb38-280" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(modArbol0_prune)</span>
<span id="cb38-281"><a href="#cb38-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-282"><a href="#cb38-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-283"><a href="#cb38-283" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Matriz de confusión árbol con "poda":** respecto al árbol sin podar, la diferencia en precisión es muy pequeña (&lt;0.01), sin embargo, la especificidad se aumenta de 0.3444 a 0.4556 con la "poda", aunque la sensitividad haya reducido de 0.8762 a 0.8381.</span>
<span id="cb38-284"><a href="#cb38-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-287"><a href="#cb38-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-288"><a href="#cb38-288" aria-hidden="true" tabindex="-1"></a>predichos_mod0_prune <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> modArbol0_prune, <span class="at">newdata =</span> dataTest, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb38-289"><a href="#cb38-289" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> predichos_mod0_prune, <span class="at">reference =</span> <span class="fu">as.factor</span>(dataTest<span class="sc">$</span>class),</span>
<span id="cb38-290"><a href="#cb38-290" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"good"</span>)</span>
<span id="cb38-291"><a href="#cb38-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-292"><a href="#cb38-292" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Área bajo la curva de árbol con "poda":**</span>
<span id="cb38-293"><a href="#cb38-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-296"><a href="#cb38-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-297"><a href="#cb38-297" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades predichas para la clase "good"</span></span>
<span id="cb38-298"><a href="#cb38-298" aria-hidden="true" tabindex="-1"></a>pred0_prune <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(<span class="at">object =</span> modArbol0_prune,</span>
<span id="cb38-299"><a href="#cb38-299" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">newdata =</span> dataTest, <span class="at">type =</span> <span class="st">"prob"</span>))<span class="sc">$</span>good</span>
<span id="cb38-300"><a href="#cb38-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-301"><a href="#cb38-301" aria-hidden="true" tabindex="-1"></a><span class="co"># AUC</span></span>
<span id="cb38-302"><a href="#cb38-302" aria-hidden="true" tabindex="-1"></a>Metrics<span class="sc">::</span><span class="fu">auc</span>(<span class="at">actual =</span> target, <span class="at">predicted =</span> pred0_prune)</span>
<span id="cb38-303"><a href="#cb38-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-304"><a href="#cb38-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-305"><a href="#cb38-305" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Curva ROC:**</span>
<span id="cb38-306"><a href="#cb38-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-307"><a href="#cb38-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5, fig.width=7}</span></span>
<span id="cb38-308"><a href="#cb38-308" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver función myROC() al final en material complementario    </span></span>
<span id="cb38-309"><a href="#cb38-309" aria-hidden="true" tabindex="-1"></a><span class="fu">myROC</span>(<span class="at">predichos =</span> pred0_prune, <span class="at">reales =</span> target)</span>
<span id="cb38-310"><a href="#cb38-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-311"><a href="#cb38-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-312"><a href="#cb38-312" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tuning con caret</span></span>
<span id="cb38-313"><a href="#cb38-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-314"><a href="#cb38-314" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A diferencia de los parámetros que se "aprenden" duarante el entrenamiento del modelo, los hipeparámetros se definen previo al ajuste del mismo. </span>
<span id="cb38-315"><a href="#cb38-315" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>El ajuste de <span class="co">[</span><span class="ot">hiperparámetros</span><span class="co">]</span>(https://en.wikipedia.org/wiki/Hyperparameter_(machine_learning)) se constituye como parte fundamental de la optimización del modelo.</span>
<span id="cb38-316"><a href="#cb38-316" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La biblioteca <span class="co">[</span><span class="ot">`caret`</span><span class="co">](http://topepo.github.io/caret/index.html)</span> proporciona un marco de trabajo unificado para entrenar y validar modelos de machine learning. En este caso, con <span class="in">`caret`</span> podremos ajustar dos de los tres hiperparámetros mencionados anteriormente, el parámetro de complejidad y la profundidad del árbol. Las funciones **`trainControl()`** y **`train`** de la biblioteca <span class="in">`caret`</span> facilitan el proceso.</span>
<span id="cb38-317"><a href="#cb38-317" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**`trainControl()`:** permite establecer la estrategia de validación, por ejemplo validación cruzada *k-fold*, validación cruzada repetida, bootstrapping, entre otras. Desde esta misma función también es posible determinar el método de búsqueda de hiperparámetros, que puede ser *aleatoria* o *cuadrícula (grid)*. En este caso particular utilizo *validación cruzada con repeticiones*, con k = 5 y 3 repeticiones. El argumento <span class="in">`summaryFunction = twoClassSummary`</span> permite computar las métricas necesarias (sensitividad y especificidad) para obtener ROC.  Busque  más ayuda con <span class="in">`help("trainControl")`</span>.</span>
<span id="cb38-318"><a href="#cb38-318" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**`train()`:** ajuste el modelo estableciendo la fórmula habitual en R, el método o algoritmo para entrenar, (<span class="co">[</span><span class="ot">lista de algoritmos en `caret`</span><span class="co">](http://topepo.github.io/caret/available-models.html)</span>) los datos, la configuración para el entrenamiento (<span class="in">`tcConrol = myControl`</span>) y la longitud de hiperparámetros a considerar en el entrenamiento (<span class="in">`tuneLenth`</span>). Este último argumento dependerá de los hiperparámetros que estén disponibles en <span class="in">`caret`</span>, aunque también es posible asignarlos manualmente a través de <span class="in">`expand.grid()`</span>. Utilizar el método igualado a "rpart" permitirá optimizar el parámetro *cp* y utilizando "rpart2" es posible optimizar la máxima profundidad del árbol. Cuando se declara <span class="in">`tuneLength = 5`</span> se informa que el número máximo de profundidades a probar será 5, es decir, que al final existirán 5 resultados diferentes con el mismo algoritmo. Por último, se agrega la métrica que será utilizada para comparar los resultados de la validación cruzada.</span>
<span id="cb38-319"><a href="#cb38-319" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Nota:** como el procedimiento de validación cruzada implica muestreo aleatorio, es necesario asignar la semilla para garantizar replicabilidad de resultados.</span>
<span id="cb38-320"><a href="#cb38-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-323"><a href="#cb38-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-324"><a href="#cb38-324" aria-hidden="true" tabindex="-1"></a>myControl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"repeatedcv"</span>,</span>
<span id="cb38-325"><a href="#cb38-325" aria-hidden="true" tabindex="-1"></a>                          <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb38-326"><a href="#cb38-326" aria-hidden="true" tabindex="-1"></a>                          <span class="at">repeats =</span> <span class="dv">3</span>,</span>
<span id="cb38-327"><a href="#cb38-327" aria-hidden="true" tabindex="-1"></a>                          <span class="at">classProbs =</span> <span class="cn">TRUE</span>,  <span class="co"># Permite predecir probabilidades</span></span>
<span id="cb38-328"><a href="#cb38-328" aria-hidden="true" tabindex="-1"></a>                          <span class="at">summaryFunction =</span> twoClassSummary) </span>
<span id="cb38-329"><a href="#cb38-329" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1992</span>)</span>
<span id="cb38-330"><a href="#cb38-330" aria-hidden="true" tabindex="-1"></a>modArbol_tune <span class="ot">&lt;-</span> <span class="fu">train</span>(class <span class="sc">~</span> .,</span>
<span id="cb38-331"><a href="#cb38-331" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">"rpart2"</span>,</span>
<span id="cb38-332"><a href="#cb38-332" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> data,</span>
<span id="cb38-333"><a href="#cb38-333" aria-hidden="true" tabindex="-1"></a>                       <span class="at">trControl =</span> myControl,</span>
<span id="cb38-334"><a href="#cb38-334" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tuneLength =</span> <span class="dv">5</span>,</span>
<span id="cb38-335"><a href="#cb38-335" aria-hidden="true" tabindex="-1"></a>                       <span class="at">metric =</span> <span class="st">"ROC"</span>)</span>
<span id="cb38-336"><a href="#cb38-336" aria-hidden="true" tabindex="-1"></a>modArbol_tune</span>
<span id="cb38-337"><a href="#cb38-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-338"><a href="#cb38-338" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Se observa que la mejor profundidad es 14 con la mayor sensitividad aún cuando no tiene la mejor especificidad. A continuación la matriz de confusión en el conjunto de test muestra mejoras en la capacidad de detectar los clasificados como "malos", ademas la precisión es notablemente superior.</span>
<span id="cb38-339"><a href="#cb38-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-342"><a href="#cb38-342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-343"><a href="#cb38-343" aria-hidden="true" tabindex="-1"></a>predichos_tune <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> modArbol_tune, <span class="at">newdata =</span> dataTest, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb38-344"><a href="#cb38-344" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> predichos_tune, <span class="at">reference =</span> <span class="fu">as.factor</span>(dataTest<span class="sc">$</span>class),</span>
<span id="cb38-345"><a href="#cb38-345" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"good"</span>)</span>
<span id="cb38-346"><a href="#cb38-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-347"><a href="#cb38-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-348"><a href="#cb38-348" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Área bajo la curva** el modelo evidentemente consigue mejores resultados respecto a los ajustados inicialmente, de tal manera que el ajuste de hiperparámetros ha logrado mejorar nuestras predicciones en datos que el modelo aún no ha visto. Posiblemente el hecho de ajustar la máxima profundidad sumado al uso de validación cruzada, permite que el modelo capture de mejor manera las relaciones subyacentes entre características.</span>
<span id="cb38-349"><a href="#cb38-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-352"><a href="#cb38-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-353"><a href="#cb38-353" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades predichas para la clase "good"</span></span>
<span id="cb38-354"><a href="#cb38-354" aria-hidden="true" tabindex="-1"></a>pred_tune <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(<span class="at">object =</span> modArbol_tune,</span>
<span id="cb38-355"><a href="#cb38-355" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">newdata =</span> dataTest, <span class="at">type =</span> <span class="st">"prob"</span>))<span class="sc">$</span>good</span>
<span id="cb38-356"><a href="#cb38-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-357"><a href="#cb38-357" aria-hidden="true" tabindex="-1"></a><span class="co"># AUC</span></span>
<span id="cb38-358"><a href="#cb38-358" aria-hidden="true" tabindex="-1"></a>Metrics<span class="sc">::</span><span class="fu">auc</span>(<span class="at">actual =</span> target, <span class="at">predicted =</span> pred_tune)</span>
<span id="cb38-359"><a href="#cb38-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-360"><a href="#cb38-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-361"><a href="#cb38-361" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Curva ROC:**</span>
<span id="cb38-362"><a href="#cb38-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-363"><a href="#cb38-363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5, fig.width=7, warning=FALSE, message=FALSE}</span></span>
<span id="cb38-364"><a href="#cb38-364" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver función myROC() al final en material complementario    </span></span>
<span id="cb38-365"><a href="#cb38-365" aria-hidden="true" tabindex="-1"></a><span class="fu">myROC</span>(<span class="at">predichos =</span> pred_tune, <span class="at">reales =</span> target)</span>
<span id="cb38-366"><a href="#cb38-366" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-367"><a href="#cb38-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-368"><a href="#cb38-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-369"><a href="#cb38-369" aria-hidden="true" tabindex="-1"></a><span class="fu"># Complementario</span></span>
<span id="cb38-370"><a href="#cb38-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-371"><a href="#cb38-371" aria-hidden="true" tabindex="-1"></a><span class="fu">## Función `plot` + `caret`</span></span>
<span id="cb38-372"><a href="#cb38-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-373"><a href="#cb38-373" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La función <span class="in">`plot()`</span> tiene un método específico para resultados obtenidos a través de <span class="in">`caret`</span>, en este caso muestra el gráfico del hiperparámetro de interés, la máxima profundidad del árbol vs la curva ROC en el eje Y, tratando de evidenicar el valor óptimo.</span>
<span id="cb38-374"><a href="#cb38-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-377"><a href="#cb38-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-378"><a href="#cb38-378" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(modArbol_tune)</span>
<span id="cb38-379"><a href="#cb38-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-380"><a href="#cb38-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-381"><a href="#cb38-381" aria-hidden="true" tabindex="-1"></a><span class="fu">## Gráfico interactivo con `visNetwork`</span></span>
<span id="cb38-382"><a href="#cb38-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-383"><a href="#cb38-383" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La biblioteca <span class="co">[</span><span class="ot">`visNetwork`</span><span class="co">](https://datastorm-open.github.io/visNetwork/)</span> permite crear gráficos interactivos para objetos de la clase *rpart*. A manera de ejemplo se presenta el gráfico para el árbol de decisión con poda. Recuerde que es interactivo y puede manipularlo con el *mouse*.</span>
<span id="cb38-384"><a href="#cb38-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-387"><a href="#cb38-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-388"><a href="#cb38-388" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visNetwork)</span>
<span id="cb38-389"><a href="#cb38-389" aria-hidden="true" tabindex="-1"></a><span class="fu">visTree</span>(modArbol0_prune, </span>
<span id="cb38-390"><a href="#cb38-390" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Árbol con poda"</span>, <span class="at">width =</span> <span class="st">"100%"</span>,</span>
<span id="cb38-391"><a href="#cb38-391" aria-hidden="true" tabindex="-1"></a>        <span class="at">height =</span> <span class="st">"800px"</span>,  <span class="at">edgesFontSize =</span> <span class="dv">14</span>, <span class="at">nodesFontSize =</span> <span class="dv">16</span>,)</span>
<span id="cb38-392"><a href="#cb38-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-393"><a href="#cb38-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-394"><a href="#cb38-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-395"><a href="#cb38-395" aria-hidden="true" tabindex="-1"></a><span class="fu">## Función `myROC()`</span></span>
<span id="cb38-396"><a href="#cb38-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-397"><a href="#cb38-397" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Es necesario tener cargadas las bibliotecaS  <span class="in">`dplyr`</span>, <span class="in">`ggplot2`</span>, <span class="in">`hrbrthemes`</span>, <span class="in">`Metrics`</span> y <span class="in">`pROC`</span> para ejecutar la función.</span>
<span id="cb38-398"><a href="#cb38-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-401"><a href="#cb38-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-402"><a href="#cb38-402" aria-hidden="true" tabindex="-1"></a>myROC <span class="ot">&lt;-</span> <span class="cf">function</span>(predichos, reales) {</span>
<span id="cb38-403"><a href="#cb38-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressMessages</span>(<span class="fu">suppressWarnings</span>(<span class="fu">library</span>(dplyr)))</span>
<span id="cb38-404"><a href="#cb38-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressMessages</span>(<span class="fu">suppressWarnings</span>(<span class="fu">library</span>(ggplot2)))</span>
<span id="cb38-405"><a href="#cb38-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressMessages</span>(<span class="fu">suppressWarnings</span>(<span class="fu">library</span>(pROC)))</span>
<span id="cb38-406"><a href="#cb38-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressMessages</span>(<span class="fu">suppressWarnings</span>(<span class="fu">library</span>(Metrics)))</span>
<span id="cb38-407"><a href="#cb38-407" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">roc</span>(reales, predichos)</span>
<span id="cb38-408"><a href="#cb38-408" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">=</span> <span class="fu">data_frame</span>(<span class="at">TPR =</span> x<span class="sc">$</span>sensitivities,</span>
<span id="cb38-409"><a href="#cb38-409" aria-hidden="true" tabindex="-1"></a>                  <span class="at">FPR =</span> <span class="dv">1</span> <span class="sc">-</span> x<span class="sc">$</span>specificities)</span>
<span id="cb38-410"><a href="#cb38-410" aria-hidden="true" tabindex="-1"></a>  gg <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb38-411"><a href="#cb38-411" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> FPR, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> TPR)) <span class="sc">+</span></span>
<span id="cb38-412"><a href="#cb38-412" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">y =</span> TPR), <span class="at">fill =</span> <span class="st">"#5A5156"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb38-413"><a href="#cb38-413" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">y =</span> TPR), <span class="at">col =</span> <span class="st">"#F6222E"</span>, <span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb38-414"><a href="#cb38-414" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(</span>
<span id="cb38-415"><a href="#cb38-415" aria-hidden="true" tabindex="-1"></a>      <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb38-416"><a href="#cb38-416" aria-hidden="true" tabindex="-1"></a>      <span class="at">slope =</span> <span class="dv">1</span>,</span>
<span id="cb38-417"><a href="#cb38-417" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"gray37"</span>,</span>
<span id="cb38-418"><a href="#cb38-418" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb38-419"><a href="#cb38-419" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="st">"dashed"</span></span>
<span id="cb38-420"><a href="#cb38-420" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb38-421"><a href="#cb38-421" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb38-422"><a href="#cb38-422" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb38-423"><a href="#cb38-423" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb38-424"><a href="#cb38-424" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"FPR (1 - Especificidad)"</span>,</span>
<span id="cb38-425"><a href="#cb38-425" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"TPR (Sensitividad)"</span>,</span>
<span id="cb38-426"><a href="#cb38-426" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Curva ROC"</span>),</span>
<span id="cb38-427"><a href="#cb38-427" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb38-428"><a href="#cb38-428" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Valor AUC: "</span>,</span>
<span id="cb38-429"><a href="#cb38-429" aria-hidden="true" tabindex="-1"></a>        Metrics<span class="sc">::</span><span class="fu">auc</span>(<span class="at">actual =</span> reales,</span>
<span id="cb38-430"><a href="#cb38-430" aria-hidden="true" tabindex="-1"></a>                     <span class="at">predicted =</span> predichos) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>)</span>
<span id="cb38-431"><a href="#cb38-431" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb38-432"><a href="#cb38-432" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-433"><a href="#cb38-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gg)</span>
<span id="cb38-434"><a href="#cb38-434" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-435"><a href="#cb38-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-436"><a href="#cb38-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-437"><a href="#cb38-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-438"><a href="#cb38-438" aria-hidden="true" tabindex="-1"></a><span class="fu"># Recursos de información</span></span>
<span id="cb38-439"><a href="#cb38-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-440"><a href="#cb38-440" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">An Introduction to Statistical Learning with Applications in R.</span><span class="co">](http://faculty.marshall.usc.edu/gareth-james/ISL/)</span></span>
<span id="cb38-441"><a href="#cb38-441" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Tree-Based Models.</span><span class="co">](https://www.statmethods.net/advstats/cart.html)</span></span>
<span id="cb38-442"><a href="#cb38-442" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Árboles de predicción - Joaquín A. Rodrigo.</span><span class="co">](https://rpubs.com/Joaquin_AR/255596)</span></span>
<span id="cb38-443"><a href="#cb38-443" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Curso DataCamp - *Tree-Based Models in R*.</span><span class="co">](https://www.datacamp.com/courses/machine-learning-with-tree-based-models-in-r)</span></span>
</code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>